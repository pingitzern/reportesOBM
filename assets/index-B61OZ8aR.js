(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const Ci=["tab-nuevo","tab-ablandador","tab-buscar","tab-dashboard","remito-view","remitos-gestion-view"];function Ni(e){e&&e.classList.add("hidden")}function Jn(e){e&&e.classList.remove("hidden")}function Be(e){if(typeof e!="string"||!e)return;let t=!1;if(Ci.forEach(n=>{const o=document.getElementById(n);if(o){if(n===e){Jn(o),t=!0;return}Ni(o)}}),!t){const n=document.getElementById(e);n&&Jn(n)}}const Xn={},Ft=typeof window<"u"?window.__APP_CONFIG__:void 0,Mi=Ft&&typeof Ft.API_URL=="string"?Ft.API_URL.trim():"";let Pe=Mi;if(!Pe){const e=typeof import.meta<"u"&&import.meta&&typeof Xn=="object"?Xn:void 0;e&&typeof e.VITE_API_URL=="string"&&(Pe=e.VITE_API_URL.trim())}const mt=typeof globalThis<"u"&&typeof globalThis.process=="object"?globalThis.process:void 0;!Pe&&mt&&mt.env&&typeof mt.env.API_URL=="string"&&(Pe=mt.env.API_URL);Pe||console.warn("[config] API_URL no está configurada. Define window.__APP_CONFIG__.API_URL o la variable de entorno VITE_API_URL/API_URL.");const Ae=Pe,Ri=60,Di=60*24/3.78541,Fi=Object.freeze(Object.defineProperty({__proto__:null,API_URL:Ae,LMIN_TO_GPD:Di,LMIN_TO_LPH:Ri},Symbol.toStringTag,{value:"Module"})),ln="reportesOBM.theme",Te="light",_e="dark";let et=Te,Et=!1,Qn=null;const Kt=new Set;function dn(){return typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null}function Uo(e){Kt.forEach(t=>{if(typeof t=="function")try{t(e)}catch(n){console.warn("[theme] Error ejecutando listener:",n)}})}function jo(e){if(typeof document>"u")return;const t=document.documentElement;if(!t||!t.classList)return;const n=e===_e;t.classList.toggle("dark-theme",n),t.dataset.theme=e}function $i(){const e=dn();if(!e)return null;try{const t=e.getItem(ln);if(t===_e||t===Te)return t}catch(t){console.warn("[theme] No se pudo leer la preferencia almacenada:",t)}return null}function eo(e){const t=dn();if(t)try{t.setItem(ln,e)}catch(n){console.warn("[theme] No se pudo guardar la preferencia de tema:",n)}}function Oi(){const e=dn();if(e)try{e.removeItem(ln)}catch(t){console.warn("[theme] No se pudo limpiar la preferencia de tema:",t)}}function Pi(){return typeof window>"u"||typeof window.matchMedia!="function"?Te:window.matchMedia("(prefers-color-scheme: dark)").matches?_e:Te}function zi(e){if(Et)return;const t=e!=null&&e.matches?_e:Te;qo(t,{persist:!1,explicit:!1})}function ki(){if(typeof window>"u"||typeof window.matchMedia!="function"||Qn)return;const e=window.matchMedia("(prefers-color-scheme: dark)"),t=zi;typeof e.addEventListener=="function"?e.addEventListener("change",t):typeof e.addListener=="function"&&e.addListener(t),Qn=e}function Bi(){const e=$i();Et=!!e;const t=e||Pi();return et=t,jo(t),ki(),Uo(t),t}function Hi(){return et}function qo(e,{persist:t=!0,explicit:n=!0}={}){const o=e===_e?_e:Te;return o===et?(n&&(Et=!0),t&&eo(o),o):(et=o,jo(o),t?eo(o):n||Oi(),n&&(Et=!0),Uo(o),o)}function Ui(e){return typeof e!="function"?()=>{}:(Kt.add(e),e(et),()=>{Kt.delete(e)})}const xt="reportesOBM.user";let pe=null,to=!1,we=null,Ce=!1,It=!1,no=null;function un(){return typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null}function ji(e){if(!e||typeof e!="object")return null;const t=typeof e.nombre=="string"?e.nombre.trim():typeof e.Nombre=="string"?e.Nombre.trim():"",n=typeof e.cargo=="string"?e.cargo.trim():typeof e.Cargo=="string"?e.Cargo.trim():"",o=typeof e.rol=="string"?e.rol.trim():typeof e.Rol=="string"?e.Rol.trim():"";return!t||!o?null:{nombre:t,cargo:n,rol:o}}function qi(e){return typeof e=="string"?e.trim():""}function Vi(e){if(e==null)return{value:null,valid:!0};if(e instanceof Date)return Number.isNaN(e.getTime())?{value:null,valid:!1}:{value:e.toISOString(),valid:!0};if(typeof e=="number"){if(!Number.isFinite(e))return{value:null,valid:!1};const t=new Date(e);return Number.isNaN(t.getTime())?{value:null,valid:!1}:{value:t.toISOString(),valid:!0}}if(typeof e=="string"){const t=e.trim();return t?{value:t,valid:!0}:{value:null,valid:!0}}return{value:null,valid:!1}}function Vo(e,t){if(!e)return!1;if(!t)return!0;const n=new Date(t);return Number.isNaN(n.getTime())?!1:n.getTime()>Date.now()}function fn({user:e,token:t,expiresAt:n}){const o=ji(e),i=qi(t),{value:r,valid:a}=Vi(n);return!o||!i||!a||!Vo(i,r)?null:{user:o,token:i,expiresAt:r}}function mn(){if(pe&&Vo(pe.token,pe.expiresAt))return pe;pe=null;const e=un();if(!e)return null;const t=e.getItem(xt);if(!t)return null;try{const n=JSON.parse(t),o=fn({user:(n==null?void 0:n.user)??(n==null?void 0:n.usuario)??n,token:n==null?void 0:n.token,expiresAt:n==null?void 0:n.expiresAt});if(o)return pe=o,pe}catch(n){return console.warn("[auth] No se pudo leer la sesión almacenada:",n),null}return e.removeItem(xt),null}function Gi(e){const t=fn({user:(e==null?void 0:e.user)??(e==null?void 0:e.usuario),token:e==null?void 0:e.token,expiresAt:e==null?void 0:e.expiresAt});if(!t)throw new Error("Los datos de sesión son inválidos.");pe=t;const n=un();n&&n.setItem(xt,JSON.stringify(t)),Lt(t.user)}function oo(){pe=null;const e=un();e&&e.removeItem(xt),Lt(null)}function ae(){if(typeof document>"u")return{};const e=document.getElementById("auth-user-panel"),t=document.getElementById("user-menu");let n=null,o=null,i=null,r=null;if(t&&typeof t.querySelector=="function"&&(n=t.querySelector("[data-user-name]")||t.querySelector(".user-menu__user-name")||null,o=t.querySelector('[data-auth-action="help"]'),i=t.querySelector('[data-auth-action="settings"]'),r=t.querySelector("[data-theme-state]")),t&&typeof t.querySelectorAll=="function"){const a=l=>typeof l=="string"?l.trim().toLowerCase():"",c=Array.from(t.querySelectorAll('[role="menuitem"]')||[]);o||(o=c.find(l=>a(l==null?void 0:l.textContent)==="ayuda")||null),i||(i=c.find(l=>a(l==null?void 0:l.textContent)==="configuración")||null),n||(n=c.find(l=>{var d;return(d=l==null?void 0:l.dataset)==null?void 0:d.userName})||null)}return{mainView:document.getElementById("main-view"),loginContainer:document.getElementById("login-container"),form:document.getElementById("login-form"),error:document.getElementById("login-error"),mailInput:document.getElementById("login-mail"),passwordInput:document.getElementById("login-password"),logoutButton:document.getElementById("logout-button"),panel:e,menuButton:document.getElementById("user-menu-toggle"),menu:t,helpLink:o,settingsLink:i,userNameDisplay:n,themeToggle:document.getElementById("theme-toggle"),themeToggleState:r}}function io(e){var i;const{themeToggle:t,themeToggleState:n}=ae();if(!t)return;const o=e===_e;t.checked=o,(i=t.setAttribute)==null||i.call(t,"aria-checked",o?"true":"false"),n&&(n.textContent=o?"Activado":"Desactivado")}function Wi(e){var n,o;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);const t=!!((o=e==null?void 0:e.target)!=null&&o.checked);qo(t?_e:Te)}function Yt(){const{loginContainer:e,error:t,mailInput:n}=ae();e&&e.classList.remove("hidden"),t&&(t.textContent="",t.classList.add("hidden")),n&&n.focus()}function Go(){const{loginContainer:e,form:t,error:n}=ae();e&&e.classList.add("hidden"),t&&t.reset(),n&&(n.textContent="",n.classList.add("hidden"))}function wt(e){const{mainView:t,loginContainer:n}=ae();t&&(e?t.classList.remove("hidden"):t.classList.add("hidden")),n&&(e?n.classList.add("hidden"):n.classList.remove("hidden"))}function ro(e,t){if(!e)return;e.querySelectorAll("input").forEach(i=>{i.disabled=t});const o=e.querySelector('button[type="submit"]');o&&(t?(o.dataset.originalText=o.textContent,o.textContent="Ingresando...",o.disabled=!0):(o.textContent=o.dataset.originalText||"Iniciar sesión",o.disabled=!1,delete o.dataset.originalText))}function Jt(e){const{error:t}=ae();t&&(t.textContent=e,t.classList.remove("hidden"))}function Zi(e,...t){return e?t.some(n=>{if(!n)return!1;if(e===n)return!0;if(typeof n.contains=="function")try{return n.contains(e)}catch{return!1}return!1}):!1}function Ki(){It||typeof document>"u"||typeof document.addEventListener!="function"||(document.addEventListener("click",Wo),document.addEventListener("keydown",Zo),It=!0)}function Yi(){!It||typeof document>"u"||typeof document.removeEventListener!="function"||(document.removeEventListener("click",Wo),document.removeEventListener("keydown",Zo),It=!1)}function Ji(){var n;const{menuButton:e,menu:t}=ae();!e||e.disabled||!t||((n=t.classList)!=null&&n.remove&&t.classList.remove("hidden"),typeof t.setAttribute=="function"&&t.setAttribute("aria-hidden","false"),typeof e.setAttribute=="function"&&e.setAttribute("aria-expanded","true"),Ce=!0,Ki())}function He(e={}){var i;const{focusButton:t=!1}=e,{menuButton:n,menu:o}=ae();Ce=!1,(i=o==null?void 0:o.classList)!=null&&i.add&&o.classList.add("hidden"),typeof(o==null?void 0:o.setAttribute)=="function"&&o.setAttribute("aria-hidden","true"),typeof(n==null?void 0:n.setAttribute)=="function"&&n.setAttribute("aria-expanded","false"),Yi(),t&&typeof(n==null?void 0:n.focus)=="function"&&n.focus()}function Wo(e){if(!Ce)return;const{panel:t,menuButton:n,menu:o}=ae();Zi(e==null?void 0:e.target,t,n,o)||He()}function Zo(e){if(!Ce)return;const t=(e==null?void 0:e.key)||(e==null?void 0:e.code);(t==="Escape"||t==="Esc")&&He({focusButton:!0})}function Xi(e){var n,o;e&&((n=e.preventDefault)==null||n.call(e),(o=e.stopPropagation)==null||o.call(e));const{menuButton:t}=ae();!t||t.disabled||(Ce?He():Ji())}function Qi(e){if(typeof document>"u"||typeof document.dispatchEvent!="function")return;const t={action:e};let n=null;if(typeof window<"u"&&typeof window.CustomEvent=="function"?n=window.CustomEvent:typeof CustomEvent=="function"&&(n=CustomEvent),n){document.dispatchEvent(new n("auth:navigate",{detail:t}));return}if(typeof Event=="function"){const o=new Event("auth:navigate");o.detail=t,document.dispatchEvent(o);return}document.dispatchEvent({type:"auth:navigate",detail:t})}function Ko(e,t){var n,o;e&&((n=e.preventDefault)==null||n.call(e),(o=e.stopPropagation)==null||o.call(e)),He(),Qi(t)}function er(e){Ko(e,"help")}function tr(e){Ko(e,"settings")}function Lt(e){var l,d,f,b,h,y,_,v,w,E,m,L,R,I,F,T,$;const{panel:t,menuButton:n,menu:o,logoutButton:i,userNameDisplay:r}=ae(),a=typeof(e==null?void 0:e.usuario)=="string"?e.usuario.trim():typeof(e==null?void 0:e.nombre)=="string"?e.nombre.trim():"",c=!!a;!t&&!n&&!o&&!i&&!r||(c?((d=(l=t==null?void 0:t.classList)==null?void 0:l.remove)==null||d.call(l,"hidden"),n&&(n.disabled=!1,(f=n.setAttribute)==null||f.call(n,"aria-expanded",Ce?"true":"false")),o&&(Ce?((h=(b=o.classList)==null?void 0:b.remove)==null||h.call(b,"hidden"),(y=o.setAttribute)==null||y.call(o,"aria-hidden","false")):((v=(_=o.classList)==null?void 0:_.add)==null||v.call(_,"hidden"),(w=o.setAttribute)==null||w.call(o,"aria-hidden","true"))),i&&(i.disabled=!1),r&&(r.textContent=a,(m=(E=r.classList)==null?void 0:E.remove)==null||m.call(E,"hidden"))):(r&&(r.textContent="",(R=(L=r.classList)==null?void 0:L.add)==null||R.call(L,"hidden")),He(),(F=(I=t==null?void 0:t.classList)==null?void 0:I.add)==null||F.call(I,"hidden"),n&&(n.disabled=!0,(T=n.setAttribute)==null||T.call(n,"aria-expanded","false")),($=o==null?void 0:o.setAttribute)==null||$.call(o,"aria-hidden","true"),i&&(i.disabled=!0)))}function Xt(){if(we)return we.promise;let e,t;const n=new Promise((o,i)=>{e=o,t=i});return we={promise:n,resolve:e,reject:t},n}function nr(e){we&&typeof we.resolve=="function"&&we.resolve(e),we=null}async function or({mail:e,password:t}){var a,c,l,d;if(!Ae)throw new Error("API_URL no está configurada.");const n={action:"login",mail:typeof e=="string"?e.trim():"",password:typeof t=="string"?t.trim():""};let o;try{o=await fetch(Ae,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(n)})}catch(f){throw(f==null?void 0:f.name)==="AbortError"?new Error("La solicitud de autenticación excedió el tiempo de espera."):f instanceof TypeError?new Error("No se pudo conectar con el servidor de autenticación."):new Error((f==null?void 0:f.message)||"Error inesperado al iniciar sesión.")}if(!o.ok)throw o.status===401||o.status===403?new Error("Mail o contraseña incorrectos"):new Error(`HTTP ${o.status}`);let i;try{i=await o.json()}catch{throw new Error("No se pudo interpretar la respuesta de autenticación.")}if(i.result!=="success")throw new Error("Mail o contraseña incorrectos");const r=fn({user:((a=i.data)==null?void 0:a.usuario)??((c=i.data)==null?void 0:c.user)??i.data,token:(l=i.data)==null?void 0:l.token,expiresAt:(d=i.data)==null?void 0:d.expiresAt});if(!r)throw new Error("Mail o contraseña incorrectos");return r}async function ir(e){e.preventDefault();const{form:t,mailInput:n,passwordInput:o}=ae();if(!t||!(t instanceof HTMLFormElement))return;const i=(n==null?void 0:n.value)||"",r=(o==null?void 0:o.value)||"";if(!i.trim()||!r.trim()){Jt("Completa el mail y la contraseña.");return}ro(t,!0);try{const a=await or({mail:i,password:r});Gi(a),wt(!0),Go(),nr(a)}catch(a){Jt((a==null?void 0:a.message)||"No se pudo iniciar sesión.")}finally{ro(t,!1)}}async function Yo(e){e&&e.preventDefault();const t=mn(),n=typeof(t==null?void 0:t.token)=="string"?t.token.trim():"";try{Ae&&n&&await fetch(Ae,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify({action:"logout",token:n})})}catch{}finally{oo(),wt(!1),Yt(),Xt()}He(),oo(),Yt(),Xt()}function rr(){if(to)return;const{form:e,logoutButton:t,menuButton:n,helpLink:o,settingsLink:i,themeToggle:r}=ae();e&&e.addEventListener("submit",ir),t&&t.addEventListener("click",Yo),n&&n.addEventListener("click",Xi),o&&o.addEventListener("click",er),i&&i.addEventListener("click",tr),r&&(r.addEventListener("change",Wi),no?io(Hi()):no=Ui(io)),to=!0}function ar(){const e=mn();return(typeof(e==null?void 0:e.token)=="string"?e.token.trim():"")||null}async function sr(){rr();const e=mn();return e?(Lt(e.user),wt(!0),Go(),e):(wt(!1),Lt(null),Yt(),Xt())}async function cr(){await Yo(),Jt("Tu sesión ha expirado. Por favor, ingresá de nuevo.")}const ce={mantenimientos:[],mantenimientoEditando:null,clientes:[],clientesLoaded:!1},lr=new Set(["login","version_info"]);async function X(e){if(!Ae)throw new Error("API_URL no está configurada.");const t={...e||{}},n=typeof t.action=="string"?t.action:void 0,o=typeof n=="string"?n.trim():"";if(o&&(t.action=o),!lr.has(o)){const a=ar();if(!a)throw new Error("No hay una sesión activa. Por favor, ingresá de nuevo.");t.token=a}let i;try{i=await fetch(Ae,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(t)})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new Error("La solicitud excedió el tiempo de espera. Inténtalo nuevamente."):a instanceof TypeError?new Error("No se pudo conectar con el servidor. Verifica tu conexión a internet."):new Error((a==null?void 0:a.message)||"Error inesperado al comunicarse con el servidor.")}if(!i.ok)throw new Error(`HTTP ${i.status}`);let r;try{r=await i.json()}catch{throw new Error("No se pudo interpretar la respuesta del servidor.")}if(r.result!=="success"){const a=typeof r.error=="string"?r.error.trim():typeof r.message=="string"?r.message.trim():"";throw a==="Sesión expirada"||a==="Token inválido"?(cr(),new Error("Tu sesión ha expirado. Por favor, ingresá de nuevo.")):new Error(a||"Error desconocido")}return r.data}async function dr(e){return X({action:"guardar",...e})}async function Jo(e){return X({action:"guardar_ablandador",...e??{}})}async function Xo(e){return X({action:"generar_pdf_ablandador",...e??{}})}async function ur(e){return X({action:"buscar",...e})}async function fr(e){return X({action:"actualizar",...e})}async function mr(e){return X({action:"eliminar",id:e})}async function pr(){return X({action:"dashboard"})}async function Qo({forceRefresh:e=!1}={}){if(!e&&ce.clientesLoaded)return ce.clientes;const t=await X({action:"clientes"});if(!Array.isArray(t))throw new Error("La respuesta de clientes no es válida.");return ce.clientes=t,ce.clientesLoaded=!0,ce.clientes}async function gr({page:e=1,pageSize:t=20}={}){return X({action:"obtener_remitos",page:e,pageSize:t})}async function ei(e){return X({action:"crear_remito",...e??{}})}async function hr(e){return X({action:"actualizar_remito",...e??{}})}async function br(e){return X(e&&typeof e=="object"?{action:"eliminar_remito",...e}:{action:"eliminar_remito",remitoId:e})}async function yr(){return X({action:"version_info"})}const _r=Object.freeze(Object.defineProperty({__proto__:null,actualizarMantenimiento:fr,actualizarRemito:hr,buscarMantenimientos:ur,crearRemito:ei,eliminarMantenimiento:mr,eliminarRemito:br,generarPdfAblandador:Xo,guardarMantenimiento:dr,guardarMantenimientoAblandador:Jo,obtenerClientes:Qo,obtenerDashboard:pr,obtenerRemitos:gr,obtenerVersionServidor:yr},Symbol.toStringTag,{value:"Module"}));let $t=null,Ot=null;function Le(e){return document.getElementById(e)}function vr(e=[]){const t=Le("chart-mensual");t&&($t&&$t.destroy(),$t=new Chart(t,{type:"bar",data:{labels:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],datasets:[{label:"Mantenimientos por Mes",data:e,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}}))}function Er(e=[]){const t=Le("chart-tecnicos");t&&(Ot&&Ot.destroy(),Ot=new Chart(t,{type:"pie",data:{labels:e.map(n=>n.tecnico),datasets:[{data:e.map(n=>n.count),backgroundColor:["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 206, 86, 0.5)","rgba(75, 192, 192, 0.5)","rgba(153, 102, 255, 0.5)","rgba(255, 159, 64, 0.5)"],borderWidth:1}]},options:{responsive:!0}}))}function xr(e=[]){const t=Le("tabla-proximos");if(t){if(t.innerHTML="",!e.length){const n=document.createElement("tr"),o=document.createElement("td");o.colSpan=4,o.className="px-6 py-4 text-center",o.textContent="No hay próximos mantenimientos",n.appendChild(o),t.appendChild(n);return}e.forEach(n=>{const o=document.createElement("tr"),i=r=>{const a=document.createElement("td");return a.className="px-6 py-4 whitespace-nowrap",a.textContent=r,a};o.appendChild(i(n.cliente||"N/A")),o.appendChild(i(n.fecha||"N/A")),o.appendChild(i(n.tecnico||"N/A")),o.appendChild(i(`${n.dias_restantes} días`)),t.appendChild(o)})}}function Ir(e){if(!e)return;const t=Le("total-mantenimientos"),n=Le("mantenimientos-mes"),o=Le("proximos-mantenimientos"),i=Le("tecnicos-activos");t&&(t.textContent=e.total??0),n&&(n.textContent=e.esteMes??0),o&&(o.textContent=e.proximos??0),i&&(i.textContent=e.tecnicos??0),vr(Array.isArray(e.mensual)?e.mensual:[]),Er(Array.isArray(e.tecnicosData)?e.tecnicosData:[]),xr(Array.isArray(e.proximosMantenimientos)?e.proximosMantenimientos:[])}function wr(e,t={}){const{obtenerDashboard:n}=e,{showView:o}=t;async function i(){try{const c=await n();Ir(c)}catch(c){console.error("Error cargando dashboard:",c)}}async function r(){typeof o=="function"&&o("tab-dashboard"),await i()}async function a(){await i()}return{initialize:a,show:r,refresh:i}}const pn=[{id:"etapa1",title:"1ª Sedimentos (PP)",placeholder:"Micronaje: __ µm"},{id:"etapa2",title:"2ª Carbón Bloque (CTO)",placeholder:"Modelo/Tipo"},{id:"etapa3",title:"3ª Carbón GAC / PP",placeholder:"Micronaje/Tipo"},{id:"etapa4",title:"4ª Membrana RO",placeholder:"Caudal GPD | S/N",emphasize:!0},{id:"etapa5",title:"5ª Post-Filtro",placeholder:"Tipo: Carbón, Remineralizador..."},{id:"etapa6",title:"6ª Adicional",placeholder:"Tipo: UV, Alcalino..."}];function Lr(e){const t=document.createElement("div");t.className="component-toggle",t.dataset.state="inspeccionado";const n=`${e}_accion_cambiado`,o=`${e}_accion_inspeccionado`,i=document.createElement("input");i.type="radio",i.name=`${e}_accion`,i.value="Cambiado",i.id=n,i.className="component-toggle__input";const r=document.createElement("input");r.type="radio",r.name=`${e}_accion`,r.value="Inspeccionado",r.id=o,r.className="component-toggle__input",r.checked=!0,r.defaultChecked=!0;const a=document.createElement("div");a.className="component-toggle__track";const c=document.createElement("div");c.className="component-toggle__thumb",a.appendChild(c);const l=document.createElement("label");l.setAttribute("for",n),l.className="component-toggle__option component-toggle__option--cambiado",l.textContent="Cambiado";const d=document.createElement("label");return d.setAttribute("for",o),d.className="component-toggle__option component-toggle__option--inspeccionado",d.textContent="Inspeccionado",t.append(i,r,a,l,d),t}function Sr(e,t){const n=e.querySelector(".stage-title");n&&(n.textContent=t.title,t.emphasize&&n.classList.add("font-bold"));const o=e.querySelector(".stage-details");o&&(o.id=`${t.id}_detalles`,o.name=`${t.id}_detalles`,o.placeholder=t.placeholder);const i=e.querySelector(".stage-actions");if(i){const r=Lr(t.id);i.innerHTML="",i.appendChild(r);const a=d=>{r.dataset.state=String(d).toLowerCase()};r.querySelectorAll(".component-toggle__input").forEach(d=>{d.addEventListener("change",()=>{d.checked&&a(d.value)})});const l=r.querySelector(".component-toggle__input:checked");l&&a(l.value)}}function Ar({containerId:e="component-stage-container",templateId:t="component-stage-template"}={}){const n=document.getElementById(e),o=document.getElementById(t);if(!n||!(o instanceof HTMLTemplateElement))return;n.innerHTML="";const i=document.createDocumentFragment();pn.forEach(r=>{const a=o.content.cloneNode(!0);Sr(a,r),i.appendChild(a)}),n.appendChild(i)}const{LMIN_TO_GPD:Tr=60*24/3.78541,LMIN_TO_LPH:Cr=60}=Fi;function O(e){return document.getElementById(e)}const ao="data-cliente-option",Nr=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),Mr=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),pt=Object.freeze({direccion:["direccion","Direccion","domicilio","Domicilio"],telefono:["telefono","Telefono","tel","Tel"],email:["email","Email","mail","Mail","correo","Correo"],cuit:["cuit","CUIT"]}),ti=Object.freeze(["direccion","cliente_telefono","cliente_email","cliente_cuit"]),so="client-detail-empty",co="client-detail-locked",ni="data-auto-resize",Pt="autoResizeBaseWidth",Rr=8,Dr=6,lo=48,uo=new WeakSet,fo=new WeakSet;function Fr(e){return e instanceof HTMLInputElement&&e.hasAttribute(ni)}function ze(e){if(!Fr(e))return;if(!e.dataset[Pt]){const c=Math.max(e.clientWidth||0,e.offsetWidth||0);e.dataset[Pt]=String(c>0?c:lo)}const t=Number(e.dataset[Pt])||lo,n=typeof e.placeholder=="string"?e.placeholder.length:0,o=typeof e.value=="string"?e.value.length:0,i=Math.max(o,n,1);e.style.width="auto";let r=e.scrollWidth;(!r||Number.isNaN(r))&&(r=(Number(e.dataset.autoResizeCharWidth)||Rr)*i);const a=Math.max(t,r+Dr);e.style.width=`${a}px`}function oi(){return typeof document>"u"?[]:Array.from(document.querySelectorAll(`input[${ni}]`))}function $r(){oi().forEach(t=>{ze(t),uo.has(t)||(t.addEventListener("input",()=>ze(t)),uo.add(t))})}function Or(){oi().forEach(ze)}const Ke=new Map;let gt=null;function gn(e){return e==null?"":String(e).trim()}function Fe(e,t){if(!e||typeof e!="object")return"";for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const o=gn(e[n]);if(o)return o}return""}function mo(e){return Fe(e,Nr)}function Pr(e){return Fe(e,Mr)}function zr(e){return{direccion:Fe(e,pt.direccion),telefono:Fe(e,pt.telefono),email:Fe(e,pt.email),cuit:Fe(e,pt.cuit)}}function Qt(e,{lockWhenFilled:t=!1}={}){if(!(e instanceof HTMLInputElement)||!ti.includes(e.id))return;const n=gn(e.value)!=="";t?(e.readOnly=n,e.disabled=n):n||(e.readOnly=!1,e.disabled=!1),n&&(e.disabled||e.readOnly)?e.classList.add(co):e.classList.remove(co),n?e.classList.remove(so):e.classList.add(so)}function kr(){ti.forEach(e=>{const t=O(e);t instanceof HTMLInputElement&&(Qt(t),fo.has(t)||(t.addEventListener("input",()=>{Qt(t)}),fo.add(t)))})}function Br(e,t,n={}){const o=O(e);if(!o)return;const i=gn(t);"value"in o&&(o.value=i),o instanceof HTMLInputElement&&(ze(o),Qt(o,{lockWhenFilled:!!n.lockWhenFilled}))}function ii(e={}){const t={direccion:e.direccion,cliente_telefono:e.telefono,cliente_email:e.email,cliente_cuit:e.cuit};Object.entries(t).forEach(([n,o])=>{Br(n,o,{lockWhenFilled:!0})})}function tt(){ii({})}function po(e){if(!e){tt();return}let t=null;const n=e.selectedOptions&&e.selectedOptions.length>0?e.selectedOptions[0]:null,o=typeof e.selectedIndex=="number"&&e.selectedIndex>=0?e.options[e.selectedIndex]:null;if(n){const r=n.getAttribute("data-cliente-key");r&&(t=Ke.get(r)||null)}if((!t||o&&n&&n!==o)&&o){const r=o.getAttribute("data-cliente-key");if(r){const a=Ke.get(r);a&&(t=a)}}t||(t=Ke.get(e.value)),t?ii(t):tt()}function Hr(){const e=O("cliente");if(!e){tt();return}if(e.options.length>0){const t=e.querySelector('option[value=""]');t?(t.selected=!0,e.value=t.value):e.selectedIndex=0}else e.value="";tt()}function go(e){return String(e).padStart(2,"0")}function Ur(e){return Object.prototype.toString.call(e)==="[object Date]"}function ri(e){return Ur(e)&&!Number.isNaN(e.getTime())}function zt(e,t,n){const o=new Date(e,t,n);return Number.isNaN(o.getTime())||o.getFullYear()!==e||o.getMonth()!==t||o.getDate()!==n?null:o}function Ee(e){return ri(e)?`${e.getFullYear()}-${go(e.getMonth()+1)}-${go(e.getDate())}`:""}function ye(e){if(e==null||e==="")return"";if(ri(e))return Ee(e);if(typeof e=="number")return Ee(new Date(e));if(typeof e=="string"){const t=e.trim();if(!t)return"";let n=t.match(/^(\d{4})-(\d{2})-(\d{2})(?:$|T)/);if(n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),c=zt(i,r-1,a);return c?Ee(c):""}if(n=t.match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/),n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),c=zt(i,r-1,a);return c?Ee(c):""}if(n=t.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{4})$/),n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),c=zt(a,r-1,i);return c?Ee(c):""}const o=new Date(t);return Ee(o)}if(typeof e=="object"){const t=new Date(e);return Ee(t)}return""}function jr(e){if(!e)return"";const[t,n,o]=e.split("-");if(!t||!n||!o)return"";const i=Number(t),r=Number(n),a=Number(o);if(Number.isNaN(i)||Number.isNaN(r)||Number.isNaN(a))return"";const c=new Date(i,r-1,a);return Number.isNaN(c.getTime())?"":c.toLocaleDateString("es-AR",{year:"numeric",month:"2-digit",day:"2-digit"})}function ai(e){const t=ye(e),n=O("fecha");n&&(n.value=t);const o=O("fecha_display");o&&(o.value=jr(t),ze(o))}function si(e){if(!(e instanceof HTMLFormElement))return{};const t=new FormData(e),n={};t.forEach((i,r)=>{Object.prototype.hasOwnProperty.call(n,r)?(Array.isArray(n[r])||(n[r]=[n[r]]),n[r].push(i)):n[r]=i});const o=new Set;return e.querySelectorAll('input[type="radio"][name]').forEach(i=>o.add(i.name)),o.forEach(i=>{Object.prototype.hasOwnProperty.call(n,i)||(n[i]="")}),n}function ci(){ai(new Date)}function hn(){var $,k,G,Q,ne,oe,se,p;const e=parseFloat(($=O("cond_red_found"))==null?void 0:$.value)||0,t=parseFloat((k=O("cond_perm_found"))==null?void 0:k.value)||0,n=parseFloat((G=O("cond_red_left"))==null?void 0:G.value)||0,o=parseFloat((Q=O("cond_perm_left"))==null?void 0:Q.value)||0,i=parseFloat((ne=O("caudal_perm_found"))==null?void 0:ne.value)||0,r=parseFloat((oe=O("caudal_rech_found"))==null?void 0:oe.value)||0,a=parseFloat((se=O("caudal_perm_left"))==null?void 0:se.value)||0,c=parseFloat((p=O("caudal_rech_left"))==null?void 0:p.value)||0,l=e>0?((1-t/e)*100).toFixed(2):"",d=n>0?((1-o/n)*100).toFixed(2):"",f=l?`${l} %`:"",b=d?`${d} %`:"",h=O("rechazo_found"),y=O("rechazo_found_hidden"),_=O("rechazo_left"),v=O("rechazo_left_hidden");h&&(h.value=f),y&&(y.value=f),_&&(_.value=b),v&&(v.value=b);const w=i>0?(r/i).toFixed(1):"",E=a>0?(c/a).toFixed(1):"",m=w?`${w}:1`:"",L=E?`${E}:1`:"",R=O("relacion_found"),I=O("relacion_found_hidden"),F=O("relacion_left"),T=O("relacion_left_hidden");R&&(R.value=m),I&&(I.value=m),F&&(F.value=L),T&&(T.value=L)}function qr(e,t){const n=parseFloat(e.value);if(!Number.isNaN(n)&&n>=0){const o=n*Cr,i=n*Tr;t.textContent=`(${o.toFixed(1)} l/h | ${i.toFixed(0)} GPD)`}else t.textContent=""}function Vr(){[["caudal_perm_found","caudal_perm_found_conv"],["caudal_perm_left","caudal_perm_left_conv"],["caudal_rech_found","caudal_rech_found_conv"],["caudal_rech_left","caudal_rech_left_conv"]].forEach(([t,n])=>{const o=O(t),i=O(n);o&&i&&o.addEventListener("input",()=>qr(o,i))})}const li='select[id$="_found"], select[id$="_left"]',Gr={pasa:"status-pass",no:"status-pass",falla:"status-fail","no pasa":"status-fail",sí:"status-fail",si:"status-fail","n/a":"status-na","no aplica":"status-na",na:"status-na","":"status-na"};function en(e){e.classList.remove("status-pass","status-fail","status-na");const t=String(e.value??"").trim().toLowerCase(),n=Gr[t]||"status-na";e.classList.add(n)}function Wr(){document.querySelectorAll(li).forEach(en)}function Zr(){document.querySelectorAll(li).forEach(t=>{en(t),t.addEventListener("change",()=>en(t))})}const Kr={Realizada:"success","No Realizada":"danger","N/A":"neutral"};function bn(){const e=document.querySelector(".sanitizacion-options");if(!e)return;const t=e.querySelectorAll('input[type="radio"][name="sanitizacion"]');if(!t.length){e.dataset.status="neutral";return}const n=()=>{const o=e.querySelector('input[type="radio"][name="sanitizacion"]:checked'),i=(o==null?void 0:o.value)||"N/A";e.dataset.status=Kr[i]||"neutral"};e.dataset.sanitizacionConfigured||(t.forEach(o=>{o.addEventListener("change",n)}),e.dataset.sanitizacionConfigured="true"),n()}function Yr(){document.querySelectorAll('input[type="number"]').forEach(t=>{t.addEventListener("input",hn)})}function Jr(){["rechazo_found","rechazo_found_hidden","rechazo_left","rechazo_left_hidden","relacion_found","relacion_found_hidden","relacion_left","relacion_left_hidden"].forEach(e=>{const t=O(e);t&&(t.value="")})}function Xr(){["caudal_perm_found_conv","caudal_perm_left_conv","caudal_rech_found_conv","caudal_rech_left_conv"].forEach(e=>{const t=O(e);t&&(t.textContent="")})}function Qr(e,t){const n=new Date(e.getTime());return n.setDate(n.getDate()+t),n}function qe(e,t){const n=O(e);if(!(n instanceof HTMLInputElement)&&!(n instanceof HTMLTextAreaElement))return;n.value=t;const o=new Event("input",{bubbles:!0});n.dispatchEvent(o),n instanceof HTMLInputElement&&ze(n)}function De(e,t){const n=O(e);if(!(n instanceof HTMLSelectElement))return;n.value=t;const o=new Event("change",{bubbles:!0});n.dispatchEvent(o)}function ea(){const e=new Date;ai(e),qe("tecnico","Equipo Técnico Pruebas"),qe("modelo","Sistema RO Residencial 6 etapas"),qe("id_interna","ACT-PRUEBA-042"),qe("n_serie","SN-PRB-998877");const t=Qr(e,180),n=O("proximo_mant");n instanceof HTMLInputElement&&(n.value=ye(t),n.dispatchEvent(new Event("input",{bubbles:!0}))),Object.entries({cond_red_found:480,cond_red_left:460,cond_perm_found:28,cond_perm_left:16,presion_found:2.6,presion_left:3.9,caudal_perm_found:1.9,caudal_perm_left:2.5,caudal_rech_found:3.8,caudal_rech_left:4.3,precarga_found:1.1,precarga_left:1.5}).forEach(([l,d])=>{const f=O(l);f instanceof HTMLInputElement&&(f.value=d,f.dispatchEvent(new Event("input",{bubbles:!0})))}),De("fugas_found","Sí"),De("fugas_left","No"),De("presostato_alta_found","Pasa"),De("presostato_alta_left","Pasa"),De("presostato_baja_found","Pasa"),De("presostato_baja_left","Pasa");const i={etapa1:"Filtro sedimentos 5µm (cambio)",etapa2:'Cartucho CTO 10" reemplazado',etapa3:"GAC + pulido final verificado",etapa4:"Membrana 75 GPD instalada",etapa5:"Postfiltro remineralizador nuevo",etapa6:"UV operativa y sanitizada"};pn.forEach(l=>{const d=`${l.id}_detalles`;qe(d,i[l.id]||l.title);const f=document.getElementById(`${l.id}_accion_cambiado`);f instanceof HTMLInputElement&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))});const r=document.querySelector('input[name="sanitizacion"][value="Realizada"]');r instanceof HTMLInputElement&&(r.checked=!0,r.dispatchEvent(new Event("change",{bubbles:!0})));const a=["Se reemplazaron todos los filtros y se normalizaron los parámetros.","Equipo calibrado tras cambio integral de cartuchos y sanitización completa.","Mantenimiento preventivo completado sin novedades, parámetros dentro de lo esperado.","Cambios realizados y pruebas finales exitosas, equipo queda operativo."],c=document.getElementById("resumen");if(c instanceof HTMLTextAreaElement){const l=a[Math.floor(Math.random()*a.length)];c.value=l,c.dispatchEvent(new Event("input",{bubbles:!0}))}hn(),["caudal_perm_found","caudal_perm_left","caudal_rech_found","caudal_rech_left"].forEach(l=>{const d=O(l);d instanceof HTMLInputElement&&d.dispatchEvent(new Event("input",{bubbles:!0}))}),bn()}function ta(e=[]){const t=O("cliente");if(!t)return;const n=Array.isArray(e)?e:[],o=t.value,i=t.selectedOptions&&t.selectedOptions[0],r=i?i.getAttribute("data-cliente-key"):null,a=t.querySelector('option[value=""]');t.querySelectorAll(`option[${ao}="true"]`).forEach(d=>d.remove()),Ke.clear();const c=document.createDocumentFragment();n.forEach((d,f)=>{if(!d||typeof d!="object")return;const b=Pr(d)||mo(d);if(!b)return;const h=mo(d)||b,y=document.createElement("option");y.value=b,y.textContent=h;const _=`cliente-${f}`;y.setAttribute("data-cliente-key",_),y.setAttribute(ao,"true"),c.appendChild(y),Ke.set(_,zr(d))}),t.appendChild(c),gt&&t.removeEventListener("change",gt),gt=()=>{po(t)},t.addEventListener("change",gt);let l=!1;if(r){const d=t.querySelector(`option[data-cliente-key="${r}"]`);d&&(d.selected=!0,t.value=d.value,l=!0)}!l&&o&&(t.value=o,l=t.value===o&&t.selectedIndex!==-1),l?po(t):(a?(a.selected=!0,t.value=a.value):t.options.length>0?t.selectedIndex=0:t.value="",tt())}function na(){ci(),Yr(),Vr(),Zr(),$r(),kr(),bn(),hn()}function ho(){const e=O("maintenance-form");e&&e.reset(),Hr(),ci(),Jr(),Xr(),Wr(),Or(),bn()}function oa(){const e=O("maintenance-form");if(!(e instanceof HTMLFormElement))return{};const t=si(e),n=e.querySelector('input[name="sanitizacion"]:checked');if(t.sanitizacion=n?n.value:"",Object.prototype.hasOwnProperty.call(t,"fecha")){const i=ye(t.fecha);t.fecha=i||ye(new Date)}return Object.prototype.hasOwnProperty.call(t,"proximo_mant")&&(t.proximo_mant=ye(t.proximo_mant)),["cond_red_found","cond_red_left","cond_perm_found","cond_perm_left","presion_found","presion_left","caudal_perm_found","caudal_perm_left","caudal_rech_found","caudal_rech_left","precarga_found","precarga_left"].forEach(i=>{Object.prototype.hasOwnProperty.call(t,i)&&t[i]===""&&(t[i]=0)}),t}function ia(e){const t=O("report-number-display");t&&(t.textContent=e)}function ra(){const e=new Date,t=o=>String(o).padStart(2,"0");return`REP-${`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}`}function ht(e){return document.getElementById(e)}function aa(e,t={}){const{guardarMantenimiento:n,obtenerClientes:o}=e,{onReportSaved:i,onReportReset:r}=t;let a=!1;function c(){typeof r=="function"&&r()}function l(v){typeof i=="function"&&i(v)}function d(){if(a)return;const v=ht("guardarButton");v&&v.addEventListener("click",m=>{m.preventDefault(),_()});const w=ht("resetButton");w&&w.addEventListener("click",m=>{m.preventDefault(),h()});const E=ht("autoFillButton");E&&E.addEventListener("click",m=>{m.preventDefault(),y()}),a=!0}async function f(){let v=[],w=3,E=500;for(let m=1;m<=w;m++)try{v=await o();break}catch(L){console.warn(`Intento ${m}/${w} de cargar clientes falló:`,L),m<w?(await new Promise(R=>setTimeout(R,E)),E*=2):console.error("Error cargando clientes después de varios intentos:",L)}ta(v)}async function b(){Ar(),await f(),na(),c(),d()}function h(){ho(),c()}function y(){ea()}async function _(){const v=ht("guardarButton");if(!v)return;const w=v.textContent;v.textContent="Guardando...",v.disabled=!0;try{const E=ra(),m=oa();m&&typeof m=="object"&&(m.numero_reporte=E),await n(m),ia(E),l(m),alert("✅ Mantenimiento guardado correctamente en el sistema");try{setTimeout(()=>{try{typeof window<"u"&&typeof window.print=="function"&&window.print()}catch{}try{ho()}catch{}},150)}catch{}}catch(E){console.error("Error al guardar mantenimiento:",E);const m=(E==null?void 0:E.message)||"Error desconocido al guardar los datos.";alert(`❌ Error al guardar los datos: ${m}`)}finally{v.textContent=w,v.disabled=!1}}return{initialize:b,handleGuardarClick:_,handleResetClick:h}}function Ne(e){return document.getElementById(e)}function bo(e){return ye(e)||""}function bt(e){const t=document.createElement("td");return t.className="px-6 py-4 whitespace-nowrap",t.textContent=e,t}function xe(e){return String(e??"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function sa(e,{onEdit:t,onDelete:n}){const o=Ne("tabla-resultados"),i=Ne("resultados-busqueda");if(!(!o||!i)){if(ce.mantenimientos=Array.isArray(e)?e:[],o.innerHTML="",!ce.mantenimientos.length){const r=document.createElement("tr"),a=document.createElement("td");a.colSpan=5,a.className="px-6 py-4 text-center",a.textContent="No se encontraron resultados",r.appendChild(a),o.appendChild(r),i.classList.remove("hidden");return}ce.mantenimientos.forEach(r=>{const a=document.createElement("tr");a.appendChild(bt(r.Cliente||"N/A")),a.appendChild(bt(r.Fecha_Servicio||"N/A")),a.appendChild(bt(r.Tecnico_Asignado||"N/A")),a.appendChild(bt(r.Modelo_Equipo||"N/A"));const c=document.createElement("td");c.className="px-6 py-4 whitespace-nowrap";const l=document.createElement("button");l.type="button",l.className="text-blue-600 hover:text-blue-900 mr-2",l.textContent="Editar",l.addEventListener("click",()=>t(r));const d=document.createElement("button");d.type="button",d.className="text-red-600 hover:text-red-900",d.textContent="Eliminar",d.addEventListener("click",()=>n(r)),c.appendChild(l),c.appendChild(d),a.appendChild(c),o.appendChild(a)}),i.classList.remove("hidden")}}function ca(){const e=Ne("tabla-resultados");e&&(e.innerHTML="");const t=Ne("resultados-busqueda");t&&t.classList.add("hidden"),ce.mantenimientos=[]}function la(e){const t=Ne("modal-edicion"),n=Ne("formulario-edicion");if(!t||!n)return;ce.mantenimientoEditando=e;const o=bo(e.Fecha_Servicio),i=bo(e.Proximo_Mantenimiento);n.innerHTML=`
        <form id="edit-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                    <input type="text" id="edit-cliente" name="cliente" value="${xe(e.Cliente||"")}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Servicio</label>
                    <input type="date" id="edit-fecha" name="fecha_servicio" value="${xe(o)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Técnico</label>
                    <input type="text" id="edit-tecnico" name="tecnico_asignado" value="${xe(e.Tecnico_Asignado||"")}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Próximo Mantenimiento</label>
                    <input type="date" id="edit-proximo-mant" name="proximo_mantenimiento" value="${xe(i)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Conductividad Permeado</label>
                    <input type="number" id="edit-cond-perm" name="conductividad_permeado_left" value="${xe(e.Conductividad_Permeado_Left||0)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Resumen</label>
                    <textarea id="edit-resumen" name="resumen_recomendaciones" rows="3" class="w-full border-gray-300 rounded-md p-2">${xe(e.Resumen_Recomendaciones||"")}</textarea>
                </div>
            </div>
            <input type="hidden" id="edit-id" name="id" value="${xe(e.ID_Unico||"")}">
        </form>
    `,t.classList.remove("hidden")}function yo(){const e=Ne("modal-edicion");e&&e.classList.add("hidden"),ce.mantenimientoEditando=null}function da(){const e=document.getElementById("edit-form");if(!(e instanceof HTMLFormElement))return{};const t=si(e);return Object.prototype.hasOwnProperty.call(t,"conductividad_permeado_left")&&t.conductividad_permeado_left===""&&(t.conductividad_permeado_left=0),Object.prototype.hasOwnProperty.call(t,"fecha_servicio")&&(t.fecha_servicio=ye(t.fecha_servicio)),Object.prototype.hasOwnProperty.call(t,"proximo_mantenimiento")&&(t.proximo_mantenimiento=ye(t.proximo_mantenimiento)),t}function ge(e){return document.getElementById(e)}function ua(e,t={}){const{buscarMantenimientos:n,actualizarMantenimiento:o,eliminarMantenimiento:i}=e,{showView:r}=t;let a=!1;async function c(){var v,w,E;const _={cliente:((v=ge("buscar-cliente"))==null?void 0:v.value)||"",tecnico:((w=ge("buscar-tecnico"))==null?void 0:w.value)||"",fecha:((E=ge("buscar-fecha"))==null?void 0:E.value)||""};try{const m=await n(_);sa(m,{onEdit:d,onDelete:f})}catch(m){console.error("Error buscando mantenimientos:",m);const L=(m==null?void 0:m.message)||"Error desconocido al buscar mantenimientos.";alert(`❌ Error al buscar mantenimientos: ${L}`)}}function l(){["buscar-cliente","buscar-tecnico","buscar-fecha"].forEach(_=>{const v=ge(_);v&&(v.value="")}),ca()}function d(_){_&&la(_)}async function f(_){if(!(!(_!=null&&_.ID_Unico)||!window.confirm("¿Estás seguro de que quieres eliminar este mantenimiento?")))try{await i(_.ID_Unico),alert("✅ Mantenimiento eliminado correctamente"),await c()}catch(w){console.error("Error eliminando mantenimiento:",w),alert("Error al eliminar mantenimiento")}}async function b(){try{const _=da();await o(_),alert("✅ Cambios guardados correctamente"),yo(),await c()}catch(_){console.error("Error guardando cambios:",_),alert("Error al guardar cambios")}}function h(){if(a)return;const _=ge("buscar-btn");_&&_.addEventListener("click",m=>{m.preventDefault(),c()});const v=ge("limpiar-btn");v&&v.addEventListener("click",m=>{m.preventDefault(),l()});const w=ge("cancelar-edicion-btn");w&&w.addEventListener("click",m=>{m.preventDefault(),yo()});const E=ge("guardar-edicion-btn");E&&E.addEventListener("click",m=>{m.preventDefault(),b()}),a=!0}function y(){typeof r=="function"&&r("tab-buscar")}return{initialize:h,show:y,handleBuscarClick:c,handleLimpiarBusqueda:l,handleEditarMantenimiento:d,handleEliminarMantenimiento:f,handleGuardarEdicion:b}}const yn=4,fa=5*1024*1024,_o="https://drive.google.com/uc?export=view&id=",ma=Object.freeze({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/heic":"heic","image/heif":"heif"});function K(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function pa(e){const t=A(e).toLowerCase();return ma[t]||"jpg"}function ga(e,t,n,o){const a=(A(e)||`${t}-foto-${n+1}`).replace(/[\\/]/g,"-").replace(/[^a-zA-Z0-9._-]+/g,"_"),c=pa(o);return a.toLowerCase().endsWith(`.${c}`)?a:`${a.replace(/\.[^.]+$/,"")}.${c}`}function vo(e){const t=A(e);if(!t)return"";try{return`${_o}${encodeURIComponent(t)}`}catch{return`${_o}${t}`}}function ha(e){const t=A(e);if(!t||t.startsWith("data:"))return"";const n=t.match(/[?&]id=([a-zA-Z0-9_-]+)/);if(n&&n[1])return n[1];const o=t.match(/\/d\/([a-zA-Z0-9_-]+)/);return o&&o[1]?o[1]:/^[a-zA-Z0-9_-]{10,}$/.test(t)?t:""}function _n(e=0){return{index:e,previewUrl:"",base64Data:"",mimeType:"",fileName:"",url:"",driveId:"",shouldRemove:!1}}function Eo(){return Array.from({length:yn},(e,t)=>_n(t))}function xo(e=[]){return Array.from({length:yn},(t,n)=>{const o=Array.isArray(e)?e[n]:void 0;return!o||typeof o!="object"?_n(n):{index:Number.isFinite(Number(o.index))?Number(o.index):n,previewUrl:typeof o.previewUrl=="string"?o.previewUrl:"",base64Data:typeof o.base64Data=="string"?o.base64Data:"",mimeType:typeof o.mimeType=="string"?o.mimeType:"",fileName:typeof o.fileName=="string"?o.fileName:"",url:typeof o.url=="string"?o.url:"",driveId:typeof o.driveId=="string"?o.driveId:"",shouldRemove:!!o.shouldRemove}})}function di(e){if(!e||typeof e!="object")return"";const t=A(e.previewUrl);if(t)return t;const n=A(e.driveId||e.driveFileId||e.id);if(n)return vo(n);const o=A(e.url),i=ha(o);return i?vo(i):o}function ui(e){if(!e||typeof e!="object")return"Sin archivo seleccionado";const t=A(e.fileName);if(t)return t;const n=A(e.driveId||e.driveFileId||e.id);if(n)return`Foto en Drive (${n.slice(0,8)}...)`;const o=A(e.url);if(o)try{const r=new URL(o).pathname.split("/");return r[r.length-1]||"Foto subida"}catch{return"Foto subida"}return"Sin archivo seleccionado"}function ba(){return typeof window<"u"&&typeof window.FileReader<"u"}function ya(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=()=>{n(new Error("No se pudo leer el archivo seleccionado."))},o.readAsDataURL(e)})}function _a(e){if(typeof e!="string")throw new Error("No se pudo interpretar la imagen seleccionada.");const t=e.match(/^data:([^;]+);base64,(.+)$/);if(!t)throw new Error("El formato de la imagen no es compatible.");return t[2]}function q(e){return typeof document<"u"?document.getElementById(e):null}function va(e){var o;const t=q(e);if(!(t instanceof HTMLSelectElement))return"";const n=(o=t.selectedOptions)==null?void 0:o[0];return n?n.textContent.trim():""}function Ve(e){const t=q(e);return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?t.value.trim():""}function tn(e){if(!e||typeof e!="object")return{};try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}}function A(e){return e==null?"":String(e).trim()}function ue(e){return!!A(e)}function Ea(e={}){return[e.descripcion,e.detalle,e.detalles,e.title,e.nombre].map(A).filter(Boolean).join(" - ")}function fi(e={}){if(!e||typeof e!="object")return{codigo:"",descripcion:"",cantidad:""};const t=A(e.codigo||e.id||e.codigo_repuesto||e.cod||e.codigoArticulo),n=Ea(e),o=e.cantidad??e.cant??e.unidades??"",i=A(o);if(i){const r=Number(String(i).replace(",","."));if(Number.isFinite(r)&&r>=0)return{codigo:t,descripcion:n,cantidad:String(r)}}return{codigo:t,descripcion:n,cantidad:i}}function xa(e){const t=A(e).toLowerCase();return t?["cambi","reempl","instal","nuevo"].some(o=>t.includes(o)):!1}function Ia(e){return Array.isArray(e)?e.reduce((t,n)=>(n!=null&&n.id&&(t[n.id]=A(n.title)||n.id),t),{}):{}}function wa(e){const t=Array.from({length:6},(i,r)=>`etapa${r+1}`);if(!Array.isArray(e)||e.length===0)return t;const n=e.map(i=>A(i==null?void 0:i.id)).filter(Boolean),o=new Set([...n,...t]);return Array.from(o)}function vn(e,t=pn){if(!e||typeof e!="object")return[];const n=Ia(t);return wa(t).reduce((i,r)=>{const a=`${r}_accion`,c=`${r}_detalles`,l=A(e[a]),d=A(e[c]);return xa(l)&&i.push({accion:l,detalles:d,title:n[r]||r}),i},[])}function nn(e){const t=A(e);if(!t)return"";if(/^\d{2}\/\d{2}\/\d{4}$/.test(t))return t;const n=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(n){const[,i,r,a]=n;return`${a}/${r}/${i}`}const o=Date.parse(t);if(!Number.isNaN(o)){const i=new Date(o),r=String(i.getDate()).padStart(2,"0"),a=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getFullYear());return`${r}/${a}/${c}`}return t}function B(e,t,n=""){if(!e||typeof e!="object")return n;const o=Array.isArray(t)?t:[t];for(const i of o){const r=A(e[i]);if(r)return r}return n}function La(){var n,o,i,r,a;if(typeof window>"u")return"";const e=[],t=c=>{const l=A(c);l&&!e.includes(l)&&e.push(l)};try{const c=(i=(o=(n=window.document)==null?void 0:n.querySelector)==null?void 0:o.call(n,"base[href]"))==null?void 0:i.href;c&&t(new URL("OHM-agua.png",c).href)}catch(c){console.warn("No se pudo determinar la URL del logo del remito desde la etiqueta <base>.",c)}try{const c=(r=window.location)==null?void 0:r.href;c&&t(new URL("OHM-agua.png",c).href)}catch(c){console.warn("No se pudo determinar la URL del logo del remito desde la ubicación actual.",c)}try{const c=(a=window.location)==null?void 0:a.origin;c&&t(new URL("OHM-agua.png",c).href)}catch(c){console.warn("No se pudo determinar la URL del logo del remito desde el origen actual.",c)}return t("/OHM-agua.png"),e.find(Boolean)||""}function Sa(e,t){return Array.isArray(e)&&e.length>0?e:Array.isArray(t==null?void 0:t.repuestos)&&t.repuestos.length>0?t.repuestos:vn(t)}function Aa(e=[]){return!Array.isArray(e)||e.length===0?[]:e.map((t,n)=>{if(!t||typeof t!="object")return null;let i=A(di(t));if(!i){const a=A(t.base64Data),c=A(t.mimeType)||"image/jpeg";a&&(i=`data:${c};base64,${a}`)}if(!i)return null;const r=A(ui(t))||`Foto ${n+1}`;return{src:i,label:r}}).filter(Boolean)}function Ta(e,{observaciones:t="",repuestos:n=[],photoSlots:o=[]}={}){if(!e||typeof e!="object")return null;const i=B(e,["NumeroRemito","numero_remito","remitoNumero","numero_reporte"]),r=nn(B(e,["fecha_display","fecha"])),a={nombre:B(e,["clienteNombre","cliente_nombre","cliente"]),direccion:B(e,["direccion","cliente_direccion","ubicacion"]),telefono:B(e,["cliente_telefono","telefono_cliente","telefono"]),email:B(e,["cliente_email","email"]),cuit:B(e,["cliente_cuit","cuit"])},c={descripcion:B(e,["equipo","modelo","descripcion_equipo"]),modelo:B(e,["modelo","modelo_equipo"]),serie:B(e,["n_serie","numero_serie"]),interno:B(e,["id_interna","codigo_interno"]),ubicacion:B(e,["ubicacion","direccion","cliente_direccion"]),tecnico:B(e,["tecnico","tecnico_asignado"])},l=Sa(n,e),d=Array.isArray(l)?l.map(h=>fi(h)).map(h=>({codigo:A(h.codigo),descripcion:A(h.descripcion),cantidad:A(h.cantidad)})).filter(h=>ue(h.codigo)||ue(h.descripcion)||ue(h.cantidad)):[],f=A(t||e.observaciones||e.resumen||""),b=Aa(o);return{numero:A(i),fecha:A(r),cliente:a,equipo:c,repuestos:d,observaciones:f,fotos:b}}function Io(e=[]){return e.map(t=>{const n=K((t==null?void 0:t.label)||""),o=K(A((t==null?void 0:t.value)||""));return`
                <tr>
                    <th scope="row">${n}</th>
                    <td>${o||'<span class="placeholder">—</span>'}</td>
                </tr>
            `}).join("")}function Ca(e=[]){return!Array.isArray(e)||e.length===0?`
            <tr class="empty-row">
                <td colspan="4">Sin repuestos registrados.</td>
            </tr>
        `:e.map((t,n)=>{const o=K(String(n+1)),i=K(t.codigo),r=K(t.descripcion),a=K(t.cantidad);return`
                <tr>
                    <td class="index">${o}</td>
                    <td>${i||'<span class="placeholder">—</span>'}</td>
                    <td>${r||'<span class="placeholder">—</span>'}</td>
                    <td class="cantidad">${a||'<span class="placeholder">—</span>'}</td>
                </tr>
            `}).join("")}function Na(e=[]){return!Array.isArray(e)||e.length===0?'<p class="placeholder">Sin fotos adjuntas para este remito.</p>':`
        <div class="photo-grid">
            ${e.map((t,n)=>{const o=A(t==null?void 0:t.label)||`Foto ${n+1}`,i=K(o),r=A(t==null?void 0:t.src);if(!r)return"";const a=K(r),c=K(`Registro fotográfico ${o}`);return`
                        <figure class="photo-item">
                            <div class="photo-item__frame">
                                <img src="${a}" alt="${c}" loading="lazy">
                            </div>
                            <figcaption>${i}</figcaption>
                        </figure>
                    `}).join("")}
        </div>
    `}function Ma(e){var d,f,b,h,y,_,v,w,E,m,L;if(!e)return"";const t=K(e.numero||"—"),n=K(e.fecha||"—"),o=K(La()),i=e.observaciones?K(e.observaciones).replace(/\r?\n/g,"<br>"):'<span class="placeholder">Sin observaciones registradas.</span>',r=Io([{label:"Razón social",value:(d=e.cliente)==null?void 0:d.nombre},{label:"Dirección",value:(f=e.cliente)==null?void 0:f.direccion},{label:"Teléfono",value:(b=e.cliente)==null?void 0:b.telefono},{label:"Email",value:(h=e.cliente)==null?void 0:h.email},{label:"CUIT",value:(y=e.cliente)==null?void 0:y.cuit}]),a=Io([{label:"Descripción",value:(_=e.equipo)==null?void 0:_.descripcion},{label:"Modelo",value:(v=e.equipo)==null?void 0:v.modelo},{label:"N° de serie",value:(w=e.equipo)==null?void 0:w.serie},{label:"Activo / ID interno",value:(E=e.equipo)==null?void 0:E.interno},{label:"Ubicación",value:(m=e.equipo)==null?void 0:m.ubicacion},{label:"Técnico responsable",value:(L=e.equipo)==null?void 0:L.tecnico}]),c=Ca(e.repuestos),l=Na(e.fotos);return`<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Remito ${t}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            color-scheme: only light;
        }

        @page {
            size: A4;
            margin: 1.5cm;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #111827;
            background: #f3f4f6;
        }

        .document {
            background: #ffffff;
            padding: 28px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        }

        .document__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 18px;
            margin-bottom: 24px;
        }

        .document__identity {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .document__title {
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .document__meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            color: #374151;
            font-weight: 600;
        }

        .document__logo {
            flex: none;
            max-width: 140px;
        }

        .document__logo img {
            width: 100%;
            height: auto;
            display: block;
        }

        .section {
            margin-bottom: 24px;
        }

        .section__title {
            font-size: 15px;
            font-weight: 700;
            margin: 0 0 12px;
            color: #1f2937;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .info-table,
        .repuestos-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
        }

        .info-table th,
        .info-table td {
            text-align: left;
            padding: 8px 10px;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: top;
        }

        .info-table th {
            width: 32%;
            font-weight: 600;
            background: #f9fafb;
            color: #1f2937;
        }

        .info-table tr:last-child th,
        .info-table tr:last-child td {
            border-bottom: none;
        }

        .repuestos-table thead {
            background: #2563eb;
            color: #ffffff;
        }

        .repuestos-table th,
        .repuestos-table td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .repuestos-table th {
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.05em;
        }

        .repuestos-table td.index {
            width: 48px;
            font-weight: 600;
            text-align: center;
        }

        .repuestos-table td.cantidad {
            text-align: right;
            width: 80px;
            font-weight: 600;
        }

        .repuestos-table tr:last-child td {
            border-bottom: none;
        }

        .placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        .observaciones {
            padding: 16px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            background: #f9fafb;
            min-height: 90px;
            white-space: pre-line;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
        }

        .photo-item {
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .photo-item__frame {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background: #111827;
            aspect-ratio: 3 / 2;
        }

        .photo-item__frame img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #111827;
        }

        .photo-item figcaption {
            font-size: 11px;
            color: #4b5563;
            text-align: center;
        }

        .document__footer {
            margin-top: 32px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
        }

        .firma {
            border-top: 1px solid #9ca3af;
            padding-top: 12px;
            text-align: center;
            color: #6b7280;
        }

        @media print {
            body {
                background: #ffffff;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .document {
                box-shadow: none;
            }

            .document__header {
                margin-bottom: 18px;
            }

            .section {
                page-break-inside: avoid;
            }

            .photo-item {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="document">
        <header class="document__header">
            <div class="document__identity">
                <p class="document__title">Remito de servicio</p>
                <div class="document__meta">
                    <span>Número: <strong>${t}</strong></span>
                    <span>Fecha: <strong>${n}</strong></span>
                </div>
            </div>
            <div class="document__logo">
                <img src="${o}" alt="Logo de OHM Agua">
            </div>
        </header>

        <section class="section">
            <h2 class="section__title">Datos del cliente</h2>
            <table class="info-table">
                <tbody>
                    ${r}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Datos del equipo</h2>
            <table class="info-table">
                <tbody>
                    ${a}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Repuestos y materiales</h2>
            <table class="repuestos-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Código</th>
                        <th>Descripción</th>
                        <th>Cantidad</th>
                    </tr>
                </thead>
                <tbody>
                    ${c}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Observaciones</h2>
            <div class="observaciones">${i}</div>
        </section>

        <section class="section">
            <h2 class="section__title">Registro fotográfico</h2>
            ${l}
        </section>

        <footer class="document__footer">
            <div class="firma">
                <p>Firma del responsable de OHM Agua</p>
            </div>
            <div class="firma">
                <p>Firma y aclaración del cliente</p>
            </div>
        </footer>
    </div>
    <script>
        window.addEventListener('load', () => {
            window.focus();
            setTimeout(() => {
                try {
                    window.print();
                } catch (error) {
                    console.error('No se pudo iniciar la impresión automática.', error);
                }
            }, 150);
        });

        window.addEventListener('afterprint', () => {
            setTimeout(() => {
                window.close();
            }, 250);
        });
    <\/script>
</body>
</html>`}function wo(e,t={}){if(typeof window>"u")return!1;const n=Ta(e,t);if(!n)return!1;const o=Ma(n);if(!o)return!1;const i=window.open("","_blank");if(!i)return!1;try{return i.document.open(),i.document.write(o),i.document.close(),i.opener=null,!0}catch(r){return console.error("No se pudo abrir la vista de impresión del remito.",r),!1}}function J(e,t){const n=q(e);n instanceof HTMLInputElement&&(n.value=A(t),n.readOnly=!0,n.setAttribute("readonly","readonly"))}function Ra(e=[]){e.forEach(t=>{const n=q(t);n instanceof HTMLInputElement&&(n.value="",n.readOnly=!0,n.setAttribute("readonly","readonly"))})}function on(e={},{forceDefaultCantidad:t=!1}={}){if(typeof document>"u")return null;const{codigo:n="",descripcion:o="",cantidad:i=""}=e,r=t&&!ue(i)?"1":i,a=document.createElement("tr");a.className="remito-repuesto-row transition-colors duration-150 hover:bg-gray-50";const c=document.createElement("td");c.className="px-4 py-3 align-top";const l=document.createElement("input");l.type="text",l.name="repuesto-codigo",l.placeholder="Código del repuesto",l.value=n,l.dataset.field="codigo",l.className="repuestos-table-input",c.appendChild(l);const d=document.createElement("td");d.className="px-4 py-3 align-top";const f=document.createElement("input");f.type="text",f.name="repuesto-descripcion",f.placeholder="Descripción del repuesto",f.value=o,f.dataset.field="descripcion",f.className="repuestos-table-input",d.appendChild(f);const b=document.createElement("td");b.className="px-4 py-3 align-top text-right";const h=document.createElement("input");return h.type="number",h.name="repuesto-cantidad",h.placeholder="0",h.inputMode="numeric",h.min="0",h.step="1",h.value=r,h.dataset.field="cantidad",h.className="repuestos-table-input text-right",b.appendChild(h),a.append(c,d,b),a}function vt(e=[]){const t=q("remito-repuestos-body");if(t instanceof HTMLElement){if(t.innerHTML="",!Array.isArray(e)||e.length===0){const n=on();n&&t.appendChild(n);return}e.forEach(n=>{const o=fi(n),i=ue(o.codigo)||ue(o.descripcion)||ue(o.cantidad),r=on(o,{forceDefaultCantidad:i});r&&t.appendChild(r)})}}function Da(e){const t=A(e);if(!t)return"";const n=Number(t.replace(",","."));return Number.isFinite(n)?String(n):t}function Fa(){const e=q("remito-repuestos-body");return e instanceof HTMLElement?Array.from(e.querySelectorAll("tr")).reduce((n,o)=>{const i=Array.from(o.querySelectorAll("input[data-field]"));if(i.length===0)return n;const r={codigo:"",descripcion:"",cantidad:""};return i.forEach(c=>{if(!(c instanceof HTMLInputElement))return;const l=c.dataset.field;l&&(l==="cantidad"?r.cantidad=Da(c.value):r[l]=A(c.value))}),(ue(r.codigo)||ue(r.descripcion)||ue(r.cantidad))&&n.push(r),n},[]):[]}function $a({focus:e=!1}={}){const t=q("remito-repuestos-body");if(!(t instanceof HTMLElement))return;const n=on();if(n&&(t.appendChild(n),e)){const o=n.querySelector("input");o instanceof HTMLInputElement&&o.focus()}}function Oa(e){var n,o,i,r,a,c,l,d,f,b,h,y,_,v,w,E,m,L,R,I,F,T,$,k,G,Q;const t={metadata:e.metadata||{},numero_reporte:((n=e.metadata)==null?void 0:n.numero_reporte)||"",NumeroRemito:"",fecha_display:((o=e.seccion_A_cliente)==null?void 0:o.fecha_servicio)||"",fecha:((i=e.seccion_A_cliente)==null?void 0:i.fecha_servicio)||"",clienteNombre:((r=e.seccion_A_cliente)==null?void 0:r.nombre)||"",cliente_nombre:((a=e.seccion_A_cliente)==null?void 0:a.nombre)||"",direccion:((c=e.seccion_A_cliente)==null?void 0:c.direccion)||"",cliente_direccion:((l=e.seccion_A_cliente)==null?void 0:l.direccion)||"",cliente_telefono:((d=e.seccion_A_cliente)==null?void 0:d.telefono)||"",telefono:((f=e.seccion_A_cliente)==null?void 0:f.telefono)||"",cliente_email:((b=e.seccion_A_cliente)==null?void 0:b.email)||"",email:((h=e.seccion_A_cliente)==null?void 0:h.email)||"",cliente_cuit:((y=e.seccion_A_cliente)==null?void 0:y.cuit)||"",cuit:((_=e.seccion_A_cliente)==null?void 0:_.cuit)||"",equipo:((v=e.seccion_B_equipo)==null?void 0:v.tipo)||"Ablandador",modelo:((w=e.seccion_B_equipo)==null?void 0:w.modelo)||"",modelo_equipo:((E=e.seccion_B_equipo)==null?void 0:E.modelo)||"",n_serie:((m=e.seccion_B_equipo)==null?void 0:m.numero_serie)||"",numero_serie:((L=e.seccion_B_equipo)==null?void 0:L.numero_serie)||"",id_interna:"N/A",codigo_interno:"N/A",ubicacion:((R=e.seccion_B_equipo)==null?void 0:R.ubicacion)||"",tecnico:((I=e.seccion_A_cliente)==null?void 0:I.tecnico)||"",tecnico_asignado:((F=e.seccion_A_cliente)==null?void 0:F.tecnico)||"",observaciones:((T=e.seccion_E_resumen)==null?void 0:T.trabajo_realizado)||"",resumen:(($=e.seccion_E_resumen)==null?void 0:$.trabajo_realizado)||"",componentes:[],repuestos:[]};if((k=e.seccion_D_checklist)!=null&&k.cambio_filtro_realizado){const ne=((G=e.seccion_D_checklist)==null?void 0:G.filtro_tipo_instalado)||"Prefiltro",oe=((Q=e.seccion_D_checklist)==null?void 0:Q.filtro_lote_serie)||"",se={codigo:"",descripcion:oe?`${ne} - Lote: ${oe}`:ne,cantidad:1};t.repuestos.push(se)}else t.repuestos.push({codigo:"",descripcion:"N/A - Consumibles",cantidad:0});return{...t,seccion_A_cliente:e.seccion_A_cliente||null,seccion_B_equipo:e.seccion_B_equipo||null,seccion_C_parametros:e.seccion_C_parametros||null,seccion_D_checklist:e.seccion_D_checklist||null,seccion_E_resumen:e.seccion_E_resumen||null,seccion_F_condiciones:e.seccion_F_condiciones||null,seccion_G_cierre:e.seccion_G_cierre||null}}function Pa(e){var o;if(((o=e==null?void 0:e.metadata)==null?void 0:o.formulario)==="mantenimiento_ablandador")return Oa(e);const t=tn(e);t.clienteNombre||(t.clienteNombre=va("cliente")||t.cliente||t.cliente_nombre),t.direccion=t.direccion||Ve("direccion"),t.cliente_telefono=t.cliente_telefono||Ve("cliente_telefono"),t.cliente_email=t.cliente_email||Ve("cliente_email"),t.cliente_cuit=t.cliente_cuit||Ve("cliente_cuit"),t.fecha_display=t.fecha_display||Ve("fecha_display");const n=vn(t);return t.componentes=n,(!Array.isArray(t.repuestos)||t.repuestos.length===0)&&(t.repuestos=n.map(i=>({...i}))),t}function za(e){var E,m,L,R,I,F,T,$,k,G,Q,ne,oe,se,p,x,N;if(!e||typeof e!="object")return;const t=((E=e.metadata)==null?void 0:E.formulario)==="mantenimiento_ablandador";let n,o,i,r,a,c,l,d,f,b,h,y,_;if(t){n=((m=e.metadata)==null?void 0:m.numero_reporte)||"",o=nn((L=e.seccion_A_cliente)==null?void 0:L.fecha_servicio),i=((R=e.seccion_A_cliente)==null?void 0:R.nombre)||"",r=((I=e.seccion_A_cliente)==null?void 0:I.direccion)||"",a=((F=e.seccion_A_cliente)==null?void 0:F.telefono)||"",c=((T=e.seccion_A_cliente)==null?void 0:T.email)||"",l=(($=e.seccion_A_cliente)==null?void 0:$.cuit)||"";const M=((k=e.seccion_B_equipo)==null?void 0:k.tipo)||"Ablandador";f=((G=e.seccion_B_equipo)==null?void 0:G.modelo)||"",d=f?`${M} - ${f}`:M,b=((Q=e.seccion_B_equipo)==null?void 0:Q.numero_serie)||"",h="N/A",y=((ne=e.seccion_B_equipo)==null?void 0:ne.ubicacion)||"",_=((oe=e.seccion_A_cliente)==null?void 0:oe.tecnico)||""}else n=B(e,["NumeroRemito","numero_remito","remitoNumero","numero_reporte"]),o=nn(B(e,["fecha_display","fecha"])),i=B(e,["clienteNombre","cliente_nombre","cliente"]),r=B(e,["direccion","cliente_direccion","ubicacion"]),a=B(e,["cliente_telefono","telefono_cliente","telefono"]),c=B(e,["cliente_email","email"]),l=B(e,["cliente_cuit","cuit"]),d=B(e,["equipo","modelo","descripcion_equipo"]),f=B(e,["modelo","modelo_equipo"]),b=B(e,["n_serie","numero_serie"]),h=B(e,["id_interna","codigo_interno"]),y=B(e,["ubicacion","direccion","cliente_direccion"]),_=B(e,["tecnico","tecnico_asignado"]);J("remito-numero",n),J("remito-fecha",o),J("remito-cliente-nombre",i),J("remito-cliente-direccion",r),J("remito-cliente-telefono",a),J("remito-cliente-email",c),J("remito-cliente-cuit",l),J("remito-equipo-descripcion",d),J("remito-equipo-modelo",f),J("remito-equipo-serie",b),J("remito-equipo-interno",h),J("remito-equipo-ubicacion",y),J("remito-equipo-tecnico",_);const v=q("remito-observaciones");if(v instanceof HTMLTextAreaElement){let M="";t?M=A(((se=e.seccion_E_resumen)==null?void 0:se.trabajo_realizado)||""):M=A(e.observaciones||e.resumen||""),v.value=M,v.removeAttribute("readonly")}let w=[];if(t)if((p=e.seccion_D_checklist)!=null&&p.cambio_filtro_realizado){const M=((x=e.seccion_D_checklist)==null?void 0:x.filtro_tipo_instalado)||"Prefiltro",D=((N=e.seccion_D_checklist)==null?void 0:N.filtro_lote_serie)||"";w.push({title:"Prefiltro",detalles:D?`${M} - Lote: ${D}`:M,accion:"Cambio"})}else w.push({title:"Consumibles",detalles:"N/A",accion:"Sin cambios"});else{const M=Array.isArray(e.componentes)&&e.componentes.length>0?e.componentes:vn(e);w=Array.isArray(e.repuestos)&&e.repuestos.length>0?e.repuestos:M}vt(w)}function kt(e){const t=q(e);t instanceof HTMLButtonElement&&(t.disabled=!0,t.setAttribute("disabled","disabled"))}function ka(e){const t=q(e);t instanceof HTMLButtonElement&&(t.disabled=!1,t.removeAttribute("disabled"))}function Ba({showView:e}={}){let t=null,n=!1,o=Eo(),i=!1,r=null;function a(){const p=q("remito-fotos-container");return p instanceof HTMLElement?p:null}function c(){const p=q("imprimir-remito-btn");return p instanceof HTMLButtonElement?p:null}function l(p){const x=c();x&&(p?(x.classList.remove("hidden"),x.disabled=!1):(x.classList.add("hidden"),x.disabled=!0))}function d(){if(!t)return null;const p=tn(t),x=xo(o);return{report:p,photoSlots:x}}function f(p){if(!p||typeof p!="object")return"";if(p.sent)return"📧 Se envió el remito por correo electrónico correctamente.";const x=typeof p.error=="string"?p.error.trim():"";if(x)return`⚠️ El remito se generó, pero no se pudo enviar el correo electrónico: ${x}`;if(p.skipped){const N=typeof p.message=="string"?p.message.trim():"";return N?`ℹ️ ${N}`:"ℹ️ El envío de correo electrónico está deshabilitado."}return""}function b(){const p=a();if(!p)return;const x=o.map((N,M)=>{const D=di(N),H=!!D,ie=K(ui(N)),W=["group relative flex w-full items-center justify-center overflow-hidden rounded-xl border-2","min-h-[180px]",H?"border-transparent bg-gray-900/5":"border-dashed border-gray-300 bg-gray-50","text-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"].join(" "),Y=H?`
                        <img src="${K(D)}" alt="Foto ${M+1}" class="max-h-72 max-w-full object-contain mx-auto" loading="lazy">
                    `:`
                        <div class="flex flex-col items-center justify-center gap-2 text-gray-400">
                            <span class="text-5xl font-light leading-none">+</span>
                            <span class="text-xs font-medium">Agregar foto</span>
                        </div>
                    `,V=H?`
                        <button type="button" class="absolute right-3 top-3 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-red-500 shadow-md transition hover:bg-red-50 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2" data-remito-photo-action="remove" data-remito-photo-index="${M}" title="Eliminar foto" aria-label="Eliminar foto">
                            <span aria-hidden="true" class="text-lg leading-none">&times;</span>
                        </button>
                    `:"",Z=`
                    <div class="absolute inset-0 z-10 hidden items-center justify-center rounded-xl bg-black/40 p-4" data-remito-photo-menu="${M}" aria-hidden="true">
                        <button type="button" class="absolute inset-0 cursor-default" data-remito-photo-menu-dismiss></button>
                        <div class="relative z-10 w-full max-w-[220px] space-y-2 rounded-lg bg-white p-4 text-center shadow-lg">
                            <p class="text-sm font-semibold text-gray-700">Seleccioná una opción</p>
                            <button type="button" class="w-full rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-action="capture" data-remito-photo-index="${M}">Tomar foto</button>
                            <button type="button" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-action="upload" data-remito-photo-index="${M}">Subir foto</button>
                            <button type="button" class="w-full rounded-lg border border-transparent bg-gray-100 px-3 py-2 text-sm font-semibold text-gray-600 transition hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-menu-dismiss>Cerrar</button>
                        </div>
                    </div>
                `;return`
                    <div class="remito-photo-slot space-y-2" data-remito-photo-slot="${M}">
                        <div class="flex items-center justify-between gap-2">
                            <p class="text-sm font-medium text-gray-700">Foto ${M+1}</p>
                            <p class="max-w-[60%] truncate text-[11px] text-gray-500">${ie}</p>
                        </div>
                        <div class="relative">
                            <button type="button" class="${W}" data-remito-photo-trigger data-remito-photo-index="${M}" aria-label="Agregar o reemplazar foto ${M+1}">
                                ${Y}
                            </button>
                            ${V}
                            ${Z}
                        </div>
                        <input type="file" accept="image/*" capture="environment" class="hidden" data-remito-photo-input="capture" data-remito-photo-index="${M}">
                        <input type="file" accept="image/*" class="hidden" data-remito-photo-input="upload" data-remito-photo-index="${M}">
                    </div>
                `}).join("");p.innerHTML=x}function h(){o=Eo(),b()}function y(){const p=a();if(!p)return;p.querySelectorAll("[data-remito-photo-menu]").forEach(N=>{N.classList.add("hidden"),N.setAttribute("aria-hidden","true")})}function _(p){const x=a();if(!x)return;const N=Number(p);if(!Number.isFinite(N)||N<0||N>=yn)return;const M=`[data-remito-photo-menu="${N}"]`,D=x.querySelector(M);if(!D)return;const H=D.classList.contains("hidden");y(),H&&(D.classList.remove("hidden"),D.setAttribute("aria-hidden","false"))}function v(p,x){const N=a();if(!N)return;const M=`[data-remito-photo-input="${p}"][data-remito-photo-index="${x}"]`,D=N.querySelector(M);D instanceof HTMLInputElement&&(D.value="",D.click())}function w(p){const x=Number(p);!Number.isFinite(x)||x<0||x>=o.length||(y(),o[x]=_n(x),b())}async function E(p,x){var M,D,H,ie;const N=Number(p);if(!(!Number.isFinite(N)||N<0||N>=o.length)&&x){if(!x.type||!x.type.startsWith("image/")){(M=window.alert)==null||M.call(window,"Solo se pueden cargar archivos de imagen.");return}if(x.size&&x.size>fa){(D=window.alert)==null||D.call(window,"La foto supera el límite de 5 MB permitido.");return}if(!ba()){(H=window.alert)==null||H.call(window,"El navegador no permite procesar imágenes desde este formulario.");return}try{const W=await ya(x),Y=_a(W),V=A(x.type)||"image/jpeg",Z=q("remito-numero"),Re=(Z instanceof HTMLInputElement?A(Z.value):"")||"remito",ve=ga(x.name,Re,N,V);o[N]={index:N,previewUrl:typeof W=="string"?W:"",base64Data:Y,mimeType:V,fileName:ve,url:"",driveId:"",shouldRemove:!1},y(),b()}catch(W){const Y=W instanceof Error?W.message:"No se pudo procesar la foto seleccionada.";(ie=window.alert)==null||ie.call(window,Y)}}}function m(p,x){if(!p)return;const N=Number(x);if(!(!Number.isFinite(N)||N<0||N>=o.length)){if(p==="remove"){w(N);return}(p==="capture"||p==="upload")&&(y(),v(p,N))}}function L(p){var H,ie,W,Y,V,Z,le,Re;if((ie=(H=p.target).closest)==null?void 0:ie.call(H,"[data-remito-photo-menu-dismiss]")){p.preventDefault(),y();return}const N=(Y=(W=p.target).closest)==null?void 0:Y.call(W,"[data-remito-photo-action]");if(N){p.preventDefault();const ve=N.dataset.remitoPhotoAction,fe=N.dataset.remitoPhotoIndex;m(ve,fe);return}const M=(Z=(V=p.target).closest)==null?void 0:Z.call(V,"[data-remito-photo-trigger]");if(M){p.preventDefault(),_(M.dataset.remitoPhotoIndex);return}!!((Re=(le=p.target).closest)!=null&&Re.call(le,"[data-remito-photo-menu]"))||y()}function R(p){const x=p.target;if(!(x instanceof HTMLInputElement)||!x.dataset.remitoPhotoInput)return;const M=Number.parseInt(x.dataset.remitoPhotoIndex??"",10),D=x.files&&x.files[0];Number.isFinite(M)&&D&&E(M,D),x.value=""}function I(){if(i)return;const p=a();p&&(p.addEventListener("click",L),p.addEventListener("change",R),i=!0)}function F(){return o.map((p,x)=>({slot:x+1,base64Data:A(p.base64Data),mimeType:A(p.mimeType)||"image/jpeg",fileName:A(p.fileName)||`remito-foto-${x+1}.jpg`,driveFileId:A(p.driveId)})).filter(p=>!!p.base64Data||!!p.driveFileId)}function T(){var p;return t?!0:(kt("generar-remito-btn"),(p=window.alert)==null||p.call(window,"Primero debés guardar el mantenimiento para generar el remito."),!1)}function $(p){t=Pa(p),ka("generar-remito-btn"),r=null,l(!1)}function k(){t=null,kt("generar-remito-btn"),h(),y(),r=null,l(!1),Ra(["remito-numero","remito-fecha","remito-cliente-nombre","remito-cliente-direccion","remito-cliente-telefono","remito-cliente-email","remito-cliente-cuit","remito-equipo-descripcion","remito-equipo-modelo","remito-equipo-serie","remito-equipo-interno","remito-equipo-ubicacion","remito-equipo-tecnico"]),vt([]);const p=q("remito-observaciones");p instanceof HTMLTextAreaElement&&(p.value="")}function G(){return T()?(h(),y(),za(t),typeof e=="function"&&e("remito-view"),!0):!1}async function Q(){var ie,W,Y;if(!t){(ie=window.alert)==null||ie.call(window,"No hay datos disponibles para generar el remito. Guardá el mantenimiento primero.");return}const p=q("remito-observaciones"),x=p instanceof HTMLTextAreaElement?A(p.value):"",N=Fa();t.repuestos=N,N.length>0&&(t.componentes=[]),t.observaciones=x,vt(N);const M=F(),D=q("finalizar-remito-btn");let H="";D instanceof HTMLButtonElement&&(H=D.textContent||"",D.textContent="Generando remito...",D.disabled=!0);try{const V={reporteData:t,observaciones:x};Array.isArray(M)&&M.length>0&&(V.fotos=M);const Z=await ei(V);if(!Z||typeof Z!="object")throw new Error("Respuesta inválida del servidor.");const le=(Z==null?void 0:Z.data)||{},Re=le==null?void 0:le.emailStatus,ve=A(le==null?void 0:le.NumeroRemito);ve&&(t.NumeroRemito=ve,J("remito-numero",ve)),r=d(),l(!!r);const fe=(r==null?void 0:r.report)||t,Ai=(r==null?void 0:r.photoSlots)||xo(o),Ti=wo(fe,{observaciones:fe==null?void 0:fe.observaciones,repuestos:fe==null?void 0:fe.repuestos,photoSlots:Ai}),je=[];Ti?je.push("✅ Remito generado correctamente. Se abrirá la vista de impresión para descargar o imprimir el PDF."):je.push('✅ Remito generado correctamente. No pudimos abrir la vista de impresión automáticamente. Revisá el bloqueador de ventanas emergentes y utilizá el botón "Imprimir remito" para reintentarlo.');const Yn=f(Re);Yn&&je.push(Yn),je.length>0&&((W=window.alert)==null||W.call(window,je.join(`

`)))}catch(V){console.error("Error al generar el remito:",V);const Z=V instanceof Error?V.message:"Error desconocido al generar el remito.";(Y=window.alert)==null||Y.call(window,`❌ ${Z}`)}finally{D instanceof HTMLButtonElement&&(D.textContent=H||"Finalizar y Guardar Remito",D.disabled=!1)}}function ne(){if(n)return;kt("generar-remito-btn"),vt([]),b(),I(),l(!!r);const p=q("generar-remito-btn");p instanceof HTMLButtonElement&&p.addEventListener("click",D=>{D.preventDefault(),G()});const x=q("finalizar-remito-btn");x instanceof HTMLButtonElement&&x.addEventListener("click",D=>{D.preventDefault(),Q()});const N=c();N&&N.addEventListener("click",D=>{var Y,V;if(D.preventDefault(),!r){(Y=window.alert)==null||Y.call(window,"Generá y guardá un remito antes de intentar imprimirlo.");return}const H=r.report,ie=r.photoSlots||[];wo(H,{observaciones:H==null?void 0:H.observaciones,repuestos:H==null?void 0:H.repuestos,photoSlots:ie})||(V=window.alert)==null||V.call(window,"No pudimos abrir la vista de impresión. Revisá el bloqueador de ventanas emergentes e intentá nuevamente.")});const M=q("remito-agregar-repuesto");M instanceof HTMLButtonElement&&M.addEventListener("click",D=>{D.preventDefault(),$a({focus:!0})}),n=!0}function oe(p){t=p?tn(p):null}function se(){return t}return{initialize:ne,handleMaintenanceSaved:$,reset:k,handleGenerarRemitoClick:G,handleFinalizarRemitoClick:Q,setLastSavedReportForTests:oe,getLastSavedReportForTests:se}}const Ha=20,Me=4,Ua=5*1024*1024,ja=Object.freeze([["Foto1Id","Foto1ID","foto1Id","foto1ID","Foto1URL","Foto1Url","foto1URL","foto1Url","foto1","Foto1","foto_1","Foto_1"],["Foto2Id","Foto2ID","foto2Id","foto2ID","Foto2URL","Foto2Url","foto2URL","foto2Url","foto2","Foto2","foto_2","Foto_2"],["Foto3Id","Foto3ID","foto3Id","foto3ID","Foto3URL","Foto3Url","foto3URL","foto3Url","foto3","Foto3","foto_3","Foto_3"],["Foto4Id","Foto4ID","foto4Id","foto4ID","Foto4URL","Foto4Url","foto4URL","foto4Url","foto4","Foto4","foto_4","Foto_4"]]),Lo="https://drive.google.com/uc?export=view&id=",qa=Object.freeze({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/heic":"heic","image/heif":"heif"});function j(e,t){if(!(!e||typeof e!="object"||!Array.isArray(t)))for(const n of t){if(!n||typeof n!="string")continue;const o=e[n];if(o!=null&&o!=="")return o}}function u(e){if(e==null)return"";if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(Object.prototype.toString.call(e)==="[object Date]"&&!Number.isNaN(e.getTime()))try{return e.toLocaleDateString("es-AR")}catch{return e.toISOString()}return String(e).trim()}function Va(e){if(e==null)return"";if(Object.prototype.toString.call(e)==="[object Date]"&&!Number.isNaN(e.getTime()))try{return e.toLocaleDateString("es-AR")}catch{return e.toISOString()}if(typeof e=="number"){const i=new Date(e);if(!Number.isNaN(i.getTime()))try{return i.toLocaleDateString("es-AR")}catch{return i.toISOString().split("T")[0]||""}return""}if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n)return`${n[3]}/${n[2]}/${n[1]}`;const o=new Date(t);if(!Number.isNaN(o.getTime()))try{return o.toLocaleDateString("es-AR")}catch{return t}return t}function So(e,t){const n=u(e);return n||Va(t)}function z(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function be(e){return u(e)||"—"}function Ga(e){const t=u(e).toLowerCase();return qa[t]||"jpg"}function Wa(e,t,n,o){const a=(u(e)||`${t}-foto-${n+1}`).replace(/[\\/]/g,"-").replace(/[^a-zA-Z0-9._-]+/g,"_"),c=Ga(o);return a.toLowerCase().endsWith(`.${c}`)?a:`${a.replace(/\.[^.]+$/,"")}.${c}`}function nt(e){const t=u(e);if(!t)return"";try{return`${Lo}${encodeURIComponent(t)}`}catch{return`${Lo}${t}`}}function Mt(e){const t=u(e);if(!t||t.startsWith("data:"))return"";const n=t.match(/[?&]id=([a-zA-Z0-9_-]+)/);if(n&&n[1])return n[1];const o=t.match(/\/d\/([a-zA-Z0-9_-]+)/);return o&&o[1]?o[1]:/^[a-zA-Z0-9_-]{10,}$/.test(t)?t:""}function mi(e=0){return{index:e,previewUrl:"",base64Data:"",mimeType:"",fileName:"",url:"",driveId:"",shouldRemove:!1}}function En(){return Array.from({length:Me},(e,t)=>mi(t))}function Ue(e){const t=En();return Array.isArray(e)?t.map((n,o)=>{const i=e[o];if(!i||typeof i!="object")return n;const r=u(i.url),a=u(i.driveId||i.driveFileId)||Mt(r);return{...n,previewUrl:u(i.previewUrl),base64Data:u(i.base64Data),mimeType:u(i.mimeType),fileName:u(i.fileName),url:a?nt(a):r,driveId:a,shouldRemove:!!i.shouldRemove}}):t}function Za(e=[],t=[]){const n=En();return n.forEach((o,i)=>{if(i>=n.length)return;const r=Array.isArray(e)?u(e[i]):"",a=Array.isArray(t)?u(t[i]):"",c=r||Mt(a),l=c?nt(c):a;o.driveId=c,o.url=l}),n}function Ka(e){const t=u(e);if(!t)return"";const n=t.indexOf(",");return n!==-1?t.slice(n+1):t}function Ya(e){if(!e||typeof e!="object")return"";const t=u(e.previewUrl);if(t)return t;const n=u(e.driveId);if(n)return nt(n);const o=u(e.url),i=Mt(o);return i?nt(i):o}function Bt(e){return!e||typeof e!="object"?!1:!!(u(e.previewUrl)||u(e.url)||u(e.driveId)||u(e.base64Data))}function Ja(e){if(!e||typeof e!="object")return"Sin foto seleccionada";if(u(e.fileName))return e.fileName;const t=u(e.driveId);return t?`Foto en Drive (${t.slice(0,8)}...)`:u(e.url)?e.url:"Sin foto seleccionada"}function Xa(){return typeof FileReader<"u"}function Qa(e){return new Promise((t,n)=>{if(!e||typeof FileReader>"u"){n(new Error("La lectura de archivos no es compatible."));return}const o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>n(new Error("No se pudo leer el archivo seleccionado.")),o.readAsDataURL(e)})}const es=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),ts=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),ns=Object.freeze(["direccion","Direccion","domicilio","Domicilio"]),os=Object.freeze(["telefono","Telefono","tel","Tel","celular","Celular"]),is=Object.freeze(["email","Email","mail","Mail","correo","Correo"]),rs=Object.freeze(["cuit","CUIT"]);function as(){const e=new Date;if(Number.isNaN(e.getTime()))return"";const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function ss(e){if(!e||typeof e!="object")return{numeroRemito:"",numeroReporte:"",cliente:"",fechaRemito:"",fechaRemitoISO:"",fechaServicio:"",fechaServicioISO:"",tecnico:"",observaciones:"",direccion:"",telefono:"",email:"",cuit:"",reporteId:""};const t=e.fechaRemitoISO??e.FechaRemitoISO,n=e.fechaServicioISO??e.FechaServicioISO,o=j(e,["numeroRemito","NumeroRemito"]),i=j(e,["numeroReporte","NumeroReporte"]),r=j(e,["cliente","Cliente","NombreCliente"]),a=j(e,["fechaRemito","FechaRemito","FechaCreacion"]),c=j(e,["fechaRemitoISO","FechaRemitoISO","FechaCreacionISO"]),l=j(e,["fechaServicio","FechaServicio"]),d=j(e,["tecnico","Tecnico","MailTecnico"]),f=j(e,["observaciones","Observaciones"]),b=j(e,["direccion","Direccion"]),h=j(e,["telefono","Telefono"]),y=j(e,["email","Email","MailCliente"]),_=j(e,["cuit","CUIT","cliente_cuit"]),v=j(e,["reporteId","ReporteID","IdUnico","IDInterna"]),w=ja.map(L=>u(j(e,L))||""),E=w.map(L=>Mt(L)),m=w.map((L,R)=>{const I=E[R];return I?nt(I):L});return{numeroRemito:u(o),numeroReporte:u(i),cliente:u(r),fechaRemito:So(a,c??t),fechaRemitoISO:u(c??t),fechaServicio:So(l,n),fechaServicioISO:u(n),tecnico:u(d),observaciones:u(f),direccion:u(b),telefono:u(h),email:u(y),cuit:u(_),reporteId:u(v),Foto1Id:E[0]||"",Foto2Id:E[1]||"",Foto3Id:E[2]||"",Foto4Id:E[3]||"",Foto1URL:m[0]||"",Foto2URL:m[1]||"",Foto3URL:m[2]||"",Foto4URL:m[3]||"",fotos:m,fotosDriveIds:E}}function xn(){return{numeroRemito:"",numeroReporte:"",cliente:"",fechaRemitoISO:as(),fechaServicioISO:"",tecnico:"",observaciones:"",direccion:"",telefono:"",email:"",cuit:"",reporteId:"",fotos:En()}}function Ao(e){const t=u(e);if(!t)return"";if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);if(/^\d{2}\/\d{2}\/\d{4}$/.test(t)){const[o,i,r]=t.split("/");return`${r}-${i}-${o}`}const n=new Date(t);return Number.isNaN(n.getTime())?"":n.toISOString().split("T")[0]}function cs(e={}){return{numeroRemito:u(e.numeroRemito),numeroReporte:u(e.numeroReporte),cliente:u(e.cliente),fechaRemitoISO:Ao(e.fechaRemitoISO||e.fechaRemito),fechaServicioISO:Ao(e.fechaServicioISO||e.fechaServicio),tecnico:u(e.tecnico),observaciones:u(e.observaciones),direccion:u(e.direccion),telefono:u(e.telefono),email:u(e.email),cuit:u(e.cuit),reporteId:u(e.reporteId),fotos:Za(Array.isArray(e.fotosDriveIds)?e.fotosDriveIds:[],Array.isArray(e.fotos)?e.fotos:[])}}function ls(e,t,n=0){const o=u(e)||u(t);if(o){const i=o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");if(i)return`cliente-${i}-${n}`}return`cliente-${n}`}function ds(e,t=0){if(!e||typeof e!="object")return null;const n=u(j(e,es)),o=u(j(e,ts)),i=u(j(e,ns)),r=u(j(e,os)),a=u(j(e,is)),c=u(j(e,rs)),l=n||o;if(!l)return null;const d=ls(o,l,t),f=Array.from(new Set([n,o,l].map(b=>u(b).toLowerCase()).filter(b=>!!b)));return{key:d,id:o,label:l,nombre:n||o||"",direccion:i,telefono:r,email:a,cuit:c,matchValues:f}}function us(e=[]){return Array.isArray(e)?e.map((t,n)=>ds(t,n)).filter(t=>t!==null):[]}function pi(e){return!e||!Array.isArray(s.clienteOptions)?null:s.clienteOptions.find(t=>t.key===e)||null}function fs(e){const t=u(e).toLowerCase();return!t||!Array.isArray(s.clienteOptions)?null:s.clienteOptions.find(n=>n.matchValues.includes(t))||null}function rn(){var o;const e=u(s.selectedClienteKey);if(e&&pi(e))return;const t=u((o=s.formData)==null?void 0:o.cliente);if(!t){s.selectedClienteKey="";return}const n=fs(t);s.selectedClienteKey=n?n.key:""}function ms(e){const t=pi(e);s.selectedClienteKey=t?t.key:"",t&&(s.formData.cliente=t.nombre||t.label||"",s.formData.direccion=t.direccion||"",s.formData.telefono=t.telefono||"",s.formData.email=t.email||"",s.formData.cuit=t.cuit||"")}function ps(){if(!Array.isArray(s.clienteOptions)||s.clienteOptions.length===0)return"";const e=u(s.selectedClienteKey);return s.clienteOptions.map(t=>{const n=e&&t.key===e?" selected":"",o=z(t.label||t.nombre||t.id||"");return`<option value="${t.key}"${n}>${o}</option>`}).join("")}function gs(e,t,n){const o=Ya(e),i=!!o,r=z(Ja(e)),a=["group relative flex w-full items-center justify-center overflow-hidden rounded-xl border-2","min-h-[180px]",i?"border-transparent bg-gray-900/5":"border-dashed border-gray-300 bg-gray-50","text-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60"].join(" "),c=i?`
            <img src="${z(o)}" alt="Foto ${t+1}" class="max-h-72 max-w-full object-contain mx-auto" loading="lazy">
        `:`
            <div class="flex flex-col items-center justify-center gap-2 text-gray-400">
                <span class="text-5xl font-light leading-none">+</span>
                <span class="text-xs font-medium">Agregar foto</span>
            </div>
        `,l=i?`
            <button type="button" class="absolute right-3 top-3 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-red-500 shadow-md transition hover:bg-red-50 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="remove" data-remito-photo-index="${t}" title="Eliminar foto" aria-label="Eliminar foto"${n}>
                <span aria-hidden="true" class="text-lg leading-none">&times;</span>
            </button>
        `:"",d=`
        <div class="absolute inset-0 z-10 hidden items-center justify-center rounded-xl bg-black/40 p-4" data-remito-photo-menu="${t}" aria-hidden="true">
            <button type="button" class="absolute inset-0 cursor-default" data-remito-photo-menu-dismiss></button>
            <div class="relative z-10 w-full max-w-[220px] space-y-2 rounded-lg bg-white p-4 text-center shadow-lg">
                <p class="text-sm font-semibold text-gray-700">Seleccioná una opción</p>
                <button type="button" class="w-full rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="capture" data-remito-photo-index="${t}"${n}>Tomar foto</button>
                <button type="button" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="upload" data-remito-photo-index="${t}"${n}>Subir foto</button>
                <button type="button" class="w-full rounded-lg border border-transparent bg-gray-100 px-3 py-2 text-sm font-semibold text-gray-600 transition hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-menu-dismiss>Cerrar</button>
            </div>
        </div>
    `;return`
        <div class="remito-photo-slot space-y-2" data-remito-photo-slot="${t}">
            <div class="flex items-center justify-between gap-2">
                <p class="text-sm font-medium text-gray-700">Foto ${t+1}</p>
                <p class="max-w-[60%] truncate text-[11px] text-gray-500">${r}</p>
            </div>
            <div class="relative">
                <button type="button" class="${a}" data-remito-photo-trigger data-remito-photo-index="${t}" aria-label="Agregar o reemplazar foto ${t+1}"${n}>
                    ${c}
                </button>
                ${l}
                ${d}
            </div>
            <input type="file" accept="image/*" capture="environment" class="hidden" data-remito-photo-input="capture" data-remito-photo-index="${t}"${n}>
            <input type="file" accept="image/*" class="hidden" data-remito-photo-input="upload" data-remito-photo-index="${t}"${n}>
        </div>
    `}function hs(e){var d;const t=e?" disabled":"",n=Ue((d=s.formData)==null?void 0:d.fotos);let o=-1;for(let f=0;f<n.length;f+=1){if(Bt(n[f])&&f===o+1){o=f;continue}if(f===o+1&&!Bt(n[f]))break}let i=-1;for(let f=0;f<n.length;f+=1)Bt(n[f])&&(i=f);const r=Math.min(o+1,Me-1),a=Math.max(r,i),c=Math.max(1,Math.min(n.length,a+1));return`
        <div class="space-y-3">
            <div class="flex flex-col gap-1">
                <span class="text-sm font-medium text-gray-700">Fotos del servicio</span>
                <span class="text-xs text-gray-500">Podés subir hasta cuatro imágenes. Cada archivo puede pesar hasta 5 MB.</span>
            </div>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                ${n.slice(0,c).map((f,b)=>gs(f,b,t)).join("")}
            </div>
        </div>
    `}function ot(){if(typeof document>"u")return;document.querySelectorAll("[data-remito-photo-menu]").forEach(t=>{t.classList.add("hidden"),t.setAttribute("aria-hidden","true")})}function bs(e){if(typeof document>"u")return;const t=Number(e);if(!Number.isFinite(t)||t<0||t>=Me)return;const n=`[data-remito-photo-menu="${t}"]`,o=document.querySelector(n);if(!o)return;const i=o.classList.contains("hidden");ot(),i&&(o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"))}function ys(e={}){const t=u(e.fechaRemitoISO),n=u(e.fechaServicioISO),o=Ue(e.fotos);return{numeroRemito:u(e.numeroRemito),numeroReporte:u(e.numeroReporte),cliente:u(e.cliente),fechaRemito:t,fechaRemitoISO:t,fechaServicio:n,fechaServicioISO:n,tecnico:u(e.tecnico),observaciones:u(e.observaciones),direccion:u(e.direccion),telefono:u(e.telefono),email:u(e.email),cuit:u(e.cuit),reporteId:u(e.reporteId),fotos:o.map((i,r)=>({slot:r+1,url:u(i.url),base64Data:u(i.base64Data),mimeType:u(i.mimeType),fileName:u(i.fileName),driveFileId:u(i.driveId),shouldRemove:!!i.shouldRemove}))}}function _s(e={}){const t=u(e.numeroRemito),n=u(e.numeroReporte),o=u(e.cliente),i=u(e.fechaRemitoISO),r=u(e.fechaRemito)||i,a=u(e.fechaServicioISO),c=u(e.fechaServicio)||a,l=u(e.tecnico),d=u(e.observaciones),f=u(e.direccion),b=u(e.telefono),h=u(e.email),y=u(e.cuit),_=u(e.reporteId),v={NumeroRemito:t||void 0,numero_remito:t||void 0,remitoNumero:t||void 0,NumeroReporte:n||void 0,numero_reporte:n||void 0,numeroReporte:n||void 0,clienteNombre:o||void 0,Cliente:o||void 0,cliente:o||void 0,fecha_display:r||void 0,FechaRemito:r||void 0,FechaRemitoISO:i||void 0,fecha:c||void 0,fecha_servicio:c||void 0,Fecha_Servicio:c||void 0,FechaServicio:c||void 0,FechaServicioISO:a||void 0,tecnico:l||void 0,Tecnico:l||void 0,observaciones:d||void 0,Observaciones:d||void 0,direccion:f||void 0,Direccion:f||void 0,cliente_direccion:f||void 0,cliente_telefono:b||void 0,telefono_cliente:b||void 0,Telefono:b||void 0,cliente_email:h||void 0,email:h||void 0,Email:h||void 0,cliente_cuit:y||void 0,cuit:y||void 0,CUIT:y||void 0,reporteId:_||void 0,ID:_||void 0,Id:_||void 0,ID_Unico:_||void 0},E=Ue(e.fotos).map(m=>u(m.driveId)).filter(m=>!!m);return E.length>0&&(v.fotosDriveIds=E,v.fotos_drive_ids=E,v.fotoIds=E),Object.fromEntries(Object.entries(v).filter(([,m])=>m!==void 0&&m!==""))}function vs(e={}){const t=_s(e);if(!t||Object.keys(t).length===0)throw new Error("No se pudo generar la información del remito para enviarla al servidor.");const n={reporteData:t},o=u(e.observaciones);if(o&&(n.observaciones=o),Array.isArray(e.fotos)){const i=e.fotos.map(r=>{if(!r||typeof r!="object")return null;const a=Number(r.slot),c=u(r.base64Data),l=u(r.mimeType),d=u(r.fileName),f=u(r.url),b=u(r.driveFileId||r.driveId),h=!!r.shouldRemove;if(!c&&!f&&!b&&!h)return null;const y={};return Number.isFinite(a)&&a>0&&(y.slot=a),c&&(y.base64Data=c),l&&(y.mimeType=l),d&&(y.fileName=d),f&&(y.url=f),b&&(y.driveFileId=b),h&&(y.shouldRemove=!0),y}).filter(Boolean);i.length>0&&(n.fotos=i)}return n}function Es(e={}){const t=[];return s.formMode==="edit"&&!u(e.numeroRemito)&&t.push("El número de remito es obligatorio."),u(e.cliente)||t.push("El nombre del cliente es obligatorio."),t}function In(e){return!e||typeof e!="object"?"":u(e.reporteId)||u(e.numeroRemito)}const s={remitos:[],currentPage:1,totalPages:0,totalItems:0,pageSize:Ha,isLoading:!1,lastError:null,viewMode:"list",formMode:"create",formData:xn(),editingRemitoId:null,editingRemitoLabel:"",editingRemitoOriginal:null,isSaving:!1,isDeleting:!1,deletingIndex:null,feedback:null,clienteOptions:[],clientesLoaded:!1,isLoadingClientes:!1,clientesError:null,selectedClienteKey:""};function ct(){(!s.formData||typeof s.formData!="object")&&(s.formData=xn()),s.formData.fotos=Ue(s.formData.fotos)}const gi={obtenerRemitos:async()=>{throw new Error("La función obtenerRemitos no fue provista.")},crearRemito:async()=>{throw new Error("La función crearRemito no fue provista.")},actualizarRemito:async()=>{throw new Error("La función actualizarRemito no fue provista.")},eliminarRemito:async()=>{throw new Error("La función eliminarRemito no fue provista.")},obtenerClientes:async()=>{throw new Error("La función obtenerClientes no fue provista.")}};let ke={...gi};function xs(e={}){ke={...gi,...e||{}}}async function hi({force:e=!1,reRender:t=!1}={}){const n=ke.obtenerClientes;if(typeof n!="function"){s.clienteOptions=[],s.clientesLoaded=!1,s.clientesError="No se configuró la función para obtener clientes.",t&&U();return}if(!s.isLoadingClientes){if(!e&&s.clientesLoaded&&Array.isArray(s.clienteOptions)&&s.clienteOptions.length>0){rn();return}s.isLoadingClientes=!0,t&&U();try{const o=await n({forceRefresh:!!e});s.clienteOptions=us(o),s.clientesLoaded=!0,s.clientesError=null,rn()}catch(o){s.clienteOptions=[],s.clientesLoaded=!1,s.clientesError=(o==null?void 0:o.message)||"No se pudieron cargar los clientes."}finally{s.isLoadingClientes=!1,t&&U()}}}function Rt(){return document.getElementById("remitos-gestion-container")}function Is(){const e=Rt();e&&(e.innerHTML=`
        <div class="flex items-center justify-center rounded-xl border border-gray-200 bg-white p-10 shadow-sm">
            <span class="text-gray-600 text-sm font-medium">Cargando remitos...</span>
        </div>
    `)}function ws(e){const t=Rt();if(!t)return;const n=z(e);t.innerHTML=`
        <div class="rounded-xl border border-red-200 bg-red-50 p-6 shadow-sm">
            <h3 class="text-base font-semibold text-red-700 mb-2">No se pudieron cargar los remitos</h3>
            <p class="text-sm text-red-600 mb-4">${n}</p>
            <button type="button" class="inline-flex items-center rounded-lg border border-red-200 bg-white px-4 py-2 text-sm font-medium text-red-700 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-1" data-remitos-action="reload">
                Reintentar
            </button>
        </div>
    `}function re(e,t){const n=u(t);if(!e||!n){s.feedback=null;return}s.feedback={type:e,message:n}}function Ye({viewMode:e="list"}={}){s.formMode="create",s.formData=xn(),ct(),s.editingRemitoId=null,s.editingRemitoLabel="",s.editingRemitoOriginal=null,s.viewMode=e,s.selectedClienteKey=""}function U(){const e=Rt();if(!e)return;ct();const t=s.isSaving||s.isLoading,n=t?"disabled":"",o=ps(),i=s.isLoadingClientes?"Cargando clientes...":"Seleccioná un cliente",r=s.clientesError?`<p class="mt-1 text-xs text-red-600">${z(s.clientesError)}</p>`:'<p class="mt-1 text-xs text-gray-500">Seleccioná un cliente para completar los datos automáticamente.</p>',a=t||s.isLoadingClientes?"disabled":"",c=s.formMode==="create"&&!u(s.formData.numeroRemito),l=c?' placeholder="Se asignará automáticamente"':"",d=c?'<p class="mt-1 text-xs text-gray-500">Se asignará automáticamente al guardar.</p>':"",f=s.formMode==="edit"&&u(s.formData.numeroReporte)?`
            <div class="flex flex-col gap-1">
                <label for="remito-form-reporte" class="text-sm font-medium text-gray-700">Número de reporte</label>
                <input id="remito-form-reporte" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" value="${z(s.formData.numeroReporte)}" readonly ${n}>
            </div>
        `:"",b=s.formMode==="edit"?s.isSaving?"Guardando cambios...":"Actualizar remito":s.isSaving?"Guardando remito...":"Crear remito",h=s.feedback?`<div class="rounded-lg border ${s.feedback.type==="error"?"border-red-200 bg-red-50 text-red-700":"border-green-200 bg-green-50 text-green-700"} px-4 py-3 text-sm font-medium">${z(s.feedback.message)}</div>`:"",y=s.formMode==="edit"?"Editar remito":"Registrar nuevo remito",_=z(s.editingRemitoLabel||s.formData.numeroRemito||""),v=s.formMode==="edit"?`Estás editando el remito ${_}.`:"Completá los datos para registrar un remito manualmente.",w=[`<button type="button" class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="back-to-list" ${n}>Volver al listado</button>`];s.formMode==="edit"&&w.unshift(`<button type="button" class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="cancel-edit" ${n}>Cancelar edición</button>`);const E=w.join(""),m=hs(t);if(s.viewMode==="form"){e.innerHTML=`
            <div class="space-y-6">
                ${h?`<div>${h}</div>`:""}
                <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                    <div class="border-b border-gray-100 px-6 py-5">
                        <h3 class="text-lg font-semibold text-gray-800">${z(y)}</h3>
                        <p class="mt-1 text-sm text-gray-500">${v}</p>
                    </div>
                    <form id="remito-abm-form" class="space-y-5 px-6 py-6">
                        <div class="space-y-4">
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-numero" class="text-sm font-medium text-gray-700">Número de remito</label>
                                <input id="remito-form-numero" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="numeroRemito" value="${z(s.formData.numeroRemito)}"${l} readonly ${n}>
                                ${d}
                            </div>
                            ${f}
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cliente-select" class="text-sm font-medium text-gray-700">Cliente *</label>
                                <select id="remito-form-cliente-select" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" ${a}>
                                    <option value="">${z(i)}</option>
                                    ${o}
                                </select>
                                ${r}
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cliente" class="text-sm font-medium text-gray-700">Razón social / Cliente *</label>
                                <input id="remito-form-cliente" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="cliente" value="${z(s.formData.cliente)}" placeholder="Nombre del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-fecha" class="text-sm font-medium text-gray-700">Fecha del remito</label>
                                <input id="remito-form-fecha" type="date" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="fechaRemitoISO" value="${z(s.formData.fechaRemitoISO)}" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-tecnico" class="text-sm font-medium text-gray-700">Técnico</label>
                                <input id="remito-form-tecnico" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="tecnico" value="${z(s.formData.tecnico)}" placeholder="Nombre del técnico" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-direccion" class="text-sm font-medium text-gray-700">Dirección</label>
                                <input id="remito-form-direccion" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="direccion" value="${z(s.formData.direccion)}" placeholder="Domicilio del servicio" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-telefono" class="text-sm font-medium text-gray-700">Teléfono</label>
                                <input id="remito-form-telefono" type="tel" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="telefono" value="${z(s.formData.telefono)}" placeholder="Teléfono de contacto" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-email" class="text-sm font-medium text-gray-700">Email</label>
                                <input id="remito-form-email" type="email" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="email" value="${z(s.formData.email)}" placeholder="Correo electrónico del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cuit" class="text-sm font-medium text-gray-700">CUIT</label>
                                <input id="remito-form-cuit" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="cuit" value="${z(s.formData.cuit)}" placeholder="CUIT del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-reporte-id" class="text-sm font-medium text-gray-700">Número de referencia, O.C, Presupuesto</label>
                                <input id="remito-form-reporte-id" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="reporteId" value="${z(s.formData.reporteId)}" placeholder="Identificador asociado" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-observaciones" class="text-sm font-medium text-gray-700">Observaciones</label>
                                <textarea id="remito-form-observaciones" rows="3" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="observaciones" placeholder="Notas adicionales" ${n}>${z(s.formData.observaciones)}</textarea>
                            </div>
                        </div>
                        ${m}
                        <div class="flex flex-col-reverse gap-3 sm:flex-row sm:justify-end">
                            ${E}
                            <button type="submit" class="inline-flex justify-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" ${n}>
                                ${z(b)}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        `;return}const L=s.remitos.length?s.remitos.map((k,G)=>{const Q=z(be(k.numeroRemito)),ne=z(be(k.fechaRemito)),oe=z(be(k.cliente)),se=z(be(k.numeroReporte)),p=s.isDeleting&&s.deletingIndex===G;return`
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-700">${Q}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ne}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${oe}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${se}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center justify-end gap-3">
                                <button type="button" class="text-sm font-semibold text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-detalle="${G}">
                                    Ver detalle
                                </button>
                                <button type="button" class="text-sm font-semibold text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2" data-remito-edit="${G}">
                                    Editar
                                </button>
                                <button type="button" class="text-sm font-semibold text-red-600 hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-delete="${G}" ${p?"disabled":""}>
                                    ${p?"Eliminando...":"Eliminar"}
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join(""):`
            <tr>
                <td colspan="5" class="px-6 py-10 text-center text-sm text-gray-500">
                    No hay remitos registrados todavía. Usá el botón "Crear nuevo remito" para cargar uno.
                </td>
            </tr>
        `,R=s.totalPages>0?`Página ${s.currentPage} de ${s.totalPages}`:"Página 1 de 1",I=(s.currentPage-1)*s.pageSize+1,F=I+s.remitos.length-1,T=s.totalItems>0?`Mostrando ${I} - ${F} de ${s.totalItems} remitos`:"No hay remitos registrados.",$=s.isLoading||s.isSaving?"disabled":"";e.innerHTML=`
        <div class="space-y-6">
            ${h?`<div>${h}</div>`:""}
            <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                <div class="flex flex-col gap-3 border-b border-gray-100 px-6 py-4 md:flex-row md:items-center md:justify-between">
                    <div class="flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-800">Listado de Remitos</h3>
                        <span class="text-sm text-gray-500">${z(R)}</span>
                    </div>
                    <button type="button" class="inline-flex items-center justify-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="open-create" ${$}>
                        Crear nuevo remito
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Número de Remito</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Fecha</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Cliente</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Número de Reporte</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-500">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-white">
                            ${L}
                        </tbody>
                    </table>
                </div>
                <div class="flex flex-col gap-3 border-t border-gray-100 px-6 py-4 md:flex-row md:items-center md:justify-between">
                    <div class="text-sm text-gray-500">${z(T)}</div>
                    <div class="flex items-center gap-3">
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="prev" ${s.currentPage<=1?"disabled":""}>
                            Anterior
                        </button>
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="next" ${s.totalPages===0||s.currentPage>=s.totalPages?"disabled":""}>
                            Siguiente
                        </button>
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remitos-action="reload">
                            Actualizar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Ls(e){if(!Array.isArray(s.remitos)||s.remitos.length===0||!Number.isFinite(e)||e<0||e>=s.remitos.length)return;const t=s.remitos[e];if(!t)return;const n=[`Número de Remito: ${be(t.numeroRemito)}`,`Fecha del Remito: ${be(t.fechaRemito)}`,`Cliente: ${be(t.cliente)}`,`Número de Reporte: ${be(t.numeroReporte)}`];[["Número de referencia, O.C, Presupuesto",t.reporteId],["Fecha del Servicio",t.fechaServicio],["Técnico",t.tecnico],["Dirección",t.direccion],["Teléfono",t.telefono],["Email",t.email],["Observaciones",t.observaciones]].forEach(([r,a])=>{const c=u(a);c&&n.push(`${r}: ${c}`)});const i=n.join(`
`);i&&typeof window<"u"&&typeof window.alert=="function"&&window.alert(i)}function Ss(e){if(!Array.isArray(s.remitos)||s.remitos.length===0||!Number.isFinite(e)||e<0||e>=s.remitos.length)return;const t=s.remitos[e];t&&(s.formMode="edit",s.formData=cs(t),ct(),s.editingRemitoId=In(t),s.editingRemitoLabel=u(t.numeroRemito)||u(t.reporteId),s.editingRemitoOriginal=t,rn(),s.viewMode="form",U(),hi({reRender:!0}))}async function As(e){if(s.isDeleting||s.isSaving||!Array.isArray(s.remitos)||e<0||e>=s.remitos.length)return;const t=s.remitos[e];if(!t)return;const n=In(t);if(!n){re("error","No se pudo determinar el remito a eliminar."),U();return}if(!(typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm(`¿Seguro que querés eliminar el remito ${t.numeroRemito||n}?`))){s.isDeleting=!0,s.deletingIndex=e,U();try{await ke.eliminarRemito({remitoId:n,numeroRemito:t.numeroRemito,reporteId:t.reporteId}),re("success","El remito se eliminó correctamente."),s.formMode==="edit"&&n===s.editingRemitoId&&Ye(),s.isDeleting=!1,s.deletingIndex=null;const r=s.remitos.length-1===0&&s.currentPage>1?s.currentPage-1:s.currentPage;await Oe({page:r})}catch(o){s.isDeleting=!1,s.deletingIndex=null,re("error",(o==null?void 0:o.message)||"No se pudo eliminar el remito."),U()}}}async function Ts(e,t){var o;if(s.isSaving||s.isLoading)return;const n=Number(e);if(!(!Number.isFinite(n)||n<0||n>=Me)&&t){if(!t.type||!t.type.startsWith("image/")){re("error","Solo se pueden cargar archivos de imagen."),U();return}if(t.size&&t.size>Ua){re("error","La foto supera el límite de 5 MB permitido."),U();return}if(!Xa()){re("error","El navegador no permite procesar imágenes desde este formulario."),U();return}try{const i=await Qa(t),r=Ka(i),a=u(t.type)||"image/jpeg",c=u((o=s.formData)==null?void 0:o.numeroRemito)||"remito",l=Wa(t.name,c,n,a);ct();const d=Ue(s.formData.fotos);d[n]={index:n,previewUrl:typeof i=="string"?i:"",base64Data:r,mimeType:a,fileName:l,url:"",driveId:"",shouldRemove:!1},s.formData.fotos=d,re(null),U()}catch(i){re("error",(i==null?void 0:i.message)||"No se pudo procesar la foto seleccionada."),U()}}}function Cs(e){const t=Number(e);if(!Number.isFinite(t)||t<0||t>=Me)return;ot(),ct();const n=Ue(s.formData.fotos),o=n[t],i=!!(o!=null&&o.url);n[t]={...mi(t),shouldRemove:i},s.formData.fotos=n,U()}function Ns(e,t){if(!e)return;const n=Number(t);if(!Number.isFinite(n)||n<0||n>=Me)return;if(e==="remove"){Cs(n);return}if(s.isSaving||s.isLoading||typeof document>"u")return;ot();const o=`[data-remito-photo-input="${e}"][data-remito-photo-index="${n}"]`,i=document.querySelector(o);i&&(i.value="",i.click())}function bi(e){var n,o;const t=(o=(n=e==null?void 0:e.target)==null?void 0:n.dataset)==null?void 0:o.remitoField;!t||!(t in s.formData)||(s.formData[t]=e.target.value)}function Ms(e){bi(e)}function Rs(e){var o;const t=e==null?void 0:e.target;if(!t)return;if((o=t.dataset)==null?void 0:o.remitoPhotoInput){const i=Number.parseInt(t.dataset.remitoPhotoIndex??"",10),r=t.files&&t.files[0];Number.isFinite(i)&&i>=0&&i<Me&&r&&Ts(i,r),t.value="";return}if(t.id==="remito-form-cliente-select"){const i=typeof t.value=="string"?t.value:"";ms(i),U();return}bi(e)}async function Ds(){if(s.isSaving||s.isLoading)return;const e=Es(s.formData);if(e.length>0){re("error",e.join(" ")),U();return}const t=ys(s.formData),n=s.currentPage||1,o=s.formMode==="edit";s.isSaving=!0,U();try{if(o){const i=s.editingRemitoId||In(s.editingRemitoOriginal)||u(s.formData.reporteId)||u(s.formData.numeroRemito);if(!i)throw new Error("No se pudo determinar el remito a actualizar.");await ke.actualizarRemito({...t,remitoId:i}),re("success","El remito se actualizó correctamente.")}else{const i=vs(t),r=await ke.crearRemito(i),a=u((r==null?void 0:r.NumeroRemito)||(r==null?void 0:r.numeroRemito));re("success",a?`El remito ${a} se creó correctamente.`:"El remito se creó correctamente.")}Ye(),s.isSaving=!1,await Oe({page:n})}catch(i){s.isSaving=!1,re("error",(i==null?void 0:i.message)||"No se pudo guardar el remito."),U()}}function Fs(e){e.target&&e.target.id==="remito-abm-form"&&(e.preventDefault(),Ds())}function $s(e){if(!(!e||s.isLoading)){if(e==="prev"){s.currentPage>1&&Oe({page:s.currentPage-1});return}if(e==="next"){s.totalPages>0&&s.currentPage<s.totalPages&&Oe({page:s.currentPage+1});return}if(e==="reload"){const t=s.currentPage&&s.currentPage>0?s.currentPage:1;Oe({page:t});return}if(e==="open-create"){Ye({viewMode:"form"}),U(),hi({reRender:!0});return}if(e==="back-to-list"){Ye({viewMode:"list"}),U();return}if(e==="cancel-edit"){Ye({viewMode:"form"}),U();return}}}function Os(e){if(!!e.target.closest("[data-remito-photo-menu]")||ot(),e.target.closest("[data-remito-photo-menu-dismiss]")){e.preventDefault(),ot();return}const o=e.target.closest("[data-remito-photo-trigger]");if(o){e.preventDefault(),bs(o.dataset.remitoPhotoIndex);return}const i=e.target.closest("[data-remitos-action]");if(i){e.preventDefault(),$s(i.dataset.remitosAction);return}const r=e.target.closest("[data-remito-photo-action]");if(r){e.preventDefault(),Ns(r.dataset.remitoPhotoAction,r.dataset.remitoPhotoIndex);return}const a=e.target.closest("[data-remito-detalle]");if(a){e.preventDefault();const d=Number.parseInt(a.dataset.remitoDetalle,10);Number.isFinite(d)&&Ls(d);return}const c=e.target.closest("[data-remito-edit]");if(c){e.preventDefault();const d=Number.parseInt(c.dataset.remitoEdit,10);Number.isFinite(d)&&Ss(d);return}const l=e.target.closest("[data-remito-delete]");if(l){e.preventDefault();const d=Number.parseInt(l.dataset.remitoDelete,10);Number.isFinite(d)&&As(d)}}async function Oe({page:e}={}){const t=Number.isFinite(Number(e))&&Number(e)>0?Math.floor(Number(e)):s.currentPage&&s.currentPage>0?s.currentPage:1;s.isLoading=!0,s.lastError=null,Is();try{const n=await ke.obtenerRemitos({page:t,pageSize:s.pageSize}),o=Array.isArray(n==null?void 0:n.remitos)?n.remitos:[];s.remitos=o.map(l=>ss(l));const i=Number(n==null?void 0:n.totalPages);s.totalPages=Number.isFinite(i)&&i>=0?i:0;const r=Number(n==null?void 0:n.totalItems);s.totalItems=Number.isFinite(r)&&r>=0?r:s.remitos.length;const a=Number(n==null?void 0:n.pageSize);Number.isFinite(a)&&a>0&&(s.pageSize=Math.floor(a));let c=Number(n==null?void 0:n.currentPage);(!Number.isFinite(c)||c<=0)&&(c=s.totalPages>0?1:0),s.currentPage=c||t,s.isLoading=!1,U()}catch(n){s.lastError=n;const o=(n==null?void 0:n.message)||"No se pudieron obtener los remitos.";s.isLoading=!1,ws(o)}finally{s.isLoading=!1}}function Ps(e={}){xs(e);let t=!1;function n(){if(t)return;const o=Rt();if(!o){console.warn("No se encontró el contenedor de gestión de remitos.");return}o.addEventListener("click",Os),o.addEventListener("input",Ms),o.addEventListener("change",Rs),o.addEventListener("submit",Fs),t=!0}return{initialize:n,renderListado:Oe}}const zs="tab-ablandador",Ht="softener-maintenance-form",ks="softener-save-button",Bs="softener-reset-button",Hs="softener-autofill-button",To="softener-pdf-button",Co="softener-generar-remito-btn",Us="softener-report-number-display",yi="softener-autonomia-recomendada",_i="softener-autonomia-seteo-actual",js="softener-autonomia-ajustada",lt="softener-volumen-resina",Dt="softener-factor-proteccion",dt="softener-dureza-agua-cruda",vi="softener-autonomia-restante",wn="softener-autonomia-restante-info-btn",Ln="softener-autonomia-restante-info-popup",Sn="softener-cabezal-hora-cabezal-found",An="softener-cabezal-hora-cabezal-left",Tn="softener-cabezal-hora-regeneracion-found",Cn="softener-cabezal-hora-regeneracion-left",Nn="softener-cabezal-p1-found",Mn="softener-cabezal-p1-left",Rn="softener-cabezal-p2-found",Dn="softener-cabezal-p2-left",Fn="softener-cabezal-p3-found",$n="softener-cabezal-p3-left",On="softener-cabezal-p4-found",Pn="softener-cabezal-p4-left",it="softener-equipo-regeneracion-tipo",St="softener-cabezal-frecuencia-dias-found",At="softener-cabezal-frecuencia-dias-left",qs="softener-cabezal-frecuencia-container",Tt="softener-equipo-prefiltro",zn="softener-prefilter-info-btn",kn="softener-prefilter-info-popup",Vs="softener-prefiltracion-section",Gs="softener-cambio-filtro-container",ut="softener-check-cambio-filtro",Ws="softener-detalle-cambio-filtro",Bn="softener-filtro-tipo-instalado",Hn="softener-filtro-lote-serie",Un="softener-protection-info-btn",jn="softener-protection-info-popup",Ei="softener-equipo-proteccion-entrada",qn="softener-manometro-info-btn",Vn="softener-manometro-info-popup",rt="softener-equipo-manometros",xi="softener-cliente-nombre",No="data-softener-client-option",Je="data-softener-client-key",Ii=Object.freeze(["softener-cliente-direccion","softener-cliente-telefono","softener-cliente-email","softener-cliente-cuit"]),Mo="client-detail-empty",Ro="client-detail-locked",Zs=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),Ks=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),yt=Object.freeze({direccion:["direccion","Direccion","domicilio","Domicilio"],telefono:["telefono","Telefono","tel","Tel"],email:["email","Email","mail","Mail","correo","Correo"],cuit:["cuit","CUIT"]}),Xe=new Map,Do=new WeakSet;let _t=null,Fo=!1,Ge=null,$o=!1;function g(e){return typeof document<"u"?document.getElementById(e):null}function Ys(e){if(typeof window<"u"&&typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(e);return}setTimeout(e,0)}function Js(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e))return e;const t=String(e).replace(",",".").trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function C(e){const t=g(e);return t&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)?t.value.trim():""}function P(e){return Js(C(e))}function te(e){const t=g(e);return t instanceof HTMLInputElement?!!t.checked:!1}function Xs(e,t){const n=g(e);if(!(n instanceof HTMLInputElement))return;if(t==null||Number.isNaN(t)){n.value="";return}const o=Math.round((t+Number.EPSILON)*100)/100;n.value=Number.isFinite(o)?o.toString():""}function S(e,t){const n=g(e);n&&(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)&&(n.value=t!=null?String(t):"",n.dispatchEvent(new Event("input",{bubbles:!0})))}function ee(e,t){const n=g(e);n instanceof HTMLSelectElement&&(n.value=t!=null?String(t):"",n.dispatchEvent(new Event("change",{bubbles:!0})))}function de(e,t){const n=g(e);!(n instanceof HTMLInputElement)||n.type!=="checkbox"||(n.checked=!!t,n.dispatchEvent(new Event("change",{bubbles:!0})))}function Qs(){const e=new Date,t=l=>String(l).padStart(2,"0"),n=e.getFullYear().toString().slice(-2),o=t(e.getMonth()+1),i=t(e.getDate()),r=t(e.getHours()),a=t(e.getMinutes()),c=t(e.getSeconds());return`ABL-${n}${o}${i}-${r}${a}${c}`}function ec(e){const t=g(Us);t&&(t.textContent=e)}function Gn(e){return e==null?"":String(e).trim()}function $e(e,t){if(!e||typeof e!="object")return"";for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const o=Gn(e[n]);if(o)return o}return""}function Oo(e){return $e(e,Zs)}function tc(e){return $e(e,Ks)}function nc(e){return{direccion:$e(e,yt.direccion),telefono:$e(e,yt.telefono),email:$e(e,yt.email),cuit:$e(e,yt.cuit)}}function an(e,{lockWhenFilled:t=!1}={}){if(!(e instanceof HTMLInputElement))return;const n=Gn(e.value)!=="";t&&n?(e.readOnly=!0,e.disabled=!1):n||(e.readOnly=!1,e.disabled=!1),n?(e.classList.remove(Mo),t&&e.classList.add(Ro)):(e.classList.add(Mo),e.classList.remove(Ro))}function Ze(e,t,n={}){const o=g(e);if(!o)return;const i=Gn(t);"value"in o&&(o.value=i),o instanceof HTMLInputElement&&an(o,{lockWhenFilled:!!n.lockWhenFilled})}function oc(e={}){Ze("softener-cliente-direccion",e.direccion,{lockWhenFilled:!0}),Ze("softener-cliente-telefono",e.telefono,{lockWhenFilled:!0}),Ze("softener-cliente-email",e.email,{lockWhenFilled:!0}),Ze("softener-cliente-cuit",e.cuit,{lockWhenFilled:!0})}function at(){Ii.forEach(e=>{Ze(e,"",{lockWhenFilled:!1})})}function ic(){Ii.forEach(e=>{const t=g(e);t instanceof HTMLInputElement&&(an(t),Do.has(t)||(t.addEventListener("input",()=>{an(t)}),Do.add(t)))})}function Po(e){if(!(e instanceof HTMLSelectElement)){at();return}let t=null;const n=e.selectedOptions&&e.selectedOptions[0];if(n){const o=n.getAttribute(Je);o&&(t=Xe.get(o)||null)}if(!t&&typeof e.selectedIndex=="number"&&e.selectedIndex>=0){const o=e.options[e.selectedIndex];if(o){const i=o.getAttribute(Je);i&&(t=Xe.get(i)||null)}}t||(t=Xe.get(e.value)||null),t?oc(t):at()}function sn(){const e=g(xi);if(!(e instanceof HTMLSelectElement)){at();return}const t=e.querySelector('option[value=""]');t?(t.selected=!0,e.value=t.value):e.options.length>0?e.selectedIndex=0:e.value="",at()}function zo(e=[]){const t=g(xi);if(!(t instanceof HTMLSelectElement))return;const n=Array.isArray(e)?e:[],o=t.value,i=t.selectedOptions&&t.selectedOptions[0],r=i?i.getAttribute(Je):null,a=t.querySelector('option[value=""]');t.querySelectorAll(`option[${No}="true"]`).forEach(d=>d.remove()),Xe.clear();const c=document.createDocumentFragment();n.forEach((d,f)=>{if(!d||typeof d!="object")return;const b=tc(d)||Oo(d);if(!b)return;const h=Oo(d)||b,y=document.createElement("option");y.value=b,y.textContent=h;const _=`softener-cliente-${f}`;y.setAttribute(No,"true"),y.setAttribute(Je,_),c.appendChild(y),Xe.set(_,nc(d))}),t.appendChild(c),_t&&t.removeEventListener("change",_t),_t=()=>{Po(t)},t.addEventListener("change",_t);let l=!1;if(r){const d=t.querySelector(`option[${Je}="${r}"]`);d&&(d.selected=!0,t.value=d.value,l=!0)}!l&&o&&(t.value=o,l=t.value===o&&t.selectedIndex!==-1),l?Po(t):(a?(a.selected=!0,t.value=a.value):t.options.length>0?t.selectedIndex=0:t.value="",at())}async function rc(e){if(!Fo){if(Ge){await Ge;return}typeof e=="function"&&(Ge=(async()=>{let t=3,n=500;for(let o=1;o<=t;o++)try{const i=await e({forceRefresh:!1});zo(i),Fo=!0;return}catch(i){console.warn(`Intento ${o}/${t} de cargar clientes falló:`,i),o<t?(await new Promise(r=>setTimeout(r,n)),n*=2):(console.error("Error al cargar clientes para ablandador después de varios intentos:",i),zo([]))}Ge=null})(),await Ge)}}function ac(e){$o||(ic(),sn(),$o=!0),typeof e=="function"&&rc(e)}function Ut(){const e=g("softener-fecha-servicio");if(e instanceof HTMLInputElement&&!e.value){const t=new Date,n=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10);e.value=n}}function jt(){const e=g(lt);e instanceof HTMLInputElement&&!e.value&&(e.value="25")}function ko(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?e:new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}function me(e){const t={};return e.forEach(([n,o,i])=>{const r=!!(i&&i.includeEmpty);o!==void 0&&(o===""&&!r||o===null&&!r||(t[n]=o))}),t}function Bo(e,t){const n=g(e);n&&"disabled"in n&&(n.disabled=!!t)}function Wn(){const t=C(it)==="Por Tiempo",n=g(qs);if(n&&n.style&&(n.style.display=t?"":"none"),Bo(St,!t),Bo(At,!t),!t){const o=g(St);o&&"value"in o&&(o.value="");const i=g(At);i&&"value"in i&&(i.value="")}}function sc(){const e=g(it);e instanceof HTMLSelectElement&&e.addEventListener("change",Wn)}function qt(){const e=g(zn),t=g(kn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function cc(){const e=g(zn),t=g(kn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function lc(){const e=g(zn),t=g(kn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?cc():qt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||qt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&qt()}))}function Vt(){const e=g(Un),t=g(jn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function dc(){const e=g(Un),t=g(jn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function uc(){const e=g(Un),t=g(jn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?dc():Vt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Vt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Vt()}))}function Gt(){const e=g(qn),t=g(Vn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function fc(){const e=g(qn),t=g(Vn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function mc(){const e=g(qn),t=g(Vn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?fc():Gt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Gt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Gt()}))}function Wt(){const e=g(Ln),t=g(wn);e&&e.classList&&e.classList.add("hidden"),t&&t.setAttribute("aria-expanded","false"),e&&e.setAttribute("aria-hidden","true")}function pc(){const e=g(Ln),t=g(wn);e&&e.classList&&e.classList.remove("hidden"),t&&t.setAttribute("aria-expanded","true"),e&&e.setAttribute("aria-hidden","false")}function gc(){const e=g(wn),t=g(Ln);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?pc():Wt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Wt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Wt()}))}function Ct(){const e=C(Tt),t=g(Vs),n=g(Gs),o=g(Bn),i=e&&e.trim()!==""&&e!=="No Aplica";if(t&&(i?t.classList.remove("hidden"):t.classList.add("hidden")),!!n)if(i)n.classList.remove("hidden"),o&&(o.value=e);else{n.classList.add("hidden");const r=g(ut);r instanceof HTMLInputElement&&(r.checked=!1),wi()}}function wi(){const e=g(ut),t=g(Ws);if(!t)return;if(e instanceof HTMLInputElement&&e.checked)t.classList.remove("hidden");else{t.classList.add("hidden");const o=g(Hn);o instanceof HTMLInputElement&&(o.value="")}}function hc(){const e=g(Tt);e instanceof HTMLSelectElement&&e.addEventListener("change",()=>{Ct()});const t=g(ut);t instanceof HTMLInputElement&&t.addEventListener("change",()=>{wi()})}function cn(){const t=C(rt)==="Manómetros IN / OUT",n=g("softener-presiones-section");n&&(t?n.classList.remove("hidden"):n.classList.add("hidden")),["softener-presion-entrada-found-container","softener-presion-salida-found-container","softener-deltaP-found-container","softener-presion-entrada-left-container","softener-presion-salida-left-container","softener-deltaP-left-container"].forEach(i=>{const r=g(i);r&&r.style&&(r.style.display=t?"":"none")}),t||(["softener-presion-entrada-as-found","softener-presion-salida-as-found","softener-presion-entrada-as-left","softener-presion-salida-as-left"].forEach(r=>{const a=g(r);a&&"value"in a&&(a.value="")}),st("softener-deltaP-found"),st("softener-deltaP-left"))}function bc(){const e=g(rt);e instanceof HTMLSelectElement&&e.addEventListener("change",cn),cn()}function yc(e){return e==null||Number.isNaN(e)?"--":`${Number(e).toFixed(2)} bar`}function st(e){const t=g(e);t&&(t.textContent="--",t.className="inline-block rounded-full px-4 py-2 text-sm font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100")}function Ho(e,t,n){const o=g(e);if(!o)return;if(t==null||Number.isNaN(t)){st(e);return}o.textContent=yc(t);let r="inline-block rounded-full px-4 py-2 text-sm font-semibold";switch(n){case"green":r+=" bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";break;case"yellow":r+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";break;case"red":r+=" bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";break;default:r+=" bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100"}o.className=r}function Nt(){const e=P("softener-presion-entrada-as-found"),t=P("softener-presion-salida-as-found"),n=P("softener-presion-entrada-as-left"),o=P("softener-presion-salida-as-left"),i=e===null||t===null?null:Math.abs(e-t),r=n===null||o===null?null:Math.abs(n-o);function a(c){return c===null?"neutral":c<.3?"green":c<.5?"yellow":"red"}i===null?st("softener-deltaP-found"):Ho("softener-deltaP-found",i,a(i)),r===null?st("softener-deltaP-left"):Ho("softener-deltaP-left",r,a(r))}function _c(){["softener-presion-entrada-as-found","softener-presion-entrada-as-left","softener-presion-salida-as-found","softener-presion-salida-as-left"].forEach(t=>{const n=g(t);n instanceof HTMLInputElement&&n.addEventListener("input",Nt)}),Nt()}function Zt(){const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),o=`${t}:${n}`,i=g(Sn);i&&"value"in i&&(i.value=o);const r=g(An);r&&"value"in r&&(r.value=o);const a=g(Tn);a&&"value"in a&&(a.value="02:00");const c=g(Cn);c&&"value"in c&&(c.value="02:00");const l={[Nn]:"15",[Rn]:"60",[Fn]:"10",[On]:"5",[Mn]:"15",[Dn]:"60",[$n]:"10",[Pn]:"5"};Object.keys(l).forEach(d=>{const f=g(d);f&&"value"in f&&(f.value=l[d])}),Wn()}function vc(){const e=["Industria La Plata S.A.","Laboratorio Farmacéutico del Norte","Hotel & Spa Las Termas","Edificio Residencial Torres del Mar","Complejo Deportivo Municipal"],t=["Av. Principal 1234","Calle Independencia 567","Boulevard San Martín 890","Ruta Nacional 9 Km 45","Parque Industrial Sector B"],n=["La Plata, Buenos Aires","Rosario, Santa Fe","Córdoba Capital","Mendoza, Mendoza","Mar del Plata, Buenos Aires"],o=Math.floor(Math.random()*e.length),i=g("softener-cliente-nombre");if(i instanceof HTMLSelectElement){const T=e[o];let $=!1;for(let k=0;k<i.options.length;k++)if(i.options[k].value===T){$=!0;break}if(!$){const k=document.createElement("option");k.value=T,k.textContent=T,i.appendChild(k)}ee("softener-cliente-nombre",T)}S("softener-cliente-direccion",t[o]),S("softener-cliente-localidad",n[o]),S("softener-cliente-contacto","Juan Pérez"),S("softener-cliente-telefono","011-4567-8900"),S("softener-cliente-email","contacto@cliente.com.ar"),S("softener-cliente-cuit","30-12345678-9");const r=new Date().toISOString().split("T")[0];S("softener-fecha-servicio",r);const a=["Carlos Rodríguez","Miguel Fernández","Roberto García","Fernando López"];S("softener-tecnico",a[Math.floor(Math.random()*a.length)]);const c=["Todo en uno","Custom","Industrial"],l=["ECO-SOFT-50","ULTRA-SOFT-75","DUPLEX-SOFT-100","PREMIUM-SOFT-60"],d=["Lavadero","Patio","Terraza","Gabinete","Sala de Máquinas"];ee("softener-equipo-tipo",c[Math.floor(Math.random()*c.length)]),S("softener-equipo-modelo",l[Math.floor(Math.random()*l.length)]),S("softener-equipo-numero-serie","ABL-2024-"+Math.floor(Math.random()*9e3+1e3)),ee("softener-equipo-ubicacion",d[Math.floor(Math.random()*d.length)]),S(lt,(Math.floor(Math.random()*8)+3)*10),ee(it,Math.random()>.5?"Por Volumen":"Por Tiempo");const f=["No Aplica",'Particulas - Mini Blue (10"x2.5")','Particulas - XL (20"x2.5")','CAB - Mini Blue (10"x2.5")','CAB - Jumbo (10"x4.5")','GAC - Mini Blue (10"x2.5")'];ee(Tt,f[Math.floor(Math.random()*f.length)]);const b=["No Aplica","Sin Protección","VRP","VA","VRP + VA"];ee(Ei,b[Math.floor(Math.random()*b.length)]);const h=["No cuenta con manómetros","Manómetro IN","Manómetros IN / OUT"];ee(rt,h[Math.floor(Math.random()*h.length)]),S("softener-equipo-notas","Equipo en operación normal. Sin novedades reportadas.");const y=[450,520,680,750,820,550,620];S(dt,y[Math.floor(Math.random()*y.length)]),S(vi,Math.floor(Math.random()*200)+50),S(_i,Math.floor(Math.random()*150)+100);const _=Math.random()>.5,v=g(Dt);v instanceof HTMLInputElement&&(v.checked=_);const w=new Date().toTimeString().slice(0,5);S(Sn,w),S(An,w),S(Tn,"02:00"),S(Cn,"02:00"),S(Nn,10),S(Mn,10),S(Rn,60),S(Dn,60),S(Fn,10),S($n,10),S(On,5),S(Pn,5),C(it)==="Por Tiempo"&&(S(St,Math.floor(Math.random()*5)+2),S(At,Math.floor(Math.random()*5)+2)),de("softener-check-fugas",Math.random()>.8);const m=Math.random()>.6;if(de(ut,m),m){const T=C(Tt);S(Bn,T),S(Hn,"LOTE-"+Math.floor(Math.random()*9e3+1e3))}de("softener-check-limpieza-tanque",Math.random()>.7),de("softener-check-nivel-agua",Math.random()>.3),de("softener-check-carga-sal",Math.random()>.4),de("softener-check-hora-correcta",Math.random()>.2),de("softener-check-parametros-ciclo",Math.random()>.3),de("softener-check-ajuste-autonomia",Math.random()>.5),de("softener-check-regeneracion-manual",Math.random()>.8),S("softener-check-otros",""),S("softener-check-observaciones","Sistema funcionando correctamente. Parámetros dentro de rango normal.");const L=["Mantenimiento preventivo completo. Verificación de ciclos y parámetros.","Cambio de prefiltro y ajuste de autonomía según dureza detectada.","Servicio de rutina. Carga de sal y limpieza de tanque salero.","Calibración de cabezal y verificación de presiones del sistema."];S("softener-resumen-trabajo",L[Math.floor(Math.random()*L.length)]);const R=["Monitorear dureza de salida semanalmente.","Verificar nivel de sal mensualmente.","Próximo mantenimiento en 6 meses o según autonomía.","Controlar presiones de entrada periódicamente."];S("softener-resumen-recomendaciones",R[Math.floor(Math.random()*R.length)]);const I=new Date;I.setMonth(I.getMonth()+6),S("softener-resumen-proximo-servicio",I.toISOString().split("T")[0]),S("softener-resumen-materiales","Sal pellets x 25kg, Cartucho prefiltro 5µm"),S("softener-resumen-notas-cliente","Cliente conforme con el servicio realizado."),C(rt)==="Manómetros IN/OUT"&&(S("softener-presion-entrada-as-found",(Math.random()*2+2).toFixed(2)),S("softener-presion-entrada-as-left",(Math.random()*2+2).toFixed(2)),S("softener-presion-salida-as-found",(Math.random()*1.5+1.5).toFixed(2)),S("softener-presion-salida-as-left",(Math.random()*1.5+1.5).toFixed(2))),ee("softener-nivel-sal-as-found",["Adecuado","Bajo","Alto"][Math.floor(Math.random()*3)]),ee("softener-nivel-sal-as-left","Adecuado"),ee("softener-temperatura-ambiente",["Controlada","Alta (>30°C)","Variable"][Math.floor(Math.random()*3)]),ee("softener-estado-gabinete",["Óptimo","Bueno","Regular"][Math.floor(Math.random()*3)]),S("softener-param-test-cloro-found",(Math.random()*2).toFixed(2)),S("softener-param-test-cloro-left",(Math.random()*2).toFixed(2)),S("softener-param-dureza-salida-found",Math.floor(Math.random()*30)),S("softener-param-dureza-salida-left",Math.floor(Math.random()*20)),S("softener-condiciones-observaciones","Ambiente controlado. Sin exposición a humedad excesiva."),ee("softener-conformidad-cliente",["Conforme","Con observaciones"][Math.floor(Math.random()*2)]),S("softener-representante-cliente","Responsable de Mantenimiento"),ee("softener-medio-confirmacion",["Firma en sitio","Correo electrónico"][Math.floor(Math.random()*2)]),de("softener-requiere-seguimiento",Math.random()>.7),S("softener-observaciones-finales","Servicio completado satisfactoriamente."),Ie(),Wn(),Ct(),cn(),Nt(),Nt()}function Ec(){const e=Qs(),t={formulario:"mantenimiento_ablandador",version:"3.1",generado_en:new Date().toISOString(),numero_reporte:e},n=me([["nombre",C("softener-cliente-nombre")],["direccion",C("softener-cliente-direccion")],["localidad",C("softener-cliente-localidad")],["contacto",C("softener-cliente-contacto")],["telefono",C("softener-cliente-telefono")],["email",C("softener-cliente-email")],["cuit",C("softener-cliente-cuit")],["fecha_servicio",ko(C("softener-fecha-servicio"))],["tecnico",C("softener-tecnico")]]),o=P(lt),i=P(dt),r=P(vi),a=P(yi),c=P(_i),l=te(Dt),d=te(js),f=P("softener-param-presion-entrada-found"),b=P("softener-param-presion-entrada-left"),h=P("softener-param-test-cloro-found"),y=P("softener-param-test-cloro-left"),_=P("softener-param-dureza-salida-found"),v=P("softener-param-dureza-salida-left"),w=me([["tipo",C("softener-equipo-tipo")],["modelo",C("softener-equipo-modelo")],["numero_serie",C("softener-equipo-numero-serie")],["ubicacion",C("softener-equipo-ubicacion")],["volumen_resina",o],["notas_equipo",C("softener-equipo-notas")],["tipo_regeneracion",C(it)],["prefiltro",C("softener-equipo-prefiltro")],["proteccion_entrada",C(Ei)],["manometros",C(rt)]]),E=me([["presion_entrada_as_found",f],["presion_entrada_as_left",b],["test_cloro_entrada_as_found",h],["test_cloro_entrada_as_left",y],["dureza_salida_as_found",_],["dureza_salida_as_left",v]]),m=me([["dureza_agua_cruda",i],["autonomia_restante",r],["seteo_actual_autonomia",c],["aplicar_proteccion_20",l],["autonomia_recomendada",a],["autonomia_ajustada_valor_calculado",d]]),L=me([["inspeccion_fugas",te("softener-check-fugas")],["cambio_filtro_realizado",te(ut)],["filtro_tipo_instalado",C(Bn)],["filtro_lote_serie",C(Hn)],["limpieza_tanque_sal",te("softener-check-limpieza-tanque")],["verificacion_nivel_agua",te("softener-check-nivel-agua")],["carga_sal",te("softener-check-carga-sal")],["verificacion_hora",te("softener-check-hora-correcta")],["verificacion_parametros_ciclo",te("softener-check-parametros-ciclo")],["ajuste_autonomia",te("softener-check-ajuste-autonomia")],["regeneracion_manual",te("softener-check-regeneracion-manual")],["otros",C("softener-check-otros")],["observaciones",C("softener-check-observaciones")]]),R=me([["trabajo_realizado",C("softener-resumen-trabajo")],["recomendaciones",C("softener-resumen-recomendaciones")],["proximo_servicio",ko(C("softener-resumen-proximo-servicio"))],["materiales",C("softener-resumen-materiales")],["comentarios_cliente",C("softener-resumen-notas-cliente")]]),I=me([["presion_entrada_as_found",P("softener-presion-entrada-as-found")],["presion_entrada_as_left",P("softener-presion-entrada-as-left")],["presion_salida_as_found",P("softener-presion-salida-as-found")],["presion_salida_as_left",P("softener-presion-salida-as-left")],["nivel_sal_as_found",C("softener-nivel-sal-as-found")],["nivel_sal_as_left",C("softener-nivel-sal-as-left")],["temperatura_ambiente",C("softener-temperatura-ambiente")],["estado_gabinete",C("softener-estado-gabinete")],["observaciones",C("softener-condiciones-observaciones")]]),F=me([["conformidad_cliente",C("softener-conformidad-cliente")],["representante_cliente",C("softener-representante-cliente")],["medio_confirmacion",C("softener-medio-confirmacion")],["requiere_seguimiento",te("softener-requiere-seguimiento")],["observaciones_finales",C("softener-observaciones-finales")]]),T={metadata:t,seccion_A_cliente:n,seccion_B_equipo:w,seccion_C_parametros:m,seccion_D_checklist:L,seccion_E_resumen:R,seccion_F_condiciones:I,seccion_G_cierre:F};Object.keys(E).length>0&&(T.seccion_B_parametros_operacion=E);const $=me([["hora_cabezal_as_found",C(Sn)],["hora_cabezal_as_left",C(An)],["hora_regeneracion_as_found",C(Tn)],["hora_regeneracion_as_left",C(Cn)],["p1_retrolavado_min_found",P(Nn)],["p1_retrolavado_min_left",P(Mn)],["p2_salmuera_min_found",P(Rn)],["p2_salmuera_min_left",P(Dn)],["p3_enjuague_min_found",P(Fn)],["p3_enjuague_min_left",P($n)],["p4_llenado_salero_min_found",P(On)],["p4_llenado_salero_min_left",P(Pn)],["frecuencia_dias_found",P(St)],["frecuencia_dias_left",P(At)]]);return Object.keys($).length>0&&(T.seccion_C_cabezal=$),T}function Ie(){const e=P(lt),t=P(dt),n=te(Dt);let o=null;if(e!==null&&t!==null&&t>0){const i=t/10;if(i>0){const r=e*6/i;Number.isFinite(r)&&(o=n?r*.8:r)}}Xs(yi,o),xc(t)}function xc(e){const t=g(dt),n=g("softener-dureza-warning");if(!t)return;const o=e!==null&&e>=650;o?(t.classList.remove("border-gray-300","focus:border-emerald-500","focus:ring-emerald-200"),t.classList.add("border-red-500","focus:border-red-600","focus:ring-red-200","bg-red-50","dark:bg-red-900/20")):(t.classList.remove("border-red-500","focus:border-red-600","focus:ring-red-200","bg-red-50","dark:bg-red-900/20"),t.classList.add("border-gray-300","focus:border-emerald-500","focus:ring-emerald-200")),n&&(o?n.classList.remove("hidden"):n.classList.add("hidden"))}function Ic(e={}){const{showView:t,guardarMantenimientoAblandador:n,obtenerClientes:o,remitoModule:i,onMaintenanceSaved:r}=e;let a=!1,c=null;const l=typeof n=="function"?n:Jo,d=typeof o=="function"?o:Qo;function f(){[lt,dt].forEach(R=>{const I=g(R);I instanceof HTMLInputElement&&I.addEventListener("input",Ie)});const L=g(Dt);L instanceof HTMLInputElement&&L.addEventListener("change",Ie)}function b(){const m=g(Ht);if(!(m instanceof HTMLFormElement))return;m.addEventListener("reset",()=>{Ys(()=>{sn(),Ut(),jt(),Zt(),Ie(),Ct()})});const L=g(ks);L instanceof HTMLButtonElement&&L.addEventListener("click",async $=>{$.preventDefault(),await _(L)});const R=g(Bs);R instanceof HTMLButtonElement&&R.addEventListener("click",()=>{setTimeout(()=>{sn(),Ut(),jt(),Zt(),Ie()},0)});const I=g(Hs);I instanceof HTMLButtonElement&&I.addEventListener("click",$=>{$.preventDefault(),vc()});const F=g(To);F instanceof HTMLButtonElement&&F.addEventListener("click",async $=>{$.preventDefault(),await y(F)});const T=g(Co);T instanceof HTMLButtonElement&&T.addEventListener("click",$=>{$.preventDefault(),h()})}function h(){if(!c){alert("⚠️ Primero debés guardar el mantenimiento antes de generar el remito.");return}i&&typeof i.handleGenerarRemitoClick=="function"?i.handleGenerarRemitoClick():alert("⚠️ El módulo de remito no está disponible.")}async function y(m){if(!c){alert("⚠️ Primero debes guardar el mantenimiento antes de generar el PDF.");return}const L=m.textContent;m.disabled=!0,m.textContent="Generando PDF...";try{const R=await Xo({payload:c});console.log("Respuesta PDF:",R);const I=(R==null?void 0:R.data)||R;if(I!=null&&I.success||I!=null&&I.pdfGenerated){const F=I.numeroReporte||"SIN-ID",T=I.drive;if(T!=null&&T.url&&(T!=null&&T.fileId)){const $=`✅ PDF generado y guardado en Drive exitosamente!

Reporte N°: ${F}
Archivo: ${T.fileName||"PDF"}

¿Deseas abrir el PDF?`;confirm($)&&window.open(T.url,"_blank")}else(T==null?void 0:T.saved)===!1?alert(`✅ PDF generado correctamente.

Reporte N°: ${F}

⚠️ No se pudo guardar en Drive: ${T.message||"Error desconocido"}`):alert(`✅ PDF generado correctamente.

Reporte N°: ${F}`)}else throw new Error((I==null?void 0:I.message)||"Respuesta inesperada del servidor")}catch(R){console.error("Error al generar PDF de ablandador:",R);const I=(R==null?void 0:R.message)||"No se pudo generar el PDF.";alert(`❌ Error: ${I}`)}finally{m.disabled=!1,m.textContent=L}}async function _(m){var I;if(!(g(Ht)instanceof HTMLFormElement)){alert("El formulario de mantenimiento de ablandador no está disponible.");return}const R=m.textContent;m.disabled=!0,m.textContent="Guardando...";try{Ie();const F=Ec();if(typeof l!="function")throw new Error("Servicio de mantenimiento de ablandador no disponible.");await l({payload:F});const T=((I=F.metadata)==null?void 0:I.numero_reporte)||"ABL-PENDIENTE";ec(T),c=F;const $=g(To);$ instanceof HTMLButtonElement&&($.disabled=!1);const k=g(Co);k instanceof HTMLButtonElement&&(k.disabled=!1),typeof r=="function"&&r(F),alert(`✅ Mantenimiento de ablandador guardado correctamente.

Reporte N°: ${T}

Ahora podés generar el PDF o el Remito.
Si querés crear un nuevo reporte, refrescá la página.`)}catch(F){console.error("Error al guardar mantenimiento de ablandador:",F);const T=(F==null?void 0:F.message)||"No se pudieron guardar los datos del mantenimiento.";alert(`❌ Error al guardar los datos: ${T}`)}finally{m.disabled=!1,m.textContent=R}}function v(){a||!(g(Ht)instanceof HTMLFormElement)||(Ut(),jt(),Ie(),Ct(),ac(d),f(),sc(),lc(),uc(),mc(),gc(),hc(),bc(),_c(),Zt(),b(),a=!0)}function w(){v()}function E(){v(),typeof t=="function"&&t(zs)}return{initialize:w,show:E}}const{guardarMantenimiento:wc,guardarMantenimientoAblandador:Lc,buscarMantenimientos:Sc,actualizarMantenimiento:Ac,eliminarMantenimiento:Tc,obtenerDashboard:Cc,obtenerClientes:Zn,obtenerRemitos:Nc,crearRemito:Mc,actualizarRemito:Rc,eliminarRemito:Dc,obtenerVersionServidor:Fc}=_r;Bi();const Se=Ba({showView:Be}),$c=aa({guardarMantenimiento:wc,obtenerClientes:Zn},{onReportSaved:e=>{Se.handleMaintenanceSaved(e)},onReportReset:()=>{Se.reset()}}),Oc=ua({buscarMantenimientos:Sc,actualizarMantenimiento:Ac,eliminarMantenimiento:Tc},{showView:Be}),Pc=wr({obtenerDashboard:Cc},{showView:Be}),Li=Ps({obtenerRemitos:Nc,crearRemito:Mc,actualizarRemito:Rc,eliminarRemito:Dc,obtenerClientes:Zn}),zc=Ic({showView:Be,guardarMantenimientoAblandador:Lc,obtenerClientes:Zn,remitoModule:Se,onMaintenanceSaved:e=>{Se&&typeof Se.handleMaintenanceSaved=="function"&&Se.handleMaintenanceSaved(e)}}),he={maintenance:$c,remito:Se,search:Oc,dashboard:Pc,remitosGestion:Li,softener:zc};function Qe(e,t){e&&(typeof t=="string"&&t.trim()?(e.textContent=t.trim(),e.classList.remove("hidden")):(e.textContent="",e.classList.add("hidden")))}function kc(){const e=document.getElementById("app-version");if(e){{const t="1.0.0".trim();if(t){Qe(e,`Frontend v${t}`);return}}Qe(e,"")}}function Bc(e){if(!e)return"";if(typeof e=="string"){const i=e.trim();return i?`Scripts ${i}`:""}if(typeof e!="object")return"";const t=e,n=[];t.versionNumber!==void 0&&t.versionNumber!==null&&n.push(`#${t.versionNumber}`),typeof t.description=="string"&&t.description.trim()&&n.push(t.description.trim()),!n.length&&typeof t.label=="string"&&t.label.trim()&&n.push(t.label.trim()),!n.length&&typeof t.deploymentId=="string"&&t.deploymentId.trim()&&n.push(`ID ${t.deploymentId.trim()}`);let o=n.join(" – ");if(typeof t.generatedAt=="string"){const i=new Date(t.generatedAt);if(!Number.isNaN(i.getTime())){const r=(navigator==null?void 0:navigator.language)||"es-AR",a=i.toLocaleString(r,{dateStyle:"short",timeStyle:"short"});a&&(o=o?`${o} · ${a}`:a)}}return o?`Scripts ${o}`:""}async function Hc(){const e=document.getElementById("script-version");if(e)try{const t=await Fc(),n=Bc(t);n?Qe(e,n):Qe(e,"Scripts versión no disponible")}catch(t){console.error("No se pudo obtener la versión de los scripts:",t),Qe(e,"Scripts versión no disponible")}}function ft(e,t){document.querySelectorAll(".tab-button").forEach(o=>o.classList.remove("active"));let n=null;typeof t=="string"&&t&&(n=document.getElementById(t)),!n&&typeof e=="string"&&e&&(n=document.getElementById(`tab-${e}-btn`)),n&&n.classList.add("active")}function Uc(){Be("tab-nuevo"),ft("nuevo")}function jc(){he.softener.show(),ft("nuevo")}function Kn(){return{modal:document.getElementById("maintenance-type-modal"),backdrop:document.getElementById("maintenance-type-backdrop")}}function qc(){const{modal:e,backdrop:t}=Kn();t&&t.classList.remove("hidden"),e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"))}function We(){const{modal:e,backdrop:t}=Kn();t&&t.classList.add("hidden"),e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"))}function Vc(){he.search.show(),ft("buscar")}async function Si(){ft("dashboard"),await he.dashboard.show()}function Gc(){const e=document.getElementById("tab-nuevo-btn");e&&e.addEventListener("click",()=>{qc()});const t=document.getElementById("tab-buscar-btn");t&&t.addEventListener("click",()=>{Vc()});const n=document.getElementById("tab-dashboard-btn");n&&n.addEventListener("click",()=>{Si()});const o=document.getElementById("nav-remitos-btn");o&&o.addEventListener("click",()=>{Be("remitos-gestion-view"),ft(null,"nav-remitos-btn"),Li.renderListado({page:1})});const i=document.getElementById("maintenance-type-osmosis");i&&i.addEventListener("click",()=>{Uc(),We()});const r=document.getElementById("maintenance-type-softener");r&&r.addEventListener("click",()=>{jc(),We()});const a=document.getElementById("maintenance-type-cancel");a&&a.addEventListener("click",()=>{We()});const{modal:c,backdrop:l}=Kn();l&&l.addEventListener("click",()=>{We()}),c&&c.addEventListener("click",d=>{d.target===c&&We()})}async function Wc(){kc(),Hc(),Gc(),he.remito.initialize(),he.search.initialize(),he.remitosGestion.initialize();try{await sr(),await he.maintenance.initialize(),he.softener.initialize(),await Si()}catch(e){console.error("Error inicializando la aplicación:",e),alert("No se pudo inicializar la aplicación. Revisa la consola para más detalles.")}}document.addEventListener("DOMContentLoaded",()=>{Wc()});
