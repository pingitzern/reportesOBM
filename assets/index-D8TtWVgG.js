(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const Fi=["tab-nuevo","tab-ablandador","tab-buscar","tab-dashboard","remito-view","remitos-gestion-view"];function $i(e){e&&e.classList.add("hidden")}function no(e){e&&e.classList.remove("hidden")}function He(e){if(typeof e!="string"||!e)return;let t=!1;if(Fi.forEach(n=>{const o=document.getElementById(n);if(o){if(n===e){no(o),t=!0;return}$i(o)}}),!t){const n=document.getElementById(e);n&&no(n)}}const oo={},zt=typeof window<"u"?window.__APP_CONFIG__:void 0,Oi=zt&&typeof zt.API_URL=="string"?zt.API_URL.trim():"";let ze=Oi;if(!ze){const e=typeof import.meta<"u"&&import.meta&&typeof oo=="object"?oo:void 0;e&&typeof e.VITE_API_URL=="string"&&(ze=e.VITE_API_URL.trim())}const gt=typeof globalThis<"u"&&typeof globalThis.process=="object"?globalThis.process:void 0;!ze&&gt&&gt.env&&typeof gt.env.API_URL=="string"&&(ze=gt.env.API_URL);ze||console.warn("[config] API_URL no está configurada. Define window.__APP_CONFIG__.API_URL o la variable de entorno VITE_API_URL/API_URL.");const ve=ze,Pi=60,zi=60*24/3.78541,ki=Object.freeze(Object.defineProperty({__proto__:null,API_URL:ve,LMIN_TO_GPD:zi,LMIN_TO_LPH:Pi},Symbol.toStringTag,{value:"Module"})),mn="reportesOBM.theme",Ne="light",Ee="dark";let tt=Ne,It=!1,io=null;const Qt=new Set;function pn(){return typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null}function Wo(e){Qt.forEach(t=>{if(typeof t=="function")try{t(e)}catch(n){console.warn("[theme] Error ejecutando listener:",n)}})}function Zo(e){if(typeof document>"u")return;const t=document.documentElement;if(!t||!t.classList)return;const n=e===Ee;t.classList.toggle("dark-theme",n),t.dataset.theme=e}function Bi(){const e=pn();if(!e)return null;try{const t=e.getItem(mn);if(t===Ee||t===Ne)return t}catch(t){console.warn("[theme] No se pudo leer la preferencia almacenada:",t)}return null}function ro(e){const t=pn();if(t)try{t.setItem(mn,e)}catch(n){console.warn("[theme] No se pudo guardar la preferencia de tema:",n)}}function Hi(){const e=pn();if(e)try{e.removeItem(mn)}catch(t){console.warn("[theme] No se pudo limpiar la preferencia de tema:",t)}}function Ui(){return typeof window>"u"||typeof window.matchMedia!="function"?Ne:window.matchMedia("(prefers-color-scheme: dark)").matches?Ee:Ne}function ji(e){if(It)return;const t=e!=null&&e.matches?Ee:Ne;Ko(t,{persist:!1,explicit:!1})}function qi(){if(typeof window>"u"||typeof window.matchMedia!="function"||io)return;const e=window.matchMedia("(prefers-color-scheme: dark)"),t=ji;typeof e.addEventListener=="function"?e.addEventListener("change",t):typeof e.addListener=="function"&&e.addListener(t),io=e}function Vi(){const e=Bi();It=!!e;const t=e||Ui();return tt=t,Zo(t),qi(),Wo(t),t}function Gi(){return tt}function Ko(e,{persist:t=!0,explicit:n=!0}={}){const o=e===Ee?Ee:Ne;return o===tt?(n&&(It=!0),t&&ro(o),o):(tt=o,Zo(o),t?ro(o):n||Hi(),n&&(It=!0),Wo(o),o)}function Wi(e){return typeof e!="function"?()=>{}:(Qt.add(e),e(tt),()=>{Qt.delete(e)})}const wt="reportesOBM.user";let ge=null,ao=!1,Ae=null,Me=!1,Lt=!1,so=null;function gn(){return typeof window<"u"&&window.localStorage?window.localStorage:typeof globalThis<"u"&&globalThis.localStorage?globalThis.localStorage:null}function Zi(e){if(!e||typeof e!="object")return null;const t=typeof e.nombre=="string"?e.nombre.trim():typeof e.Nombre=="string"?e.Nombre.trim():"",n=typeof e.cargo=="string"?e.cargo.trim():typeof e.Cargo=="string"?e.Cargo.trim():"",o=typeof e.rol=="string"?e.rol.trim():typeof e.Rol=="string"?e.Rol.trim():"";return!t||!o?null:{nombre:t,cargo:n,rol:o}}function Ki(e){return typeof e=="string"?e.trim():""}function Yi(e){if(e==null)return{value:null,valid:!0};if(e instanceof Date)return Number.isNaN(e.getTime())?{value:null,valid:!1}:{value:e.toISOString(),valid:!0};if(typeof e=="number"){if(!Number.isFinite(e))return{value:null,valid:!1};const t=new Date(e);return Number.isNaN(t.getTime())?{value:null,valid:!1}:{value:t.toISOString(),valid:!0}}if(typeof e=="string"){const t=e.trim();return t?{value:t,valid:!0}:{value:null,valid:!0}}return{value:null,valid:!1}}function Yo(e,t){if(!e)return!1;if(!t)return!0;const n=new Date(t);return Number.isNaN(n.getTime())?!1:n.getTime()>Date.now()}function hn({user:e,token:t,expiresAt:n}){const o=Zi(e),i=Ki(t),{value:r,valid:a}=Yi(n);return!o||!i||!a||!Yo(i,r)?null:{user:o,token:i,expiresAt:r}}function bn(){if(ge&&Yo(ge.token,ge.expiresAt))return ge;ge=null;const e=gn();if(!e)return null;const t=e.getItem(wt);if(!t)return null;try{const n=JSON.parse(t),o=hn({user:(n==null?void 0:n.user)??(n==null?void 0:n.usuario)??n,token:n==null?void 0:n.token,expiresAt:n==null?void 0:n.expiresAt});if(o)return ge=o,ge}catch(n){return console.warn("[auth] No se pudo leer la sesión almacenada:",n),null}return e.removeItem(wt),null}function Ji(e){const t=hn({user:(e==null?void 0:e.user)??(e==null?void 0:e.usuario),token:e==null?void 0:e.token,expiresAt:e==null?void 0:e.expiresAt});if(!t)throw new Error("Los datos de sesión son inválidos.");ge=t;const n=gn();n&&n.setItem(wt,JSON.stringify(t)),At(t.user)}function co(){ge=null;const e=gn();e&&e.removeItem(wt),At(null)}function se(){if(typeof document>"u")return{};const e=document.getElementById("auth-user-panel"),t=document.getElementById("user-menu");let n=null,o=null,i=null,r=null;if(t&&typeof t.querySelector=="function"&&(n=t.querySelector("[data-user-name]")||t.querySelector(".user-menu__user-name")||null,o=t.querySelector('[data-auth-action="help"]'),i=t.querySelector('[data-auth-action="settings"]'),r=t.querySelector("[data-theme-state]")),t&&typeof t.querySelectorAll=="function"){const a=l=>typeof l=="string"?l.trim().toLowerCase():"",s=Array.from(t.querySelectorAll('[role="menuitem"]')||[]);o||(o=s.find(l=>a(l==null?void 0:l.textContent)==="ayuda")||null),i||(i=s.find(l=>a(l==null?void 0:l.textContent)==="configuración")||null),n||(n=s.find(l=>{var d;return(d=l==null?void 0:l.dataset)==null?void 0:d.userName})||null)}return{mainView:document.getElementById("main-view"),loginContainer:document.getElementById("login-container"),form:document.getElementById("login-form"),error:document.getElementById("login-error"),mailInput:document.getElementById("login-mail"),passwordInput:document.getElementById("login-password"),logoutButton:document.getElementById("logout-button"),panel:e,menuButton:document.getElementById("user-menu-toggle"),menu:t,helpLink:o,settingsLink:i,userNameDisplay:n,themeToggle:document.getElementById("theme-toggle"),themeToggleState:r}}function lo(e){var i;const{themeToggle:t,themeToggleState:n}=se();if(!t)return;const o=e===Ee;t.checked=o,(i=t.setAttribute)==null||i.call(t,"aria-checked",o?"true":"false"),n&&(n.textContent=o?"Activado":"Desactivado")}function Xi(e){var n,o;(n=e==null?void 0:e.stopPropagation)==null||n.call(e);const t=!!((o=e==null?void 0:e.target)!=null&&o.checked);Ko(t?Ee:Ne)}function en(){const{loginContainer:e,error:t,mailInput:n}=se();e&&e.classList.remove("hidden"),t&&(t.textContent="",t.classList.add("hidden")),n&&n.focus()}function Jo(){const{loginContainer:e,form:t,error:n}=se();e&&e.classList.add("hidden"),t&&t.reset(),n&&(n.textContent="",n.classList.add("hidden"))}function St(e){const{mainView:t,loginContainer:n}=se();t&&(e?t.classList.remove("hidden"):t.classList.add("hidden")),n&&(e?n.classList.add("hidden"):n.classList.remove("hidden"))}function uo(e,t){if(!e)return;e.querySelectorAll("input").forEach(i=>{i.disabled=t});const o=e.querySelector('button[type="submit"]');o&&(t?(o.dataset.originalText=o.textContent,o.textContent="Ingresando...",o.disabled=!0):(o.textContent=o.dataset.originalText||"Iniciar sesión",o.disabled=!1,delete o.dataset.originalText))}function tn(e){const{error:t}=se();t&&(t.textContent=e,t.classList.remove("hidden"))}function Qi(e,...t){return e?t.some(n=>{if(!n)return!1;if(e===n)return!0;if(typeof n.contains=="function")try{return n.contains(e)}catch{return!1}return!1}):!1}function er(){Lt||typeof document>"u"||typeof document.addEventListener!="function"||(document.addEventListener("click",Xo),document.addEventListener("keydown",Qo),Lt=!0)}function tr(){!Lt||typeof document>"u"||typeof document.removeEventListener!="function"||(document.removeEventListener("click",Xo),document.removeEventListener("keydown",Qo),Lt=!1)}function nr(){var n;const{menuButton:e,menu:t}=se();!e||e.disabled||!t||((n=t.classList)!=null&&n.remove&&t.classList.remove("hidden"),typeof t.setAttribute=="function"&&t.setAttribute("aria-hidden","false"),typeof e.setAttribute=="function"&&e.setAttribute("aria-expanded","true"),Me=!0,er())}function Ue(e={}){var i;const{focusButton:t=!1}=e,{menuButton:n,menu:o}=se();Me=!1,(i=o==null?void 0:o.classList)!=null&&i.add&&o.classList.add("hidden"),typeof(o==null?void 0:o.setAttribute)=="function"&&o.setAttribute("aria-hidden","true"),typeof(n==null?void 0:n.setAttribute)=="function"&&n.setAttribute("aria-expanded","false"),tr(),t&&typeof(n==null?void 0:n.focus)=="function"&&n.focus()}function Xo(e){if(!Me)return;const{panel:t,menuButton:n,menu:o}=se();Qi(e==null?void 0:e.target,t,n,o)||Ue()}function Qo(e){if(!Me)return;const t=(e==null?void 0:e.key)||(e==null?void 0:e.code);(t==="Escape"||t==="Esc")&&Ue({focusButton:!0})}function or(e){var n,o;e&&((n=e.preventDefault)==null||n.call(e),(o=e.stopPropagation)==null||o.call(e));const{menuButton:t}=se();!t||t.disabled||(Me?Ue():nr())}function ir(e){if(typeof document>"u"||typeof document.dispatchEvent!="function")return;const t={action:e};let n=null;if(typeof window<"u"&&typeof window.CustomEvent=="function"?n=window.CustomEvent:typeof CustomEvent=="function"&&(n=CustomEvent),n){document.dispatchEvent(new n("auth:navigate",{detail:t}));return}if(typeof Event=="function"){const o=new Event("auth:navigate");o.detail=t,document.dispatchEvent(o);return}document.dispatchEvent({type:"auth:navigate",detail:t})}function ei(e,t){var n,o;e&&((n=e.preventDefault)==null||n.call(e),(o=e.stopPropagation)==null||o.call(e)),Ue(),ir(t)}function rr(e){ei(e,"help")}function ar(e){ei(e,"settings")}function At(e){var l,d,f,_,h,E,v,b,I,x,m,C,M,w,R,A,D;const{panel:t,menuButton:n,menu:o,logoutButton:i,userNameDisplay:r}=se(),a=typeof(e==null?void 0:e.usuario)=="string"?e.usuario.trim():typeof(e==null?void 0:e.nombre)=="string"?e.nombre.trim():"",s=!!a;!t&&!n&&!o&&!i&&!r||(s?((d=(l=t==null?void 0:t.classList)==null?void 0:l.remove)==null||d.call(l,"hidden"),n&&(n.disabled=!1,(f=n.setAttribute)==null||f.call(n,"aria-expanded",Me?"true":"false")),o&&(Me?((h=(_=o.classList)==null?void 0:_.remove)==null||h.call(_,"hidden"),(E=o.setAttribute)==null||E.call(o,"aria-hidden","false")):((b=(v=o.classList)==null?void 0:v.add)==null||b.call(v,"hidden"),(I=o.setAttribute)==null||I.call(o,"aria-hidden","true"))),i&&(i.disabled=!1),r&&(r.textContent=a,(m=(x=r.classList)==null?void 0:x.remove)==null||m.call(x,"hidden"))):(r&&(r.textContent="",(M=(C=r.classList)==null?void 0:C.add)==null||M.call(C,"hidden")),Ue(),(R=(w=t==null?void 0:t.classList)==null?void 0:w.add)==null||R.call(w,"hidden"),n&&(n.disabled=!0,(A=n.setAttribute)==null||A.call(n,"aria-expanded","false")),(D=o==null?void 0:o.setAttribute)==null||D.call(o,"aria-hidden","true"),i&&(i.disabled=!0)))}function nn(){if(Ae)return Ae.promise;let e,t;const n=new Promise((o,i)=>{e=o,t=i});return Ae={promise:n,resolve:e,reject:t},n}function sr(e){Ae&&typeof Ae.resolve=="function"&&Ae.resolve(e),Ae=null}async function cr({mail:e,password:t}){var a,s,l,d;if(!ve)throw new Error("API_URL no está configurada.");const n={action:"login",mail:typeof e=="string"?e.trim():"",password:typeof t=="string"?t.trim():""};let o;try{o=await fetch(ve,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(n)})}catch(f){throw(f==null?void 0:f.name)==="AbortError"?new Error("La solicitud de autenticación excedió el tiempo de espera."):f instanceof TypeError?new Error("No se pudo conectar con el servidor de autenticación."):new Error((f==null?void 0:f.message)||"Error inesperado al iniciar sesión.")}if(!o.ok)throw o.status===401||o.status===403?new Error("Mail o contraseña incorrectos"):new Error(`HTTP ${o.status}`);let i;try{i=await o.json()}catch{throw new Error("No se pudo interpretar la respuesta de autenticación.")}if(i.result!=="success")throw new Error("Mail o contraseña incorrectos");const r=hn({user:((a=i.data)==null?void 0:a.usuario)??((s=i.data)==null?void 0:s.user)??i.data,token:(l=i.data)==null?void 0:l.token,expiresAt:(d=i.data)==null?void 0:d.expiresAt});if(!r)throw new Error("Mail o contraseña incorrectos");return r}async function lr(e){e.preventDefault();const{form:t,mailInput:n,passwordInput:o}=se();if(!t||!(t instanceof HTMLFormElement))return;const i=(n==null?void 0:n.value)||"",r=(o==null?void 0:o.value)||"";if(!i.trim()||!r.trim()){tn("Completa el mail y la contraseña.");return}uo(t,!0);try{const a=await cr({mail:i,password:r});Ji(a),St(!0),Jo(),sr(a)}catch(a){tn((a==null?void 0:a.message)||"No se pudo iniciar sesión.")}finally{uo(t,!1)}}async function ti(e){e&&e.preventDefault();const t=bn(),n=typeof(t==null?void 0:t.token)=="string"?t.token.trim():"";try{ve&&n&&await fetch(ve,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify({action:"logout",token:n})})}catch{}finally{co(),St(!1),en(),nn()}Ue(),co(),en(),nn()}function dr(){if(ao)return;const{form:e,logoutButton:t,menuButton:n,helpLink:o,settingsLink:i,themeToggle:r}=se();e&&e.addEventListener("submit",lr),t&&t.addEventListener("click",ti),n&&n.addEventListener("click",or),o&&o.addEventListener("click",rr),i&&i.addEventListener("click",ar),r&&(r.addEventListener("change",Xi),so?lo(Gi()):so=Wi(lo)),ao=!0}function ni(){const e=bn();return(typeof(e==null?void 0:e.token)=="string"?e.token.trim():"")||null}async function ur(){dr();const e=bn();return e?(At(e.user),St(!0),Jo(),e):(St(!1),At(null),en(),nn())}async function fr(){await ti(),tn("Tu sesión ha expirado. Por favor, ingresá de nuevo.")}const le={mantenimientos:[],mantenimientoEditando:null,clientes:[],clientesLoaded:!1},mr=new Set(["login","version_info"]);async function X(e){if(!ve)throw new Error("API_URL no está configurada.");const t={...e||{}},n=typeof t.action=="string"?t.action:void 0,o=typeof n=="string"?n.trim():"";if(o&&(t.action=o),!mr.has(o)){const a=ni();if(!a)throw new Error("No hay una sesión activa. Por favor, ingresá de nuevo.");t.token=a}let i;try{i=await fetch(ve,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(t)})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new Error("La solicitud excedió el tiempo de espera. Inténtalo nuevamente."):a instanceof TypeError?new Error("No se pudo conectar con el servidor. Verifica tu conexión a internet."):new Error((a==null?void 0:a.message)||"Error inesperado al comunicarse con el servidor.")}if(!i.ok)throw new Error(`HTTP ${i.status}`);let r;try{r=await i.json()}catch{throw new Error("No se pudo interpretar la respuesta del servidor.")}if(r.result!=="success"){const a=typeof r.error=="string"?r.error.trim():typeof r.message=="string"?r.message.trim():"";throw a==="Sesión expirada"||a==="Token inválido"?(fr(),new Error("Tu sesión ha expirado. Por favor, ingresá de nuevo.")):new Error(a||"Error desconocido")}return r.data}async function pr(e){return X({action:"guardar",...e})}async function oi(e){return X({action:"guardar_ablandador",...e??{}})}async function ii(e){return X({action:"generar_pdf_ablandador",...e??{}})}async function gr(e){return X({action:"buscar",...e})}async function hr(e){return X({action:"actualizar",...e})}async function br(e){return X({action:"eliminar",id:e})}async function yr(){return X({action:"dashboard"})}async function ri({forceRefresh:e=!1}={}){if(!e&&le.clientesLoaded)return le.clientes;const t=await X({action:"clientes"});if(!Array.isArray(t))throw new Error("La respuesta de clientes no es válida.");return le.clientes=t,le.clientesLoaded=!0,le.clientes}async function _r({page:e=1,pageSize:t=20}={}){return X({action:"obtener_remitos",page:e,pageSize:t})}async function vr(e){return X({action:"crear_remito",...e??{}})}async function Er(e){return X({action:"actualizar_remito",...e??{}})}async function xr(e){return X(e&&typeof e=="object"?{action:"eliminar_remito",...e}:{action:"eliminar_remito",remitoId:e})}async function Ir(){return X({action:"version_info"})}const wr=Object.freeze(Object.defineProperty({__proto__:null,actualizarMantenimiento:hr,actualizarRemito:Er,buscarMantenimientos:gr,crearRemito:vr,eliminarMantenimiento:br,eliminarRemito:xr,generarPdfAblandador:ii,guardarMantenimiento:pr,guardarMantenimientoAblandador:oi,obtenerClientes:ri,obtenerDashboard:yr,obtenerRemitos:_r,obtenerVersionServidor:Ir},Symbol.toStringTag,{value:"Module"}));let kt=null,Bt=null;function Te(e){return document.getElementById(e)}function Lr(e=[]){const t=Te("chart-mensual");t&&(kt&&kt.destroy(),kt=new Chart(t,{type:"bar",data:{labels:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],datasets:[{label:"Mantenimientos por Mes",data:e,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}}))}function Sr(e=[]){const t=Te("chart-tecnicos");t&&(Bt&&Bt.destroy(),Bt=new Chart(t,{type:"pie",data:{labels:e.map(n=>n.tecnico),datasets:[{data:e.map(n=>n.count),backgroundColor:["rgba(255, 99, 132, 0.5)","rgba(54, 162, 235, 0.5)","rgba(255, 206, 86, 0.5)","rgba(75, 192, 192, 0.5)","rgba(153, 102, 255, 0.5)","rgba(255, 159, 64, 0.5)"],borderWidth:1}]},options:{responsive:!0}}))}function Ar(e=[]){const t=Te("tabla-proximos");if(t){if(t.innerHTML="",!e.length){const n=document.createElement("tr"),o=document.createElement("td");o.colSpan=4,o.className="px-6 py-4 text-center",o.textContent="No hay próximos mantenimientos",n.appendChild(o),t.appendChild(n);return}e.forEach(n=>{const o=document.createElement("tr"),i=r=>{const a=document.createElement("td");return a.className="px-6 py-4 whitespace-nowrap",a.textContent=r,a};o.appendChild(i(n.cliente||"N/A")),o.appendChild(i(n.fecha||"N/A")),o.appendChild(i(n.tecnico||"N/A")),o.appendChild(i(`${n.dias_restantes} días`)),t.appendChild(o)})}}function Tr(e){if(!e)return;const t=Te("total-mantenimientos"),n=Te("mantenimientos-mes"),o=Te("proximos-mantenimientos"),i=Te("tecnicos-activos");t&&(t.textContent=e.total??0),n&&(n.textContent=e.esteMes??0),o&&(o.textContent=e.proximos??0),i&&(i.textContent=e.tecnicos??0),Lr(Array.isArray(e.mensual)?e.mensual:[]),Sr(Array.isArray(e.tecnicosData)?e.tecnicosData:[]),Ar(Array.isArray(e.proximosMantenimientos)?e.proximosMantenimientos:[])}function Cr(e,t={}){const{obtenerDashboard:n}=e,{showView:o}=t;async function i(){try{const s=await n();Tr(s)}catch(s){console.error("Error cargando dashboard:",s)}}async function r(){typeof o=="function"&&o("tab-dashboard"),await i()}async function a(){await i()}return{initialize:a,show:r,refresh:i}}const yn=[{id:"etapa1",title:"1ª Sedimentos (PP)",placeholder:"Micronaje: __ µm"},{id:"etapa2",title:"2ª Carbón Bloque (CTO)",placeholder:"Modelo/Tipo"},{id:"etapa3",title:"3ª Carbón GAC / PP",placeholder:"Micronaje/Tipo"},{id:"etapa4",title:"4ª Membrana RO",placeholder:"Caudal GPD | S/N",emphasize:!0},{id:"etapa5",title:"5ª Post-Filtro",placeholder:"Tipo: Carbón, Remineralizador..."},{id:"etapa6",title:"6ª Adicional",placeholder:"Tipo: UV, Alcalino..."}];function Nr(e){const t=document.createElement("div");t.className="component-toggle",t.dataset.state="inspeccionado";const n=`${e}_accion_cambiado`,o=`${e}_accion_inspeccionado`,i=document.createElement("input");i.type="radio",i.name=`${e}_accion`,i.value="Cambiado",i.id=n,i.className="component-toggle__input";const r=document.createElement("input");r.type="radio",r.name=`${e}_accion`,r.value="Inspeccionado",r.id=o,r.className="component-toggle__input",r.checked=!0,r.defaultChecked=!0;const a=document.createElement("div");a.className="component-toggle__track";const s=document.createElement("div");s.className="component-toggle__thumb",a.appendChild(s);const l=document.createElement("label");l.setAttribute("for",n),l.className="component-toggle__option component-toggle__option--cambiado",l.textContent="Cambiado";const d=document.createElement("label");return d.setAttribute("for",o),d.className="component-toggle__option component-toggle__option--inspeccionado",d.textContent="Inspeccionado",t.append(i,r,a,l,d),t}function Mr(e,t){const n=e.querySelector(".stage-title");n&&(n.textContent=t.title,t.emphasize&&n.classList.add("font-bold"));const o=e.querySelector(".stage-details");o&&(o.id=`${t.id}_detalles`,o.name=`${t.id}_detalles`,o.placeholder=t.placeholder);const i=e.querySelector(".stage-actions");if(i){const r=Nr(t.id);i.innerHTML="",i.appendChild(r);const a=d=>{r.dataset.state=String(d).toLowerCase()};r.querySelectorAll(".component-toggle__input").forEach(d=>{d.addEventListener("change",()=>{d.checked&&a(d.value)})});const l=r.querySelector(".component-toggle__input:checked");l&&a(l.value)}}function Rr({containerId:e="component-stage-container",templateId:t="component-stage-template"}={}){const n=document.getElementById(e),o=document.getElementById(t);if(!n||!(o instanceof HTMLTemplateElement))return;n.innerHTML="";const i=document.createDocumentFragment();yn.forEach(r=>{const a=o.content.cloneNode(!0);Mr(a,r),i.appendChild(a)}),n.appendChild(i)}const{LMIN_TO_GPD:Dr=60*24/3.78541,LMIN_TO_LPH:Fr=60}=ki;function $(e){return document.getElementById(e)}const fo="data-cliente-option",$r=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),Or=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),ht=Object.freeze({direccion:["direccion","Direccion","domicilio","Domicilio"],telefono:["telefono","Telefono","tel","Tel"],email:["email","Email","mail","Mail","correo","Correo"],cuit:["cuit","CUIT"]}),ai=Object.freeze(["direccion","cliente_telefono","cliente_email","cliente_cuit"]),mo="client-detail-empty",po="client-detail-locked",si="data-auto-resize",Ht="autoResizeBaseWidth",Pr=8,zr=6,go=48,ho=new WeakSet,bo=new WeakSet;function kr(e){return e instanceof HTMLInputElement&&e.hasAttribute(si)}function ke(e){if(!kr(e))return;if(!e.dataset[Ht]){const s=Math.max(e.clientWidth||0,e.offsetWidth||0);e.dataset[Ht]=String(s>0?s:go)}const t=Number(e.dataset[Ht])||go,n=typeof e.placeholder=="string"?e.placeholder.length:0,o=typeof e.value=="string"?e.value.length:0,i=Math.max(o,n,1);e.style.width="auto";let r=e.scrollWidth;(!r||Number.isNaN(r))&&(r=(Number(e.dataset.autoResizeCharWidth)||Pr)*i);const a=Math.max(t,r+zr);e.style.width=`${a}px`}function ci(){return typeof document>"u"?[]:Array.from(document.querySelectorAll(`input[${si}]`))}function Br(){ci().forEach(t=>{ke(t),ho.has(t)||(t.addEventListener("input",()=>ke(t)),ho.add(t))})}function Hr(){ci().forEach(ke)}const Ye=new Map;let bt=null;function _n(e){return e==null?"":String(e).trim()}function $e(e,t){if(!e||typeof e!="object")return"";for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const o=_n(e[n]);if(o)return o}return""}function yo(e){return $e(e,$r)}function Ur(e){return $e(e,Or)}function jr(e){return{direccion:$e(e,ht.direccion),telefono:$e(e,ht.telefono),email:$e(e,ht.email),cuit:$e(e,ht.cuit)}}function on(e,{lockWhenFilled:t=!1}={}){if(!(e instanceof HTMLInputElement)||!ai.includes(e.id))return;const n=_n(e.value)!=="";t?(e.readOnly=n,e.disabled=n):n||(e.readOnly=!1,e.disabled=!1),n&&(e.disabled||e.readOnly)?e.classList.add(po):e.classList.remove(po),n?e.classList.remove(mo):e.classList.add(mo)}function qr(){ai.forEach(e=>{const t=$(e);t instanceof HTMLInputElement&&(on(t),bo.has(t)||(t.addEventListener("input",()=>{on(t)}),bo.add(t)))})}function Vr(e,t,n={}){const o=$(e);if(!o)return;const i=_n(t);"value"in o&&(o.value=i),o instanceof HTMLInputElement&&(ke(o),on(o,{lockWhenFilled:!!n.lockWhenFilled}))}function li(e={}){const t={direccion:e.direccion,cliente_telefono:e.telefono,cliente_email:e.email,cliente_cuit:e.cuit};Object.entries(t).forEach(([n,o])=>{Vr(n,o,{lockWhenFilled:!0})})}function nt(){li({})}function _o(e){if(!e){nt();return}let t=null;const n=e.selectedOptions&&e.selectedOptions.length>0?e.selectedOptions[0]:null,o=typeof e.selectedIndex=="number"&&e.selectedIndex>=0?e.options[e.selectedIndex]:null;if(n){const r=n.getAttribute("data-cliente-key");r&&(t=Ye.get(r)||null)}if((!t||o&&n&&n!==o)&&o){const r=o.getAttribute("data-cliente-key");if(r){const a=Ye.get(r);a&&(t=a)}}t||(t=Ye.get(e.value)),t?li(t):nt()}function Gr(){const e=$("cliente");if(!e){nt();return}if(e.options.length>0){const t=e.querySelector('option[value=""]');t?(t.selected=!0,e.value=t.value):e.selectedIndex=0}else e.value="";nt()}function vo(e){return String(e).padStart(2,"0")}function Wr(e){return Object.prototype.toString.call(e)==="[object Date]"}function di(e){return Wr(e)&&!Number.isNaN(e.getTime())}function Ut(e,t,n){const o=new Date(e,t,n);return Number.isNaN(o.getTime())||o.getFullYear()!==e||o.getMonth()!==t||o.getDate()!==n?null:o}function we(e){return di(e)?`${e.getFullYear()}-${vo(e.getMonth()+1)}-${vo(e.getDate())}`:""}function _e(e){if(e==null||e==="")return"";if(di(e))return we(e);if(typeof e=="number")return we(new Date(e));if(typeof e=="string"){const t=e.trim();if(!t)return"";let n=t.match(/^(\d{4})-(\d{2})-(\d{2})(?:$|T)/);if(n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),s=Ut(i,r-1,a);return s?we(s):""}if(n=t.match(/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/),n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),s=Ut(i,r-1,a);return s?we(s):""}if(n=t.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{4})$/),n){const i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),s=Ut(a,r-1,i);return s?we(s):""}const o=new Date(t);return we(o)}if(typeof e=="object"){const t=new Date(e);return we(t)}return""}function Zr(e){if(!e)return"";const[t,n,o]=e.split("-");if(!t||!n||!o)return"";const i=Number(t),r=Number(n),a=Number(o);if(Number.isNaN(i)||Number.isNaN(r)||Number.isNaN(a))return"";const s=new Date(i,r-1,a);return Number.isNaN(s.getTime())?"":s.toLocaleDateString("es-AR",{year:"numeric",month:"2-digit",day:"2-digit"})}function ui(e){const t=_e(e),n=$("fecha");n&&(n.value=t);const o=$("fecha_display");o&&(o.value=Zr(t),ke(o))}function fi(e){if(!(e instanceof HTMLFormElement))return{};const t=new FormData(e),n={};t.forEach((i,r)=>{Object.prototype.hasOwnProperty.call(n,r)?(Array.isArray(n[r])||(n[r]=[n[r]]),n[r].push(i)):n[r]=i});const o=new Set;return e.querySelectorAll('input[type="radio"][name]').forEach(i=>o.add(i.name)),o.forEach(i=>{Object.prototype.hasOwnProperty.call(n,i)||(n[i]="")}),n}function mi(){ui(new Date)}function vn(){var D,k,W,oe,Q,ee,ce,de;const e=parseFloat((D=$("cond_red_found"))==null?void 0:D.value)||0,t=parseFloat((k=$("cond_perm_found"))==null?void 0:k.value)||0,n=parseFloat((W=$("cond_red_left"))==null?void 0:W.value)||0,o=parseFloat((oe=$("cond_perm_left"))==null?void 0:oe.value)||0,i=parseFloat((Q=$("caudal_perm_found"))==null?void 0:Q.value)||0,r=parseFloat((ee=$("caudal_rech_found"))==null?void 0:ee.value)||0,a=parseFloat((ce=$("caudal_perm_left"))==null?void 0:ce.value)||0,s=parseFloat((de=$("caudal_rech_left"))==null?void 0:de.value)||0,l=e>0?((1-t/e)*100).toFixed(2):"",d=n>0?((1-o/n)*100).toFixed(2):"",f=l?`${l} %`:"",_=d?`${d} %`:"",h=$("rechazo_found"),E=$("rechazo_found_hidden"),v=$("rechazo_left"),b=$("rechazo_left_hidden");h&&(h.value=f),E&&(E.value=f),v&&(v.value=_),b&&(b.value=_);const I=i>0?(r/i).toFixed(1):"",x=a>0?(s/a).toFixed(1):"",m=I?`${I}:1`:"",C=x?`${x}:1`:"",M=$("relacion_found"),w=$("relacion_found_hidden"),R=$("relacion_left"),A=$("relacion_left_hidden");M&&(M.value=m),w&&(w.value=m),R&&(R.value=C),A&&(A.value=C)}function Kr(e,t){const n=parseFloat(e.value);if(!Number.isNaN(n)&&n>=0){const o=n*Fr,i=n*Dr;t.textContent=`(${o.toFixed(1)} l/h | ${i.toFixed(0)} GPD)`}else t.textContent=""}function Yr(){[["caudal_perm_found","caudal_perm_found_conv"],["caudal_perm_left","caudal_perm_left_conv"],["caudal_rech_found","caudal_rech_found_conv"],["caudal_rech_left","caudal_rech_left_conv"]].forEach(([t,n])=>{const o=$(t),i=$(n);o&&i&&o.addEventListener("input",()=>Kr(o,i))})}const pi='select[id$="_found"], select[id$="_left"]',Jr={pasa:"status-pass",no:"status-pass",falla:"status-fail","no pasa":"status-fail",sí:"status-fail",si:"status-fail","n/a":"status-na","no aplica":"status-na",na:"status-na","":"status-na"};function rn(e){e.classList.remove("status-pass","status-fail","status-na");const t=String(e.value??"").trim().toLowerCase(),n=Jr[t]||"status-na";e.classList.add(n)}function Xr(){document.querySelectorAll(pi).forEach(rn)}function Qr(){document.querySelectorAll(pi).forEach(t=>{rn(t),t.addEventListener("change",()=>rn(t))})}const ea={Realizada:"success","No Realizada":"danger","N/A":"neutral"};function En(){const e=document.querySelector(".sanitizacion-options");if(!e)return;const t=e.querySelectorAll('input[type="radio"][name="sanitizacion"]');if(!t.length){e.dataset.status="neutral";return}const n=()=>{const o=e.querySelector('input[type="radio"][name="sanitizacion"]:checked'),i=(o==null?void 0:o.value)||"N/A";e.dataset.status=ea[i]||"neutral"};e.dataset.sanitizacionConfigured||(t.forEach(o=>{o.addEventListener("change",n)}),e.dataset.sanitizacionConfigured="true"),n()}function ta(){document.querySelectorAll('input[type="number"]').forEach(t=>{t.addEventListener("input",vn)})}function na(){["rechazo_found","rechazo_found_hidden","rechazo_left","rechazo_left_hidden","relacion_found","relacion_found_hidden","relacion_left","relacion_left_hidden"].forEach(e=>{const t=$(e);t&&(t.value="")})}function oa(){["caudal_perm_found_conv","caudal_perm_left_conv","caudal_rech_found_conv","caudal_rech_left_conv"].forEach(e=>{const t=$(e);t&&(t.textContent="")})}function ia(e,t){const n=new Date(e.getTime());return n.setDate(n.getDate()+t),n}function Ve(e,t){const n=$(e);if(!(n instanceof HTMLInputElement)&&!(n instanceof HTMLTextAreaElement))return;n.value=t;const o=new Event("input",{bubbles:!0});n.dispatchEvent(o),n instanceof HTMLInputElement&&ke(n)}function Fe(e,t){const n=$(e);if(!(n instanceof HTMLSelectElement))return;n.value=t;const o=new Event("change",{bubbles:!0});n.dispatchEvent(o)}function ra(){const e=new Date;ui(e),Ve("tecnico","Equipo Técnico Pruebas"),Ve("modelo","Sistema RO Residencial 6 etapas"),Ve("id_interna","ACT-PRUEBA-042"),Ve("n_serie","SN-PRB-998877");const t=ia(e,180),n=$("proximo_mant");n instanceof HTMLInputElement&&(n.value=_e(t),n.dispatchEvent(new Event("input",{bubbles:!0}))),Object.entries({cond_red_found:480,cond_red_left:460,cond_perm_found:28,cond_perm_left:16,presion_found:2.6,presion_left:3.9,caudal_perm_found:1.9,caudal_perm_left:2.5,caudal_rech_found:3.8,caudal_rech_left:4.3,precarga_found:1.1,precarga_left:1.5}).forEach(([l,d])=>{const f=$(l);f instanceof HTMLInputElement&&(f.value=d,f.dispatchEvent(new Event("input",{bubbles:!0})))}),Fe("fugas_found","Sí"),Fe("fugas_left","No"),Fe("presostato_alta_found","Pasa"),Fe("presostato_alta_left","Pasa"),Fe("presostato_baja_found","Pasa"),Fe("presostato_baja_left","Pasa");const i={etapa1:"Filtro sedimentos 5µm (cambio)",etapa2:'Cartucho CTO 10" reemplazado',etapa3:"GAC + pulido final verificado",etapa4:"Membrana 75 GPD instalada",etapa5:"Postfiltro remineralizador nuevo",etapa6:"UV operativa y sanitizada"};yn.forEach(l=>{const d=`${l.id}_detalles`;Ve(d,i[l.id]||l.title);const f=document.getElementById(`${l.id}_accion_cambiado`);f instanceof HTMLInputElement&&(f.checked=!0,f.dispatchEvent(new Event("change",{bubbles:!0})))});const r=document.querySelector('input[name="sanitizacion"][value="Realizada"]');r instanceof HTMLInputElement&&(r.checked=!0,r.dispatchEvent(new Event("change",{bubbles:!0})));const a=["Se reemplazaron todos los filtros y se normalizaron los parámetros.","Equipo calibrado tras cambio integral de cartuchos y sanitización completa.","Mantenimiento preventivo completado sin novedades, parámetros dentro de lo esperado.","Cambios realizados y pruebas finales exitosas, equipo queda operativo."],s=document.getElementById("resumen");if(s instanceof HTMLTextAreaElement){const l=a[Math.floor(Math.random()*a.length)];s.value=l,s.dispatchEvent(new Event("input",{bubbles:!0}))}vn(),["caudal_perm_found","caudal_perm_left","caudal_rech_found","caudal_rech_left"].forEach(l=>{const d=$(l);d instanceof HTMLInputElement&&d.dispatchEvent(new Event("input",{bubbles:!0}))}),En()}function aa(e=[]){const t=$("cliente");if(!t)return;const n=Array.isArray(e)?e:[],o=t.value,i=t.selectedOptions&&t.selectedOptions[0],r=i?i.getAttribute("data-cliente-key"):null,a=t.querySelector('option[value=""]');t.querySelectorAll(`option[${fo}="true"]`).forEach(d=>d.remove()),Ye.clear();const s=document.createDocumentFragment();n.forEach((d,f)=>{if(!d||typeof d!="object")return;const _=Ur(d)||yo(d);if(!_)return;const h=yo(d)||_,E=document.createElement("option");E.value=_,E.textContent=h;const v=`cliente-${f}`;E.setAttribute("data-cliente-key",v),E.setAttribute(fo,"true"),s.appendChild(E),Ye.set(v,jr(d))}),t.appendChild(s),bt&&t.removeEventListener("change",bt),bt=()=>{_o(t)},t.addEventListener("change",bt);let l=!1;if(r){const d=t.querySelector(`option[data-cliente-key="${r}"]`);d&&(d.selected=!0,t.value=d.value,l=!0)}!l&&o&&(t.value=o,l=t.value===o&&t.selectedIndex!==-1),l?_o(t):(a?(a.selected=!0,t.value=a.value):t.options.length>0?t.selectedIndex=0:t.value="",nt())}function sa(){mi(),ta(),Yr(),Qr(),Br(),qr(),En(),vn()}function Eo(){const e=$("maintenance-form");e&&e.reset(),Gr(),mi(),na(),oa(),Xr(),Hr(),En()}function ca(){const e=$("maintenance-form");if(!(e instanceof HTMLFormElement))return{};const t=fi(e),n=e.querySelector('input[name="sanitizacion"]:checked');if(t.sanitizacion=n?n.value:"",Object.prototype.hasOwnProperty.call(t,"fecha")){const i=_e(t.fecha);t.fecha=i||_e(new Date)}return Object.prototype.hasOwnProperty.call(t,"proximo_mant")&&(t.proximo_mant=_e(t.proximo_mant)),["cond_red_found","cond_red_left","cond_perm_found","cond_perm_left","presion_found","presion_left","caudal_perm_found","caudal_perm_left","caudal_rech_found","caudal_rech_left","precarga_found","precarga_left"].forEach(i=>{Object.prototype.hasOwnProperty.call(t,i)&&t[i]===""&&(t[i]=0)}),t}function la(e){const t=$("report-number-display");t&&(t.textContent=e)}function da(){const e=new Date,t=o=>String(o).padStart(2,"0");return`REP-${`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}`}function yt(e){return document.getElementById(e)}function ua(e,t={}){const{guardarMantenimiento:n,obtenerClientes:o}=e,{onReportSaved:i,onReportReset:r}=t;let a=!1;function s(){typeof r=="function"&&r()}function l(b){typeof i=="function"&&i(b)}function d(){if(a)return;const b=yt("guardarButton");b&&b.addEventListener("click",m=>{m.preventDefault(),v()});const I=yt("resetButton");I&&I.addEventListener("click",m=>{m.preventDefault(),h()});const x=yt("autoFillButton");x&&x.addEventListener("click",m=>{m.preventDefault(),E()}),a=!0}async function f(){let b=[];try{b=await o()}catch(I){console.error("Error cargando clientes:",I);const x=I!=null&&I.message?` Detalle: ${I.message}`:"";alert(`No se pudieron cargar los datos de clientes. Podrás completar los campos manualmente.${x}`)}aa(b)}async function _(){Rr(),await f(),sa(),s(),d()}function h(){Eo(),s()}function E(){ra()}async function v(){const b=yt("guardarButton");if(!b)return;const I=b.textContent;b.textContent="Guardando...",b.disabled=!0;try{const x=da(),m=ca();m&&typeof m=="object"&&(m.numero_reporte=x),await n(m),la(x),l(m),alert("✅ Mantenimiento guardado correctamente en el sistema");try{setTimeout(()=>{try{typeof window<"u"&&typeof window.print=="function"&&window.print()}catch{}try{Eo()}catch{}},150)}catch{}}catch(x){console.error("Error al guardar mantenimiento:",x);const m=(x==null?void 0:x.message)||"Error desconocido al guardar los datos.";alert(`❌ Error al guardar los datos: ${m}`)}finally{b.textContent=I,b.disabled=!1}}return{initialize:_,handleGuardarClick:v,handleResetClick:h}}function Re(e){return document.getElementById(e)}function xo(e){return _e(e)||""}function _t(e){const t=document.createElement("td");return t.className="px-6 py-4 whitespace-nowrap",t.textContent=e,t}function Le(e){return String(e??"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function fa(e,{onEdit:t,onDelete:n}){const o=Re("tabla-resultados"),i=Re("resultados-busqueda");if(!(!o||!i)){if(le.mantenimientos=Array.isArray(e)?e:[],o.innerHTML="",!le.mantenimientos.length){const r=document.createElement("tr"),a=document.createElement("td");a.colSpan=5,a.className="px-6 py-4 text-center",a.textContent="No se encontraron resultados",r.appendChild(a),o.appendChild(r),i.classList.remove("hidden");return}le.mantenimientos.forEach(r=>{const a=document.createElement("tr");a.appendChild(_t(r.Cliente||"N/A")),a.appendChild(_t(r.Fecha_Servicio||"N/A")),a.appendChild(_t(r.Tecnico_Asignado||"N/A")),a.appendChild(_t(r.Modelo_Equipo||"N/A"));const s=document.createElement("td");s.className="px-6 py-4 whitespace-nowrap";const l=document.createElement("button");l.type="button",l.className="text-blue-600 hover:text-blue-900 mr-2",l.textContent="Editar",l.addEventListener("click",()=>t(r));const d=document.createElement("button");d.type="button",d.className="text-red-600 hover:text-red-900",d.textContent="Eliminar",d.addEventListener("click",()=>n(r)),s.appendChild(l),s.appendChild(d),a.appendChild(s),o.appendChild(a)}),i.classList.remove("hidden")}}function ma(){const e=Re("tabla-resultados");e&&(e.innerHTML="");const t=Re("resultados-busqueda");t&&t.classList.add("hidden"),le.mantenimientos=[]}function pa(e){const t=Re("modal-edicion"),n=Re("formulario-edicion");if(!t||!n)return;le.mantenimientoEditando=e;const o=xo(e.Fecha_Servicio),i=xo(e.Proximo_Mantenimiento);n.innerHTML=`
        <form id="edit-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                    <input type="text" id="edit-cliente" name="cliente" value="${Le(e.Cliente||"")}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Servicio</label>
                    <input type="date" id="edit-fecha" name="fecha_servicio" value="${Le(o)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Técnico</label>
                    <input type="text" id="edit-tecnico" name="tecnico_asignado" value="${Le(e.Tecnico_Asignado||"")}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Próximo Mantenimiento</label>
                    <input type="date" id="edit-proximo-mant" name="proximo_mantenimiento" value="${Le(i)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Conductividad Permeado</label>
                    <input type="number" id="edit-cond-perm" name="conductividad_permeado_left" value="${Le(e.Conductividad_Permeado_Left||0)}" class="w-full border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Resumen</label>
                    <textarea id="edit-resumen" name="resumen_recomendaciones" rows="3" class="w-full border-gray-300 rounded-md p-2">${Le(e.Resumen_Recomendaciones||"")}</textarea>
                </div>
            </div>
            <input type="hidden" id="edit-id" name="id" value="${Le(e.ID_Unico||"")}">
        </form>
    `,t.classList.remove("hidden")}function Io(){const e=Re("modal-edicion");e&&e.classList.add("hidden"),le.mantenimientoEditando=null}function ga(){const e=document.getElementById("edit-form");if(!(e instanceof HTMLFormElement))return{};const t=fi(e);return Object.prototype.hasOwnProperty.call(t,"conductividad_permeado_left")&&t.conductividad_permeado_left===""&&(t.conductividad_permeado_left=0),Object.prototype.hasOwnProperty.call(t,"fecha_servicio")&&(t.fecha_servicio=_e(t.fecha_servicio)),Object.prototype.hasOwnProperty.call(t,"proximo_mantenimiento")&&(t.proximo_mantenimiento=_e(t.proximo_mantenimiento)),t}function he(e){return document.getElementById(e)}function ha(e,t={}){const{buscarMantenimientos:n,actualizarMantenimiento:o,eliminarMantenimiento:i}=e,{showView:r}=t;let a=!1;async function s(){var b,I,x;const v={cliente:((b=he("buscar-cliente"))==null?void 0:b.value)||"",tecnico:((I=he("buscar-tecnico"))==null?void 0:I.value)||"",fecha:((x=he("buscar-fecha"))==null?void 0:x.value)||""};try{const m=await n(v);fa(m,{onEdit:d,onDelete:f})}catch(m){console.error("Error buscando mantenimientos:",m);const C=(m==null?void 0:m.message)||"Error desconocido al buscar mantenimientos.";alert(`❌ Error al buscar mantenimientos: ${C}`)}}function l(){["buscar-cliente","buscar-tecnico","buscar-fecha"].forEach(v=>{const b=he(v);b&&(b.value="")}),ma()}function d(v){v&&pa(v)}async function f(v){if(!(!(v!=null&&v.ID_Unico)||!window.confirm("¿Estás seguro de que quieres eliminar este mantenimiento?")))try{await i(v.ID_Unico),alert("✅ Mantenimiento eliminado correctamente"),await s()}catch(I){console.error("Error eliminando mantenimiento:",I),alert("Error al eliminar mantenimiento")}}async function _(){try{const v=ga();await o(v),alert("✅ Cambios guardados correctamente"),Io(),await s()}catch(v){console.error("Error guardando cambios:",v),alert("Error al guardar cambios")}}function h(){if(a)return;const v=he("buscar-btn");v&&v.addEventListener("click",m=>{m.preventDefault(),s()});const b=he("limpiar-btn");b&&b.addEventListener("click",m=>{m.preventDefault(),l()});const I=he("cancelar-edicion-btn");I&&I.addEventListener("click",m=>{m.preventDefault(),Io()});const x=he("guardar-edicion-btn");x&&x.addEventListener("click",m=>{m.preventDefault(),_()}),a=!0}function E(){typeof r=="function"&&r("tab-buscar")}return{initialize:h,show:E,handleBuscarClick:s,handleLimpiarBusqueda:l,handleEditarMantenimiento:d,handleEliminarMantenimiento:f,handleGuardarEdicion:_}}const xn=4,ba=5*1024*1024,wo="https://drive.google.com/uc?export=view&id=",ya=Object.freeze({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/heic":"heic","image/heif":"heif"});function K(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function _a(e){const t=L(e).toLowerCase();return ya[t]||"jpg"}function va(e,t,n,o){const a=(L(e)||`${t}-foto-${n+1}`).replace(/[\\/]/g,"-").replace(/[^a-zA-Z0-9._-]+/g,"_"),s=_a(o);return a.toLowerCase().endsWith(`.${s}`)?a:`${a.replace(/\.[^.]+$/,"")}.${s}`}function Lo(e){const t=L(e);if(!t)return"";try{return`${wo}${encodeURIComponent(t)}`}catch{return`${wo}${t}`}}function Ea(e){const t=L(e);if(!t||t.startsWith("data:"))return"";const n=t.match(/[?&]id=([a-zA-Z0-9_-]+)/);if(n&&n[1])return n[1];const o=t.match(/\/d\/([a-zA-Z0-9_-]+)/);return o&&o[1]?o[1]:/^[a-zA-Z0-9_-]{10,}$/.test(t)?t:""}function In(e=0){return{index:e,previewUrl:"",base64Data:"",mimeType:"",fileName:"",url:"",driveId:"",shouldRemove:!1}}function So(){return Array.from({length:xn},(e,t)=>In(t))}function Ao(e=[]){return Array.from({length:xn},(t,n)=>{const o=Array.isArray(e)?e[n]:void 0;return!o||typeof o!="object"?In(n):{index:Number.isFinite(Number(o.index))?Number(o.index):n,previewUrl:typeof o.previewUrl=="string"?o.previewUrl:"",base64Data:typeof o.base64Data=="string"?o.base64Data:"",mimeType:typeof o.mimeType=="string"?o.mimeType:"",fileName:typeof o.fileName=="string"?o.fileName:"",url:typeof o.url=="string"?o.url:"",driveId:typeof o.driveId=="string"?o.driveId:"",shouldRemove:!!o.shouldRemove}})}function gi(e){if(!e||typeof e!="object")return"";const t=L(e.previewUrl);if(t)return t;const n=L(e.driveId||e.driveFileId||e.id);if(n)return Lo(n);const o=L(e.url),i=Ea(o);return i?Lo(i):o}function hi(e){if(!e||typeof e!="object")return"Sin archivo seleccionado";const t=L(e.fileName);if(t)return t;const n=L(e.driveId||e.driveFileId||e.id);if(n)return`Foto en Drive (${n.slice(0,8)}...)`;const o=L(e.url);if(o)try{const r=new URL(o).pathname.split("/");return r[r.length-1]||"Foto subida"}catch{return"Foto subida"}return"Sin archivo seleccionado"}function xa(){return typeof window<"u"&&typeof window.FileReader<"u"}function Ia(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=()=>{n(new Error("No se pudo leer el archivo seleccionado."))},o.readAsDataURL(e)})}function wa(e){if(typeof e!="string")throw new Error("No se pudo interpretar la imagen seleccionada.");const t=e.match(/^data:([^;]+);base64,(.+)$/);if(!t)throw new Error("El formato de la imagen no es compatible.");return t[2]}function q(e){return typeof document<"u"?document.getElementById(e):null}function La(e){var o;const t=q(e);if(!(t instanceof HTMLSelectElement))return"";const n=(o=t.selectedOptions)==null?void 0:o[0];return n?n.textContent.trim():""}function Ge(e){const t=q(e);return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?t.value.trim():""}function an(e){if(!e||typeof e!="object")return{};try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}}function L(e){return e==null?"":String(e).trim()}function me(e){return!!L(e)}function Sa(e={}){return[e.descripcion,e.detalle,e.detalles,e.title,e.nombre].map(L).filter(Boolean).join(" - ")}function bi(e={}){if(!e||typeof e!="object")return{codigo:"",descripcion:"",cantidad:""};const t=L(e.codigo||e.id||e.codigo_repuesto||e.cod||e.codigoArticulo),n=Sa(e),o=e.cantidad??e.cant??e.unidades??"",i=L(o);if(i){const r=Number(String(i).replace(",","."));if(Number.isFinite(r)&&r>=0)return{codigo:t,descripcion:n,cantidad:String(r)}}return{codigo:t,descripcion:n,cantidad:i}}function Aa(e){const t=L(e).toLowerCase();return t?["cambi","reempl","instal","nuevo"].some(o=>t.includes(o)):!1}function Ta(e){return Array.isArray(e)?e.reduce((t,n)=>(n!=null&&n.id&&(t[n.id]=L(n.title)||n.id),t),{}):{}}function Ca(e){const t=Array.from({length:6},(i,r)=>`etapa${r+1}`);if(!Array.isArray(e)||e.length===0)return t;const n=e.map(i=>L(i==null?void 0:i.id)).filter(Boolean),o=new Set([...n,...t]);return Array.from(o)}function wn(e,t=yn){if(!e||typeof e!="object")return[];const n=Ta(t);return Ca(t).reduce((i,r)=>{const a=`${r}_accion`,s=`${r}_detalles`,l=L(e[a]),d=L(e[s]);return Aa(l)&&i.push({accion:l,detalles:d,title:n[r]||r}),i},[])}function sn(e){const t=L(e);if(!t)return"";if(/^\d{2}\/\d{2}\/\d{4}$/.test(t))return t;const n=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(n){const[,i,r,a]=n;return`${a}/${r}/${i}`}const o=Date.parse(t);if(!Number.isNaN(o)){const i=new Date(o),r=String(i.getDate()).padStart(2,"0"),a=String(i.getMonth()+1).padStart(2,"0"),s=String(i.getFullYear());return`${r}/${a}/${s}`}return t}function B(e,t,n=""){if(!e||typeof e!="object")return n;const o=Array.isArray(t)?t:[t];for(const i of o){const r=L(e[i]);if(r)return r}return n}function Na(){var n,o,i,r,a;if(typeof window>"u")return"";const e=[],t=s=>{const l=L(s);l&&!e.includes(l)&&e.push(l)};try{const s=(i=(o=(n=window.document)==null?void 0:n.querySelector)==null?void 0:o.call(n,"base[href]"))==null?void 0:i.href;s&&t(new URL("OHM-agua.png",s).href)}catch(s){console.warn("No se pudo determinar la URL del logo del remito desde la etiqueta <base>.",s)}try{const s=(r=window.location)==null?void 0:r.href;s&&t(new URL("OHM-agua.png",s).href)}catch(s){console.warn("No se pudo determinar la URL del logo del remito desde la ubicación actual.",s)}try{const s=(a=window.location)==null?void 0:a.origin;s&&t(new URL("OHM-agua.png",s).href)}catch(s){console.warn("No se pudo determinar la URL del logo del remito desde el origen actual.",s)}return t("/OHM-agua.png"),e.find(Boolean)||""}function Ma(e,t){return Array.isArray(e)&&e.length>0?e:Array.isArray(t==null?void 0:t.repuestos)&&t.repuestos.length>0?t.repuestos:wn(t)}function Ra(e=[]){return!Array.isArray(e)||e.length===0?[]:e.map((t,n)=>{if(!t||typeof t!="object")return null;let i=L(gi(t));if(!i){const a=L(t.base64Data),s=L(t.mimeType)||"image/jpeg";a&&(i=`data:${s};base64,${a}`)}if(!i)return null;const r=L(hi(t))||`Foto ${n+1}`;return{src:i,label:r}}).filter(Boolean)}function Da(e,{observaciones:t="",repuestos:n=[],photoSlots:o=[]}={}){if(!e||typeof e!="object")return null;const i=B(e,["NumeroRemito","numero_remito","remitoNumero","numero_reporte"]),r=sn(B(e,["fecha_display","fecha"])),a={nombre:B(e,["clienteNombre","cliente_nombre","cliente"]),direccion:B(e,["direccion","cliente_direccion","ubicacion"]),telefono:B(e,["cliente_telefono","telefono_cliente","telefono"]),email:B(e,["cliente_email","email"]),cuit:B(e,["cliente_cuit","cuit"])},s={descripcion:B(e,["equipo","modelo","descripcion_equipo"]),modelo:B(e,["modelo","modelo_equipo"]),serie:B(e,["n_serie","numero_serie"]),interno:B(e,["id_interna","codigo_interno"]),ubicacion:B(e,["ubicacion","direccion","cliente_direccion"]),tecnico:B(e,["tecnico","tecnico_asignado"])},l=Ma(n,e),d=Array.isArray(l)?l.map(h=>bi(h)).map(h=>({codigo:L(h.codigo),descripcion:L(h.descripcion),cantidad:L(h.cantidad)})).filter(h=>me(h.codigo)||me(h.descripcion)||me(h.cantidad)):[],f=L(t||e.observaciones||e.resumen||""),_=Ra(o);return{numero:L(i),fecha:L(r),cliente:a,equipo:s,repuestos:d,observaciones:f,fotos:_}}function To(e=[]){return e.map(t=>{const n=K((t==null?void 0:t.label)||""),o=K(L((t==null?void 0:t.value)||""));return`
                <tr>
                    <th scope="row">${n}</th>
                    <td>${o||'<span class="placeholder">—</span>'}</td>
                </tr>
            `}).join("")}function Fa(e=[]){return!Array.isArray(e)||e.length===0?`
            <tr class="empty-row">
                <td colspan="4">Sin repuestos registrados.</td>
            </tr>
        `:e.map((t,n)=>{const o=K(String(n+1)),i=K(t.codigo),r=K(t.descripcion),a=K(t.cantidad);return`
                <tr>
                    <td class="index">${o}</td>
                    <td>${i||'<span class="placeholder">—</span>'}</td>
                    <td>${r||'<span class="placeholder">—</span>'}</td>
                    <td class="cantidad">${a||'<span class="placeholder">—</span>'}</td>
                </tr>
            `}).join("")}function $a(e=[]){return!Array.isArray(e)||e.length===0?'<p class="placeholder">Sin fotos adjuntas para este remito.</p>':`
        <div class="photo-grid">
            ${e.map((t,n)=>{const o=L(t==null?void 0:t.label)||`Foto ${n+1}`,i=K(o),r=L(t==null?void 0:t.src);if(!r)return"";const a=K(r),s=K(`Registro fotográfico ${o}`);return`
                        <figure class="photo-item">
                            <div class="photo-item__frame">
                                <img src="${a}" alt="${s}" loading="lazy">
                            </div>
                            <figcaption>${i}</figcaption>
                        </figure>
                    `}).join("")}
        </div>
    `}function Oa(e){var d,f,_,h,E,v,b,I,x,m,C;if(!e)return"";const t=K(e.numero||"—"),n=K(e.fecha||"—"),o=K(Na()),i=e.observaciones?K(e.observaciones).replace(/\r?\n/g,"<br>"):'<span class="placeholder">Sin observaciones registradas.</span>',r=To([{label:"Razón social",value:(d=e.cliente)==null?void 0:d.nombre},{label:"Dirección",value:(f=e.cliente)==null?void 0:f.direccion},{label:"Teléfono",value:(_=e.cliente)==null?void 0:_.telefono},{label:"Email",value:(h=e.cliente)==null?void 0:h.email},{label:"CUIT",value:(E=e.cliente)==null?void 0:E.cuit}]),a=To([{label:"Descripción",value:(v=e.equipo)==null?void 0:v.descripcion},{label:"Modelo",value:(b=e.equipo)==null?void 0:b.modelo},{label:"N° de serie",value:(I=e.equipo)==null?void 0:I.serie},{label:"Activo / ID interno",value:(x=e.equipo)==null?void 0:x.interno},{label:"Ubicación",value:(m=e.equipo)==null?void 0:m.ubicacion},{label:"Técnico responsable",value:(C=e.equipo)==null?void 0:C.tecnico}]),s=Fa(e.repuestos),l=$a(e.fotos);return`<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Remito ${t}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            color-scheme: only light;
        }

        @page {
            size: A4;
            margin: 1.5cm;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 12px;
            line-height: 1.5;
            color: #111827;
            background: #f3f4f6;
        }

        .document {
            background: #ffffff;
            padding: 28px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        }

        .document__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 18px;
            margin-bottom: 24px;
        }

        .document__identity {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .document__title {
            font-size: 22px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .document__meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            color: #374151;
            font-weight: 600;
        }

        .document__logo {
            flex: none;
            max-width: 140px;
        }

        .document__logo img {
            width: 100%;
            height: auto;
            display: block;
        }

        .section {
            margin-bottom: 24px;
        }

        .section__title {
            font-size: 15px;
            font-weight: 700;
            margin: 0 0 12px;
            color: #1f2937;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .info-table,
        .repuestos-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            overflow: hidden;
        }

        .info-table th,
        .info-table td {
            text-align: left;
            padding: 8px 10px;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: top;
        }

        .info-table th {
            width: 32%;
            font-weight: 600;
            background: #f9fafb;
            color: #1f2937;
        }

        .info-table tr:last-child th,
        .info-table tr:last-child td {
            border-bottom: none;
        }

        .repuestos-table thead {
            background: #2563eb;
            color: #ffffff;
        }

        .repuestos-table th,
        .repuestos-table td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .repuestos-table th {
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.05em;
        }

        .repuestos-table td.index {
            width: 48px;
            font-weight: 600;
            text-align: center;
        }

        .repuestos-table td.cantidad {
            text-align: right;
            width: 80px;
            font-weight: 600;
        }

        .repuestos-table tr:last-child td {
            border-bottom: none;
        }

        .placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        .observaciones {
            padding: 16px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            background: #f9fafb;
            min-height: 90px;
            white-space: pre-line;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
        }

        .photo-item {
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .photo-item__frame {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background: #111827;
            aspect-ratio: 3 / 2;
        }

        .photo-item__frame img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #111827;
        }

        .photo-item figcaption {
            font-size: 11px;
            color: #4b5563;
            text-align: center;
        }

        .document__footer {
            margin-top: 32px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
        }

        .firma {
            border-top: 1px solid #9ca3af;
            padding-top: 12px;
            text-align: center;
            color: #6b7280;
        }

        @media print {
            body {
                background: #ffffff;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .document {
                box-shadow: none;
            }

            .document__header {
                margin-bottom: 18px;
            }

            .section {
                page-break-inside: avoid;
            }

            .photo-item {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="document">
        <header class="document__header">
            <div class="document__identity">
                <p class="document__title">Remito de servicio</p>
                <div class="document__meta">
                    <span>Número: <strong>${t}</strong></span>
                    <span>Fecha: <strong>${n}</strong></span>
                </div>
            </div>
            <div class="document__logo">
                <img src="${o}" alt="Logo de OHM Agua">
            </div>
        </header>

        <section class="section">
            <h2 class="section__title">Datos del cliente</h2>
            <table class="info-table">
                <tbody>
                    ${r}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Datos del equipo</h2>
            <table class="info-table">
                <tbody>
                    ${a}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Repuestos y materiales</h2>
            <table class="repuestos-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Código</th>
                        <th>Descripción</th>
                        <th>Cantidad</th>
                    </tr>
                </thead>
                <tbody>
                    ${s}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2 class="section__title">Observaciones</h2>
            <div class="observaciones">${i}</div>
        </section>

        <section class="section">
            <h2 class="section__title">Registro fotográfico</h2>
            ${l}
        </section>

        <footer class="document__footer">
            <div class="firma">
                <p>Firma del responsable de OHM Agua</p>
            </div>
            <div class="firma">
                <p>Firma y aclaración del cliente</p>
            </div>
        </footer>
    </div>
    <script>
        window.addEventListener('load', () => {
            window.focus();
            setTimeout(() => {
                try {
                    window.print();
                } catch (error) {
                    console.error('No se pudo iniciar la impresión automática.', error);
                }
            }, 150);
        });

        window.addEventListener('afterprint', () => {
            setTimeout(() => {
                window.close();
            }, 250);
        });
    <\/script>
</body>
</html>`}function Co(e,t={}){if(typeof window>"u")return!1;const n=Da(e,t);if(!n)return!1;const o=Oa(n);if(!o)return!1;const i=window.open("","_blank");if(!i)return!1;try{return i.document.open(),i.document.write(o),i.document.close(),i.opener=null,!0}catch(r){return console.error("No se pudo abrir la vista de impresión del remito.",r),!1}}function J(e,t){const n=q(e);n instanceof HTMLInputElement&&(n.value=L(t),n.readOnly=!0,n.setAttribute("readonly","readonly"))}function Pa(e=[]){e.forEach(t=>{const n=q(t);n instanceof HTMLInputElement&&(n.value="",n.readOnly=!0,n.setAttribute("readonly","readonly"))})}function cn(e={},{forceDefaultCantidad:t=!1}={}){if(typeof document>"u")return null;const{codigo:n="",descripcion:o="",cantidad:i=""}=e,r=t&&!me(i)?"1":i,a=document.createElement("tr");a.className="remito-repuesto-row transition-colors duration-150 hover:bg-gray-50";const s=document.createElement("td");s.className="px-4 py-3 align-top";const l=document.createElement("input");l.type="text",l.name="repuesto-codigo",l.placeholder="Código del repuesto",l.value=n,l.dataset.field="codigo",l.className="repuestos-table-input",s.appendChild(l);const d=document.createElement("td");d.className="px-4 py-3 align-top";const f=document.createElement("input");f.type="text",f.name="repuesto-descripcion",f.placeholder="Descripción del repuesto",f.value=o,f.dataset.field="descripcion",f.className="repuestos-table-input",d.appendChild(f);const _=document.createElement("td");_.className="px-4 py-3 align-top text-right";const h=document.createElement("input");return h.type="number",h.name="repuesto-cantidad",h.placeholder="0",h.inputMode="numeric",h.min="0",h.step="1",h.value=r,h.dataset.field="cantidad",h.className="repuestos-table-input text-right",_.appendChild(h),a.append(s,d,_),a}function xt(e=[]){const t=q("remito-repuestos-body");if(t instanceof HTMLElement){if(t.innerHTML="",!Array.isArray(e)||e.length===0){const n=cn();n&&t.appendChild(n);return}e.forEach(n=>{const o=bi(n),i=me(o.codigo)||me(o.descripcion)||me(o.cantidad),r=cn(o,{forceDefaultCantidad:i});r&&t.appendChild(r)})}}function za(e){const t=L(e);if(!t)return"";const n=Number(t.replace(",","."));return Number.isFinite(n)?String(n):t}function ka(){const e=q("remito-repuestos-body");return e instanceof HTMLElement?Array.from(e.querySelectorAll("tr")).reduce((n,o)=>{const i=Array.from(o.querySelectorAll("input[data-field]"));if(i.length===0)return n;const r={codigo:"",descripcion:"",cantidad:""};return i.forEach(s=>{if(!(s instanceof HTMLInputElement))return;const l=s.dataset.field;l&&(l==="cantidad"?r.cantidad=za(s.value):r[l]=L(s.value))}),(me(r.codigo)||me(r.descripcion)||me(r.cantidad))&&n.push(r),n},[]):[]}function Ba({focus:e=!1}={}){const t=q("remito-repuestos-body");if(!(t instanceof HTMLElement))return;const n=cn();if(n&&(t.appendChild(n),e)){const o=n.querySelector("input");o instanceof HTMLInputElement&&o.focus()}}function Ha(e){var n,o,i,r,a,s,l,d,f,_,h,E,v,b,I,x,m,C,M,w,R,A,D,k,W,oe;const t={metadata:e.metadata||{},numero_reporte:((n=e.metadata)==null?void 0:n.numero_reporte)||"",NumeroRemito:"",fecha_display:((o=e.seccion_A_cliente)==null?void 0:o.fecha_servicio)||"",fecha:((i=e.seccion_A_cliente)==null?void 0:i.fecha_servicio)||"",clienteNombre:((r=e.seccion_A_cliente)==null?void 0:r.nombre)||"",cliente_nombre:((a=e.seccion_A_cliente)==null?void 0:a.nombre)||"",direccion:((s=e.seccion_A_cliente)==null?void 0:s.direccion)||"",cliente_direccion:((l=e.seccion_A_cliente)==null?void 0:l.direccion)||"",cliente_telefono:((d=e.seccion_A_cliente)==null?void 0:d.telefono)||"",telefono:((f=e.seccion_A_cliente)==null?void 0:f.telefono)||"",cliente_email:((_=e.seccion_A_cliente)==null?void 0:_.email)||"",email:((h=e.seccion_A_cliente)==null?void 0:h.email)||"",cliente_cuit:((E=e.seccion_A_cliente)==null?void 0:E.cuit)||"",cuit:((v=e.seccion_A_cliente)==null?void 0:v.cuit)||"",equipo:((b=e.seccion_B_equipo)==null?void 0:b.tipo)||"Ablandador",modelo:((I=e.seccion_B_equipo)==null?void 0:I.modelo)||"",modelo_equipo:((x=e.seccion_B_equipo)==null?void 0:x.modelo)||"",n_serie:((m=e.seccion_B_equipo)==null?void 0:m.numero_serie)||"",numero_serie:((C=e.seccion_B_equipo)==null?void 0:C.numero_serie)||"",id_interna:"N/A",codigo_interno:"N/A",ubicacion:((M=e.seccion_B_equipo)==null?void 0:M.ubicacion)||"",tecnico:((w=e.seccion_A_cliente)==null?void 0:w.tecnico)||"",tecnico_asignado:((R=e.seccion_A_cliente)==null?void 0:R.tecnico)||"",observaciones:((A=e.seccion_E_resumen)==null?void 0:A.trabajo_realizado)||"",resumen:((D=e.seccion_E_resumen)==null?void 0:D.trabajo_realizado)||"",componentes:[],repuestos:[]};if((k=e.seccion_D_checklist)!=null&&k.cambio_filtro_realizado){const Q=((W=e.seccion_D_checklist)==null?void 0:W.filtro_tipo_instalado)||"Prefiltro",ee=((oe=e.seccion_D_checklist)==null?void 0:oe.filtro_lote_serie)||"",ce={codigo:"",descripcion:ee?`${Q} - Lote: ${ee}`:Q,cantidad:1};t.repuestos.push(ce)}else t.repuestos.push({codigo:"",descripcion:"N/A - Consumibles",cantidad:0});return{...t,seccion_A_cliente:e.seccion_A_cliente||null,seccion_B_equipo:e.seccion_B_equipo||null,seccion_C_parametros:e.seccion_C_parametros||null,seccion_D_checklist:e.seccion_D_checklist||null,seccion_E_resumen:e.seccion_E_resumen||null,seccion_F_condiciones:e.seccion_F_condiciones||null,seccion_G_cierre:e.seccion_G_cierre||null}}function Ua(e){var o;if(((o=e==null?void 0:e.metadata)==null?void 0:o.formulario)==="mantenimiento_ablandador")return Ha(e);const t=an(e);t.clienteNombre||(t.clienteNombre=La("cliente")||t.cliente||t.cliente_nombre),t.direccion=t.direccion||Ge("direccion"),t.cliente_telefono=t.cliente_telefono||Ge("cliente_telefono"),t.cliente_email=t.cliente_email||Ge("cliente_email"),t.cliente_cuit=t.cliente_cuit||Ge("cliente_cuit"),t.fecha_display=t.fecha_display||Ge("fecha_display");const n=wn(t);return t.componentes=n,(!Array.isArray(t.repuestos)||t.repuestos.length===0)&&(t.repuestos=n.map(i=>({...i}))),t}function ja(e){var x,m,C,M,w,R,A,D,k,W,oe,Q,ee,ce,de,pt,p;if(!e||typeof e!="object")return;const t=((x=e.metadata)==null?void 0:x.formulario)==="mantenimiento_ablandador";let n,o,i,r,a,s,l,d,f,_,h,E,v;if(t){n=((m=e.metadata)==null?void 0:m.numero_reporte)||"",o=sn((C=e.seccion_A_cliente)==null?void 0:C.fecha_servicio),i=((M=e.seccion_A_cliente)==null?void 0:M.nombre)||"",r=((w=e.seccion_A_cliente)==null?void 0:w.direccion)||"",a=((R=e.seccion_A_cliente)==null?void 0:R.telefono)||"",s=((A=e.seccion_A_cliente)==null?void 0:A.email)||"",l=((D=e.seccion_A_cliente)==null?void 0:D.cuit)||"";const y=((k=e.seccion_B_equipo)==null?void 0:k.tipo)||"Ablandador";f=((W=e.seccion_B_equipo)==null?void 0:W.modelo)||"",d=f?`${y} - ${f}`:y,_=((oe=e.seccion_B_equipo)==null?void 0:oe.numero_serie)||"",h="N/A",E=((Q=e.seccion_B_equipo)==null?void 0:Q.ubicacion)||"",v=((ee=e.seccion_A_cliente)==null?void 0:ee.tecnico)||""}else n=B(e,["NumeroRemito","numero_remito","remitoNumero","numero_reporte"]),o=sn(B(e,["fecha_display","fecha"])),i=B(e,["clienteNombre","cliente_nombre","cliente"]),r=B(e,["direccion","cliente_direccion","ubicacion"]),a=B(e,["cliente_telefono","telefono_cliente","telefono"]),s=B(e,["cliente_email","email"]),l=B(e,["cliente_cuit","cuit"]),d=B(e,["equipo","modelo","descripcion_equipo"]),f=B(e,["modelo","modelo_equipo"]),_=B(e,["n_serie","numero_serie"]),h=B(e,["id_interna","codigo_interno"]),E=B(e,["ubicacion","direccion","cliente_direccion"]),v=B(e,["tecnico","tecnico_asignado"]);J("remito-numero",n),J("remito-fecha",o),J("remito-cliente-nombre",i),J("remito-cliente-direccion",r),J("remito-cliente-telefono",a),J("remito-cliente-email",s),J("remito-cliente-cuit",l),J("remito-equipo-descripcion",d),J("remito-equipo-modelo",f),J("remito-equipo-serie",_),J("remito-equipo-interno",h),J("remito-equipo-ubicacion",E),J("remito-equipo-tecnico",v);const b=q("remito-observaciones");if(b instanceof HTMLTextAreaElement){let y="";t?y=L(((ce=e.seccion_E_resumen)==null?void 0:ce.trabajo_realizado)||""):y=L(e.observaciones||e.resumen||""),b.value=y,b.removeAttribute("readonly")}let I=[];if(t)if((de=e.seccion_D_checklist)!=null&&de.cambio_filtro_realizado){const y=((pt=e.seccion_D_checklist)==null?void 0:pt.filtro_tipo_instalado)||"Prefiltro",N=((p=e.seccion_D_checklist)==null?void 0:p.filtro_lote_serie)||"";I.push({title:"Prefiltro",detalles:N?`${y} - Lote: ${N}`:y,accion:"Cambio"})}else I.push({title:"Consumibles",detalles:"N/A",accion:"Sin cambios"});else{const y=Array.isArray(e.componentes)&&e.componentes.length>0?e.componentes:wn(e);I=Array.isArray(e.repuestos)&&e.repuestos.length>0?e.repuestos:y}xt(I)}function jt(e){const t=q(e);t instanceof HTMLButtonElement&&(t.disabled=!0,t.setAttribute("disabled","disabled"))}function qa(e){const t=q(e);t instanceof HTMLButtonElement&&(t.disabled=!1,t.removeAttribute("disabled"))}function Va({showView:e,apiUrl:t,getToken:n}={}){let o=null,i=!1,r=So(),a=!1,s=null;function l(){const p=q("remito-fotos-container");return p instanceof HTMLElement?p:null}function d(){const p=q("imprimir-remito-btn");return p instanceof HTMLButtonElement?p:null}function f(p){const y=d();y&&(p?(y.classList.remove("hidden"),y.disabled=!1):(y.classList.add("hidden"),y.disabled=!0))}function _(){if(!o)return null;const p=an(o),y=Ao(r);return{report:p,photoSlots:y}}function h(p){if(!p||typeof p!="object")return"";if(p.sent)return"📧 Se envió el remito por correo electrónico correctamente.";const y=typeof p.error=="string"?p.error.trim():"";if(y)return`⚠️ El remito se generó, pero no se pudo enviar el correo electrónico: ${y}`;if(p.skipped){const N=typeof p.message=="string"?p.message.trim():"";return N?`ℹ️ ${N}`:"ℹ️ El envío de correo electrónico está deshabilitado."}return""}function E(){const p=l();if(!p)return;const y=r.map((N,O)=>{const F=gi(N),H=!!F,ie=K(hi(N)),Z=["group relative flex w-full items-center justify-center overflow-hidden rounded-xl border-2","min-h-[180px]",H?"border-transparent bg-gray-900/5":"border-dashed border-gray-300 bg-gray-50","text-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"].join(" "),Y=H?`
                        <img src="${K(F)}" alt="Foto ${O+1}" class="max-h-72 max-w-full object-contain mx-auto" loading="lazy">
                    `:`
                        <div class="flex flex-col items-center justify-center gap-2 text-gray-400">
                            <span class="text-5xl font-light leading-none">+</span>
                            <span class="text-xs font-medium">Agregar foto</span>
                        </div>
                    `,G=H?`
                        <button type="button" class="absolute right-3 top-3 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-red-500 shadow-md transition hover:bg-red-50 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2" data-remito-photo-action="remove" data-remito-photo-index="${O}" title="Eliminar foto" aria-label="Eliminar foto">
                            <span aria-hidden="true" class="text-lg leading-none">&times;</span>
                        </button>
                    `:"",re=`
                    <div class="absolute inset-0 z-10 hidden items-center justify-center rounded-xl bg-black/40 p-4" data-remito-photo-menu="${O}" aria-hidden="true">
                        <button type="button" class="absolute inset-0 cursor-default" data-remito-photo-menu-dismiss></button>
                        <div class="relative z-10 w-full max-w-[220px] space-y-2 rounded-lg bg-white p-4 text-center shadow-lg">
                            <p class="text-sm font-semibold text-gray-700">Seleccioná una opción</p>
                            <button type="button" class="w-full rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-action="capture" data-remito-photo-index="${O}">Tomar foto</button>
                            <button type="button" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-action="upload" data-remito-photo-index="${O}">Subir foto</button>
                            <button type="button" class="w-full rounded-lg border border-transparent bg-gray-100 px-3 py-2 text-sm font-semibold text-gray-600 transition hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-menu-dismiss>Cerrar</button>
                        </div>
                    </div>
                `;return`
                    <div class="remito-photo-slot space-y-2" data-remito-photo-slot="${O}">
                        <div class="flex items-center justify-between gap-2">
                            <p class="text-sm font-medium text-gray-700">Foto ${O+1}</p>
                            <p class="max-w-[60%] truncate text-[11px] text-gray-500">${ie}</p>
                        </div>
                        <div class="relative">
                            <button type="button" class="${Z}" data-remito-photo-trigger data-remito-photo-index="${O}" aria-label="Agregar o reemplazar foto ${O+1}">
                                ${Y}
                            </button>
                            ${G}
                            ${re}
                        </div>
                        <input type="file" accept="image/*" capture="environment" class="hidden" data-remito-photo-input="capture" data-remito-photo-index="${O}">
                        <input type="file" accept="image/*" class="hidden" data-remito-photo-input="upload" data-remito-photo-index="${O}">
                    </div>
                `}).join("");p.innerHTML=y}function v(){r=So(),E()}function b(){const p=l();if(!p)return;p.querySelectorAll("[data-remito-photo-menu]").forEach(N=>{N.classList.add("hidden"),N.setAttribute("aria-hidden","true")})}function I(p){const y=l();if(!y)return;const N=Number(p);if(!Number.isFinite(N)||N<0||N>=xn)return;const O=`[data-remito-photo-menu="${N}"]`,F=y.querySelector(O);if(!F)return;const H=F.classList.contains("hidden");b(),H&&(F.classList.remove("hidden"),F.setAttribute("aria-hidden","false"))}function x(p,y){const N=l();if(!N)return;const O=`[data-remito-photo-input="${p}"][data-remito-photo-index="${y}"]`,F=N.querySelector(O);F instanceof HTMLInputElement&&(F.value="",F.click())}function m(p){const y=Number(p);!Number.isFinite(y)||y<0||y>=r.length||(b(),r[y]=In(y),E())}async function C(p,y){var O,F,H,ie;const N=Number(p);if(!(!Number.isFinite(N)||N<0||N>=r.length)&&y){if(!y.type||!y.type.startsWith("image/")){(O=window.alert)==null||O.call(window,"Solo se pueden cargar archivos de imagen.");return}if(y.size&&y.size>ba){(F=window.alert)==null||F.call(window,"La foto supera el límite de 5 MB permitido.");return}if(!xa()){(H=window.alert)==null||H.call(window,"El navegador no permite procesar imágenes desde este formulario.");return}try{const Z=await Ia(y),Y=wa(Z),G=L(y.type)||"image/jpeg",re=q("remito-numero"),V=(re instanceof HTMLInputElement?L(re.value):"")||"remito",ue=va(y.name,V,N,G);r[N]={index:N,previewUrl:typeof Z=="string"?Z:"",base64Data:Y,mimeType:G,fileName:ue,url:"",driveId:"",shouldRemove:!1},b(),E()}catch(Z){const Y=Z instanceof Error?Z.message:"No se pudo procesar la foto seleccionada.";(ie=window.alert)==null||ie.call(window,Y)}}}function M(p,y){if(!p)return;const N=Number(y);if(!(!Number.isFinite(N)||N<0||N>=r.length)){if(p==="remove"){m(N);return}(p==="capture"||p==="upload")&&(b(),x(p,N))}}function w(p){var H,ie,Z,Y,G,re,xe,V;if((ie=(H=p.target).closest)==null?void 0:ie.call(H,"[data-remito-photo-menu-dismiss]")){p.preventDefault(),b();return}const N=(Y=(Z=p.target).closest)==null?void 0:Y.call(Z,"[data-remito-photo-action]");if(N){p.preventDefault();const ue=N.dataset.remitoPhotoAction,Ot=N.dataset.remitoPhotoIndex;M(ue,Ot);return}const O=(re=(G=p.target).closest)==null?void 0:re.call(G,"[data-remito-photo-trigger]");if(O){p.preventDefault(),I(O.dataset.remitoPhotoIndex);return}!!((V=(xe=p.target).closest)!=null&&V.call(xe,"[data-remito-photo-menu]"))||b()}function R(p){const y=p.target;if(!(y instanceof HTMLInputElement)||!y.dataset.remitoPhotoInput)return;const O=Number.parseInt(y.dataset.remitoPhotoIndex??"",10),F=y.files&&y.files[0];Number.isFinite(O)&&F&&C(O,F),y.value=""}function A(){if(a)return;const p=l();p&&(p.addEventListener("click",w),p.addEventListener("change",R),a=!0)}function D(){return r.map((p,y)=>({slot:y+1,base64Data:L(p.base64Data),mimeType:L(p.mimeType)||"image/jpeg",fileName:L(p.fileName)||`remito-foto-${y+1}.jpg`,driveFileId:L(p.driveId)})).filter(p=>!!p.base64Data||!!p.driveFileId)}function k(){var p;return o?!0:(jt("generar-remito-btn"),(p=window.alert)==null||p.call(window,"Primero debés guardar el mantenimiento para generar el remito."),!1)}function W(p){o=Ua(p),qa("generar-remito-btn"),s=null,f(!1)}function oe(){o=null,jt("generar-remito-btn"),v(),b(),s=null,f(!1),Pa(["remito-numero","remito-fecha","remito-cliente-nombre","remito-cliente-direccion","remito-cliente-telefono","remito-cliente-email","remito-cliente-cuit","remito-equipo-descripcion","remito-equipo-modelo","remito-equipo-serie","remito-equipo-interno","remito-equipo-ubicacion","remito-equipo-tecnico"]),xt([]);const p=q("remito-observaciones");p instanceof HTMLTextAreaElement&&(p.value="")}function Q(){return k()?(v(),b(),ja(o),typeof e=="function"&&e("remito-view"),!0):!1}async function ee(){var ie,Z,Y;if(!o){(ie=window.alert)==null||ie.call(window,"No hay datos disponibles para generar el remito. Guardá el mantenimiento primero.");return}const p=q("remito-observaciones"),y=p instanceof HTMLTextAreaElement?L(p.value):"",N=ka();o.repuestos=N,N.length>0&&(o.componentes=[]),o.observaciones=y,xt(N);const O=D(),F=q("finalizar-remito-btn");let H="";F instanceof HTMLButtonElement&&(H=F.textContent||"",F.textContent="Generando remito...",F.disabled=!0);try{if(!t)throw new Error("La URL del servicio no está configurada.");const G=typeof n=="function"?L(n()):"";if(!G)throw new Error("No hay una sesión activa. Ingresá nuevamente.");const re={action:"crear_remito",token:G,reporteData:o,observaciones:y};Array.isArray(O)&&O.length>0&&(re.fotos=O);const xe=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(re)});if(!xe.ok)throw new Error(`HTTP ${xe.status}`);let V;try{V=await xe.json()}catch{throw new Error("No se pudo interpretar la respuesta del servidor.")}if((V==null?void 0:V.result)!=="success"){const to=L((V==null?void 0:V.error)||(V==null?void 0:V.message))||"No fue posible generar el remito.";throw new Error(to)}const ue=(V==null?void 0:V.data)||{},Ot=ue==null?void 0:ue.emailStatus,Pt=L(ue==null?void 0:ue.NumeroRemito);Pt&&(o.NumeroRemito=Pt,J("remito-numero",Pt)),s=_(),f(!!s);const Ie=(s==null?void 0:s.report)||o,Ri=(s==null?void 0:s.photoSlots)||Ao(r),Di=Co(Ie,{observaciones:Ie==null?void 0:Ie.observaciones,repuestos:Ie==null?void 0:Ie.repuestos,photoSlots:Ri}),qe=[];Di?qe.push("✅ Remito generado correctamente. Se abrirá la vista de impresión para descargar o imprimir el PDF."):qe.push('✅ Remito generado correctamente. No pudimos abrir la vista de impresión automáticamente. Revisá el bloqueador de ventanas emergentes y utilizá el botón "Imprimir remito" para reintentarlo.');const eo=h(Ot);eo&&qe.push(eo),qe.length>0&&((Z=window.alert)==null||Z.call(window,qe.join(`

`)))}catch(G){console.error("Error al generar el remito:",G);const re=G instanceof Error?G.message:"Error desconocido al generar el remito.";(Y=window.alert)==null||Y.call(window,`❌ ${re}`)}finally{F instanceof HTMLButtonElement&&(F.textContent=H||"Finalizar y Guardar Remito",F.disabled=!1)}}function ce(){if(i)return;jt("generar-remito-btn"),xt([]),E(),A(),f(!!s);const p=q("generar-remito-btn");p instanceof HTMLButtonElement&&p.addEventListener("click",F=>{F.preventDefault(),Q()});const y=q("finalizar-remito-btn");y instanceof HTMLButtonElement&&y.addEventListener("click",F=>{F.preventDefault(),ee()});const N=d();N&&N.addEventListener("click",F=>{var Y,G;if(F.preventDefault(),!s){(Y=window.alert)==null||Y.call(window,"Generá y guardá un remito antes de intentar imprimirlo.");return}const H=s.report,ie=s.photoSlots||[];Co(H,{observaciones:H==null?void 0:H.observaciones,repuestos:H==null?void 0:H.repuestos,photoSlots:ie})||(G=window.alert)==null||G.call(window,"No pudimos abrir la vista de impresión. Revisá el bloqueador de ventanas emergentes e intentá nuevamente.")});const O=q("remito-agregar-repuesto");O instanceof HTMLButtonElement&&O.addEventListener("click",F=>{F.preventDefault(),Ba({focus:!0})}),i=!0}function de(p){o=p?an(p):null}function pt(){return o}return{initialize:ce,handleMaintenanceSaved:W,reset:oe,handleGenerarRemitoClick:Q,handleFinalizarRemitoClick:ee,setLastSavedReportForTests:de,getLastSavedReportForTests:pt}}const Ga=20,De=4,Wa=5*1024*1024,Za=Object.freeze([["Foto1Id","Foto1ID","foto1Id","foto1ID","Foto1URL","Foto1Url","foto1URL","foto1Url","foto1","Foto1","foto_1","Foto_1"],["Foto2Id","Foto2ID","foto2Id","foto2ID","Foto2URL","Foto2Url","foto2URL","foto2Url","foto2","Foto2","foto_2","Foto_2"],["Foto3Id","Foto3ID","foto3Id","foto3ID","Foto3URL","Foto3Url","foto3URL","foto3Url","foto3","Foto3","foto_3","Foto_3"],["Foto4Id","Foto4ID","foto4Id","foto4ID","Foto4URL","Foto4Url","foto4URL","foto4Url","foto4","Foto4","foto_4","Foto_4"]]),No="https://drive.google.com/uc?export=view&id=",Ka=Object.freeze({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/heic":"heic","image/heif":"heif"});function j(e,t){if(!(!e||typeof e!="object"||!Array.isArray(t)))for(const n of t){if(!n||typeof n!="string")continue;const o=e[n];if(o!=null&&o!=="")return o}}function u(e){if(e==null)return"";if(typeof e=="string")return e.trim();if(typeof e=="number")return Number.isFinite(e)?String(e):"";if(Object.prototype.toString.call(e)==="[object Date]"&&!Number.isNaN(e.getTime()))try{return e.toLocaleDateString("es-AR")}catch{return e.toISOString()}return String(e).trim()}function Ya(e){if(e==null)return"";if(Object.prototype.toString.call(e)==="[object Date]"&&!Number.isNaN(e.getTime()))try{return e.toLocaleDateString("es-AR")}catch{return e.toISOString()}if(typeof e=="number"){const i=new Date(e);if(!Number.isNaN(i.getTime()))try{return i.toLocaleDateString("es-AR")}catch{return i.toISOString().split("T")[0]||""}return""}if(typeof e!="string")return"";const t=e.trim();if(!t)return"";const n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n)return`${n[3]}/${n[2]}/${n[1]}`;const o=new Date(t);if(!Number.isNaN(o.getTime()))try{return o.toLocaleDateString("es-AR")}catch{return t}return t}function Mo(e,t){const n=u(e);return n||Ya(t)}function z(e){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ye(e){return u(e)||"—"}function Ja(e){const t=u(e).toLowerCase();return Ka[t]||"jpg"}function Xa(e,t,n,o){const a=(u(e)||`${t}-foto-${n+1}`).replace(/[\\/]/g,"-").replace(/[^a-zA-Z0-9._-]+/g,"_"),s=Ja(o);return a.toLowerCase().endsWith(`.${s}`)?a:`${a.replace(/\.[^.]+$/,"")}.${s}`}function ot(e){const t=u(e);if(!t)return"";try{return`${No}${encodeURIComponent(t)}`}catch{return`${No}${t}`}}function Dt(e){const t=u(e);if(!t||t.startsWith("data:"))return"";const n=t.match(/[?&]id=([a-zA-Z0-9_-]+)/);if(n&&n[1])return n[1];const o=t.match(/\/d\/([a-zA-Z0-9_-]+)/);return o&&o[1]?o[1]:/^[a-zA-Z0-9_-]{10,}$/.test(t)?t:""}function yi(e=0){return{index:e,previewUrl:"",base64Data:"",mimeType:"",fileName:"",url:"",driveId:"",shouldRemove:!1}}function Ln(){return Array.from({length:De},(e,t)=>yi(t))}function je(e){const t=Ln();return Array.isArray(e)?t.map((n,o)=>{const i=e[o];if(!i||typeof i!="object")return n;const r=u(i.url),a=u(i.driveId||i.driveFileId)||Dt(r);return{...n,previewUrl:u(i.previewUrl),base64Data:u(i.base64Data),mimeType:u(i.mimeType),fileName:u(i.fileName),url:a?ot(a):r,driveId:a,shouldRemove:!!i.shouldRemove}}):t}function Qa(e=[],t=[]){const n=Ln();return n.forEach((o,i)=>{if(i>=n.length)return;const r=Array.isArray(e)?u(e[i]):"",a=Array.isArray(t)?u(t[i]):"",s=r||Dt(a),l=s?ot(s):a;o.driveId=s,o.url=l}),n}function es(e){const t=u(e);if(!t)return"";const n=t.indexOf(",");return n!==-1?t.slice(n+1):t}function ts(e){if(!e||typeof e!="object")return"";const t=u(e.previewUrl);if(t)return t;const n=u(e.driveId);if(n)return ot(n);const o=u(e.url),i=Dt(o);return i?ot(i):o}function qt(e){return!e||typeof e!="object"?!1:!!(u(e.previewUrl)||u(e.url)||u(e.driveId)||u(e.base64Data))}function ns(e){if(!e||typeof e!="object")return"Sin foto seleccionada";if(u(e.fileName))return e.fileName;const t=u(e.driveId);return t?`Foto en Drive (${t.slice(0,8)}...)`:u(e.url)?e.url:"Sin foto seleccionada"}function os(){return typeof FileReader<"u"}function is(e){return new Promise((t,n)=>{if(!e||typeof FileReader>"u"){n(new Error("La lectura de archivos no es compatible."));return}const o=new FileReader;o.onload=()=>t(o.result),o.onerror=()=>n(new Error("No se pudo leer el archivo seleccionado.")),o.readAsDataURL(e)})}const rs=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),as=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),ss=Object.freeze(["direccion","Direccion","domicilio","Domicilio"]),cs=Object.freeze(["telefono","Telefono","tel","Tel","celular","Celular"]),ls=Object.freeze(["email","Email","mail","Mail","correo","Correo"]),ds=Object.freeze(["cuit","CUIT"]);function us(){const e=new Date;if(Number.isNaN(e.getTime()))return"";const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function fs(e){if(!e||typeof e!="object")return{numeroRemito:"",numeroReporte:"",cliente:"",fechaRemito:"",fechaRemitoISO:"",fechaServicio:"",fechaServicioISO:"",tecnico:"",observaciones:"",direccion:"",telefono:"",email:"",cuit:"",reporteId:""};const t=e.fechaRemitoISO??e.FechaRemitoISO,n=e.fechaServicioISO??e.FechaServicioISO,o=j(e,["numeroRemito","NumeroRemito"]),i=j(e,["numeroReporte","NumeroReporte"]),r=j(e,["cliente","Cliente","NombreCliente"]),a=j(e,["fechaRemito","FechaRemito","FechaCreacion"]),s=j(e,["fechaRemitoISO","FechaRemitoISO","FechaCreacionISO"]),l=j(e,["fechaServicio","FechaServicio"]),d=j(e,["tecnico","Tecnico","MailTecnico"]),f=j(e,["observaciones","Observaciones"]),_=j(e,["direccion","Direccion"]),h=j(e,["telefono","Telefono"]),E=j(e,["email","Email","MailCliente"]),v=j(e,["cuit","CUIT","cliente_cuit"]),b=j(e,["reporteId","ReporteID","IdUnico","IDInterna"]),I=Za.map(C=>u(j(e,C))||""),x=I.map(C=>Dt(C)),m=I.map((C,M)=>{const w=x[M];return w?ot(w):C});return{numeroRemito:u(o),numeroReporte:u(i),cliente:u(r),fechaRemito:Mo(a,s??t),fechaRemitoISO:u(s??t),fechaServicio:Mo(l,n),fechaServicioISO:u(n),tecnico:u(d),observaciones:u(f),direccion:u(_),telefono:u(h),email:u(E),cuit:u(v),reporteId:u(b),Foto1Id:x[0]||"",Foto2Id:x[1]||"",Foto3Id:x[2]||"",Foto4Id:x[3]||"",Foto1URL:m[0]||"",Foto2URL:m[1]||"",Foto3URL:m[2]||"",Foto4URL:m[3]||"",fotos:m,fotosDriveIds:x}}function Sn(){return{numeroRemito:"",numeroReporte:"",cliente:"",fechaRemitoISO:us(),fechaServicioISO:"",tecnico:"",observaciones:"",direccion:"",telefono:"",email:"",cuit:"",reporteId:"",fotos:Ln()}}function Ro(e){const t=u(e);if(!t)return"";if(/^\d{4}-\d{2}-\d{2}/.test(t))return t.slice(0,10);if(/^\d{2}\/\d{2}\/\d{4}$/.test(t)){const[o,i,r]=t.split("/");return`${r}-${i}-${o}`}const n=new Date(t);return Number.isNaN(n.getTime())?"":n.toISOString().split("T")[0]}function ms(e={}){return{numeroRemito:u(e.numeroRemito),numeroReporte:u(e.numeroReporte),cliente:u(e.cliente),fechaRemitoISO:Ro(e.fechaRemitoISO||e.fechaRemito),fechaServicioISO:Ro(e.fechaServicioISO||e.fechaServicio),tecnico:u(e.tecnico),observaciones:u(e.observaciones),direccion:u(e.direccion),telefono:u(e.telefono),email:u(e.email),cuit:u(e.cuit),reporteId:u(e.reporteId),fotos:Qa(Array.isArray(e.fotosDriveIds)?e.fotosDriveIds:[],Array.isArray(e.fotos)?e.fotos:[])}}function ps(e,t,n=0){const o=u(e)||u(t);if(o){const i=o.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");if(i)return`cliente-${i}-${n}`}return`cliente-${n}`}function gs(e,t=0){if(!e||typeof e!="object")return null;const n=u(j(e,rs)),o=u(j(e,as)),i=u(j(e,ss)),r=u(j(e,cs)),a=u(j(e,ls)),s=u(j(e,ds)),l=n||o;if(!l)return null;const d=ps(o,l,t),f=Array.from(new Set([n,o,l].map(_=>u(_).toLowerCase()).filter(_=>!!_)));return{key:d,id:o,label:l,nombre:n||o||"",direccion:i,telefono:r,email:a,cuit:s,matchValues:f}}function hs(e=[]){return Array.isArray(e)?e.map((t,n)=>gs(t,n)).filter(t=>t!==null):[]}function _i(e){return!e||!Array.isArray(c.clienteOptions)?null:c.clienteOptions.find(t=>t.key===e)||null}function bs(e){const t=u(e).toLowerCase();return!t||!Array.isArray(c.clienteOptions)?null:c.clienteOptions.find(n=>n.matchValues.includes(t))||null}function ln(){var o;const e=u(c.selectedClienteKey);if(e&&_i(e))return;const t=u((o=c.formData)==null?void 0:o.cliente);if(!t){c.selectedClienteKey="";return}const n=bs(t);c.selectedClienteKey=n?n.key:""}function ys(e){const t=_i(e);c.selectedClienteKey=t?t.key:"",t&&(c.formData.cliente=t.nombre||t.label||"",c.formData.direccion=t.direccion||"",c.formData.telefono=t.telefono||"",c.formData.email=t.email||"",c.formData.cuit=t.cuit||"")}function _s(){if(!Array.isArray(c.clienteOptions)||c.clienteOptions.length===0)return"";const e=u(c.selectedClienteKey);return c.clienteOptions.map(t=>{const n=e&&t.key===e?" selected":"",o=z(t.label||t.nombre||t.id||"");return`<option value="${t.key}"${n}>${o}</option>`}).join("")}function vs(e,t,n){const o=ts(e),i=!!o,r=z(ns(e)),a=["group relative flex w-full items-center justify-center overflow-hidden rounded-xl border-2","min-h-[180px]",i?"border-transparent bg-gray-900/5":"border-dashed border-gray-300 bg-gray-50","text-gray-400 transition focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60"].join(" "),s=i?`
            <img src="${z(o)}" alt="Foto ${t+1}" class="max-h-72 max-w-full object-contain mx-auto" loading="lazy">
        `:`
            <div class="flex flex-col items-center justify-center gap-2 text-gray-400">
                <span class="text-5xl font-light leading-none">+</span>
                <span class="text-xs font-medium">Agregar foto</span>
            </div>
        `,l=i?`
            <button type="button" class="absolute right-3 top-3 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-red-500 shadow-md transition hover:bg-red-50 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="remove" data-remito-photo-index="${t}" title="Eliminar foto" aria-label="Eliminar foto"${n}>
                <span aria-hidden="true" class="text-lg leading-none">&times;</span>
            </button>
        `:"",d=`
        <div class="absolute inset-0 z-10 hidden items-center justify-center rounded-xl bg-black/40 p-4" data-remito-photo-menu="${t}" aria-hidden="true">
            <button type="button" class="absolute inset-0 cursor-default" data-remito-photo-menu-dismiss></button>
            <div class="relative z-10 w-full max-w-[220px] space-y-2 rounded-lg bg-white p-4 text-center shadow-lg">
                <p class="text-sm font-semibold text-gray-700">Seleccioná una opción</p>
                <button type="button" class="w-full rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="capture" data-remito-photo-index="${t}"${n}>Tomar foto</button>
                <button type="button" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-photo-action="upload" data-remito-photo-index="${t}"${n}>Subir foto</button>
                <button type="button" class="w-full rounded-lg border border-transparent bg-gray-100 px-3 py-2 text-sm font-semibold text-gray-600 transition hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-photo-menu-dismiss>Cerrar</button>
            </div>
        </div>
    `;return`
        <div class="remito-photo-slot space-y-2" data-remito-photo-slot="${t}">
            <div class="flex items-center justify-between gap-2">
                <p class="text-sm font-medium text-gray-700">Foto ${t+1}</p>
                <p class="max-w-[60%] truncate text-[11px] text-gray-500">${r}</p>
            </div>
            <div class="relative">
                <button type="button" class="${a}" data-remito-photo-trigger data-remito-photo-index="${t}" aria-label="Agregar o reemplazar foto ${t+1}"${n}>
                    ${s}
                </button>
                ${l}
                ${d}
            </div>
            <input type="file" accept="image/*" capture="environment" class="hidden" data-remito-photo-input="capture" data-remito-photo-index="${t}"${n}>
            <input type="file" accept="image/*" class="hidden" data-remito-photo-input="upload" data-remito-photo-index="${t}"${n}>
        </div>
    `}function Es(e){var d;const t=e?" disabled":"",n=je((d=c.formData)==null?void 0:d.fotos);let o=-1;for(let f=0;f<n.length;f+=1){if(qt(n[f])&&f===o+1){o=f;continue}if(f===o+1&&!qt(n[f]))break}let i=-1;for(let f=0;f<n.length;f+=1)qt(n[f])&&(i=f);const r=Math.min(o+1,De-1),a=Math.max(r,i),s=Math.max(1,Math.min(n.length,a+1));return`
        <div class="space-y-3">
            <div class="flex flex-col gap-1">
                <span class="text-sm font-medium text-gray-700">Fotos del servicio</span>
                <span class="text-xs text-gray-500">Podés subir hasta cuatro imágenes. Cada archivo puede pesar hasta 5 MB.</span>
            </div>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                ${n.slice(0,s).map((f,_)=>vs(f,_,t)).join("")}
            </div>
        </div>
    `}function it(){if(typeof document>"u")return;document.querySelectorAll("[data-remito-photo-menu]").forEach(t=>{t.classList.add("hidden"),t.setAttribute("aria-hidden","true")})}function xs(e){if(typeof document>"u")return;const t=Number(e);if(!Number.isFinite(t)||t<0||t>=De)return;const n=`[data-remito-photo-menu="${t}"]`,o=document.querySelector(n);if(!o)return;const i=o.classList.contains("hidden");it(),i&&(o.classList.remove("hidden"),o.setAttribute("aria-hidden","false"))}function Is(e={}){const t=u(e.fechaRemitoISO),n=u(e.fechaServicioISO),o=je(e.fotos);return{numeroRemito:u(e.numeroRemito),numeroReporte:u(e.numeroReporte),cliente:u(e.cliente),fechaRemito:t,fechaRemitoISO:t,fechaServicio:n,fechaServicioISO:n,tecnico:u(e.tecnico),observaciones:u(e.observaciones),direccion:u(e.direccion),telefono:u(e.telefono),email:u(e.email),cuit:u(e.cuit),reporteId:u(e.reporteId),fotos:o.map((i,r)=>({slot:r+1,url:u(i.url),base64Data:u(i.base64Data),mimeType:u(i.mimeType),fileName:u(i.fileName),driveFileId:u(i.driveId),shouldRemove:!!i.shouldRemove}))}}function ws(e={}){const t=u(e.numeroRemito),n=u(e.numeroReporte),o=u(e.cliente),i=u(e.fechaRemitoISO),r=u(e.fechaRemito)||i,a=u(e.fechaServicioISO),s=u(e.fechaServicio)||a,l=u(e.tecnico),d=u(e.observaciones),f=u(e.direccion),_=u(e.telefono),h=u(e.email),E=u(e.cuit),v=u(e.reporteId),b={NumeroRemito:t||void 0,numero_remito:t||void 0,remitoNumero:t||void 0,NumeroReporte:n||void 0,numero_reporte:n||void 0,numeroReporte:n||void 0,clienteNombre:o||void 0,Cliente:o||void 0,cliente:o||void 0,fecha_display:r||void 0,FechaRemito:r||void 0,FechaRemitoISO:i||void 0,fecha:s||void 0,fecha_servicio:s||void 0,Fecha_Servicio:s||void 0,FechaServicio:s||void 0,FechaServicioISO:a||void 0,tecnico:l||void 0,Tecnico:l||void 0,observaciones:d||void 0,Observaciones:d||void 0,direccion:f||void 0,Direccion:f||void 0,cliente_direccion:f||void 0,cliente_telefono:_||void 0,telefono_cliente:_||void 0,Telefono:_||void 0,cliente_email:h||void 0,email:h||void 0,Email:h||void 0,cliente_cuit:E||void 0,cuit:E||void 0,CUIT:E||void 0,reporteId:v||void 0,ID:v||void 0,Id:v||void 0,ID_Unico:v||void 0},x=je(e.fotos).map(m=>u(m.driveId)).filter(m=>!!m);return x.length>0&&(b.fotosDriveIds=x,b.fotos_drive_ids=x,b.fotoIds=x),Object.fromEntries(Object.entries(b).filter(([,m])=>m!==void 0&&m!==""))}function Ls(e={}){const t=ws(e);if(!t||Object.keys(t).length===0)throw new Error("No se pudo generar la información del remito para enviarla al servidor.");const n={reporteData:t},o=u(e.observaciones);if(o&&(n.observaciones=o),Array.isArray(e.fotos)){const i=e.fotos.map(r=>{if(!r||typeof r!="object")return null;const a=Number(r.slot),s=u(r.base64Data),l=u(r.mimeType),d=u(r.fileName),f=u(r.url),_=u(r.driveFileId||r.driveId),h=!!r.shouldRemove;if(!s&&!f&&!_&&!h)return null;const E={};return Number.isFinite(a)&&a>0&&(E.slot=a),s&&(E.base64Data=s),l&&(E.mimeType=l),d&&(E.fileName=d),f&&(E.url=f),_&&(E.driveFileId=_),h&&(E.shouldRemove=!0),E}).filter(Boolean);i.length>0&&(n.fotos=i)}return n}function Ss(e={}){const t=[];return c.formMode==="edit"&&!u(e.numeroRemito)&&t.push("El número de remito es obligatorio."),u(e.cliente)||t.push("El nombre del cliente es obligatorio."),t}function An(e){return!e||typeof e!="object"?"":u(e.reporteId)||u(e.numeroRemito)}const c={remitos:[],currentPage:1,totalPages:0,totalItems:0,pageSize:Ga,isLoading:!1,lastError:null,viewMode:"list",formMode:"create",formData:Sn(),editingRemitoId:null,editingRemitoLabel:"",editingRemitoOriginal:null,isSaving:!1,isDeleting:!1,deletingIndex:null,feedback:null,clienteOptions:[],clientesLoaded:!1,isLoadingClientes:!1,clientesError:null,selectedClienteKey:""};function lt(){(!c.formData||typeof c.formData!="object")&&(c.formData=Sn()),c.formData.fotos=je(c.formData.fotos)}const vi={obtenerRemitos:async()=>{throw new Error("La función obtenerRemitos no fue provista.")},crearRemito:async()=>{throw new Error("La función crearRemito no fue provista.")},actualizarRemito:async()=>{throw new Error("La función actualizarRemito no fue provista.")},eliminarRemito:async()=>{throw new Error("La función eliminarRemito no fue provista.")},obtenerClientes:async()=>{throw new Error("La función obtenerClientes no fue provista.")}};let Be={...vi};function As(e={}){Be={...vi,...e||{}}}async function Ei({force:e=!1,reRender:t=!1}={}){const n=Be.obtenerClientes;if(typeof n!="function"){c.clienteOptions=[],c.clientesLoaded=!1,c.clientesError="No se configuró la función para obtener clientes.",t&&U();return}if(!c.isLoadingClientes){if(!e&&c.clientesLoaded&&Array.isArray(c.clienteOptions)&&c.clienteOptions.length>0){ln();return}c.isLoadingClientes=!0,t&&U();try{const o=await n({forceRefresh:!!e});c.clienteOptions=hs(o),c.clientesLoaded=!0,c.clientesError=null,ln()}catch(o){c.clienteOptions=[],c.clientesLoaded=!1,c.clientesError=(o==null?void 0:o.message)||"No se pudieron cargar los clientes."}finally{c.isLoadingClientes=!1,t&&U()}}}function Ft(){return document.getElementById("remitos-gestion-container")}function Ts(){const e=Ft();e&&(e.innerHTML=`
        <div class="flex items-center justify-center rounded-xl border border-gray-200 bg-white p-10 shadow-sm">
            <span class="text-gray-600 text-sm font-medium">Cargando remitos...</span>
        </div>
    `)}function Cs(e){const t=Ft();if(!t)return;const n=z(e);t.innerHTML=`
        <div class="rounded-xl border border-red-200 bg-red-50 p-6 shadow-sm">
            <h3 class="text-base font-semibold text-red-700 mb-2">No se pudieron cargar los remitos</h3>
            <p class="text-sm text-red-600 mb-4">${n}</p>
            <button type="button" class="inline-flex items-center rounded-lg border border-red-200 bg-white px-4 py-2 text-sm font-medium text-red-700 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-1" data-remitos-action="reload">
                Reintentar
            </button>
        </div>
    `}function ae(e,t){const n=u(t);if(!e||!n){c.feedback=null;return}c.feedback={type:e,message:n}}function Je({viewMode:e="list"}={}){c.formMode="create",c.formData=Sn(),lt(),c.editingRemitoId=null,c.editingRemitoLabel="",c.editingRemitoOriginal=null,c.viewMode=e,c.selectedClienteKey=""}function U(){const e=Ft();if(!e)return;lt();const t=c.isSaving||c.isLoading,n=t?"disabled":"",o=_s(),i=c.isLoadingClientes?"Cargando clientes...":"Seleccioná un cliente",r=c.clientesError?`<p class="mt-1 text-xs text-red-600">${z(c.clientesError)}</p>`:'<p class="mt-1 text-xs text-gray-500">Seleccioná un cliente para completar los datos automáticamente.</p>',a=t||c.isLoadingClientes?"disabled":"",s=c.formMode==="create"&&!u(c.formData.numeroRemito),l=s?' placeholder="Se asignará automáticamente"':"",d=s?'<p class="mt-1 text-xs text-gray-500">Se asignará automáticamente al guardar.</p>':"",f=c.formMode==="edit"&&u(c.formData.numeroReporte)?`
            <div class="flex flex-col gap-1">
                <label for="remito-form-reporte" class="text-sm font-medium text-gray-700">Número de reporte</label>
                <input id="remito-form-reporte" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" value="${z(c.formData.numeroReporte)}" readonly ${n}>
            </div>
        `:"",_=c.formMode==="edit"?c.isSaving?"Guardando cambios...":"Actualizar remito":c.isSaving?"Guardando remito...":"Crear remito",h=c.feedback?`<div class="rounded-lg border ${c.feedback.type==="error"?"border-red-200 bg-red-50 text-red-700":"border-green-200 bg-green-50 text-green-700"} px-4 py-3 text-sm font-medium">${z(c.feedback.message)}</div>`:"",E=c.formMode==="edit"?"Editar remito":"Registrar nuevo remito",v=z(c.editingRemitoLabel||c.formData.numeroRemito||""),b=c.formMode==="edit"?`Estás editando el remito ${v}.`:"Completá los datos para registrar un remito manualmente.",I=[`<button type="button" class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="back-to-list" ${n}>Volver al listado</button>`];c.formMode==="edit"&&I.unshift(`<button type="button" class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="cancel-edit" ${n}>Cancelar edición</button>`);const x=I.join(""),m=Es(t);if(c.viewMode==="form"){e.innerHTML=`
            <div class="space-y-6">
                ${h?`<div>${h}</div>`:""}
                <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                    <div class="border-b border-gray-100 px-6 py-5">
                        <h3 class="text-lg font-semibold text-gray-800">${z(E)}</h3>
                        <p class="mt-1 text-sm text-gray-500">${b}</p>
                    </div>
                    <form id="remito-abm-form" class="space-y-5 px-6 py-6">
                        <div class="space-y-4">
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-numero" class="text-sm font-medium text-gray-700">Número de remito</label>
                                <input id="remito-form-numero" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="numeroRemito" value="${z(c.formData.numeroRemito)}"${l} readonly ${n}>
                                ${d}
                            </div>
                            ${f}
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cliente-select" class="text-sm font-medium text-gray-700">Cliente *</label>
                                <select id="remito-form-cliente-select" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" ${a}>
                                    <option value="">${z(i)}</option>
                                    ${o}
                                </select>
                                ${r}
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cliente" class="text-sm font-medium text-gray-700">Razón social / Cliente *</label>
                                <input id="remito-form-cliente" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="cliente" value="${z(c.formData.cliente)}" placeholder="Nombre del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-fecha" class="text-sm font-medium text-gray-700">Fecha del remito</label>
                                <input id="remito-form-fecha" type="date" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="fechaRemitoISO" value="${z(c.formData.fechaRemitoISO)}" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-tecnico" class="text-sm font-medium text-gray-700">Técnico</label>
                                <input id="remito-form-tecnico" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="tecnico" value="${z(c.formData.tecnico)}" placeholder="Nombre del técnico" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-direccion" class="text-sm font-medium text-gray-700">Dirección</label>
                                <input id="remito-form-direccion" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="direccion" value="${z(c.formData.direccion)}" placeholder="Domicilio del servicio" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-telefono" class="text-sm font-medium text-gray-700">Teléfono</label>
                                <input id="remito-form-telefono" type="tel" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="telefono" value="${z(c.formData.telefono)}" placeholder="Teléfono de contacto" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-email" class="text-sm font-medium text-gray-700">Email</label>
                                <input id="remito-form-email" type="email" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="email" value="${z(c.formData.email)}" placeholder="Correo electrónico del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-cuit" class="text-sm font-medium text-gray-700">CUIT</label>
                                <input id="remito-form-cuit" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="cuit" value="${z(c.formData.cuit)}" placeholder="CUIT del cliente" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-reporte-id" class="text-sm font-medium text-gray-700">Número de referencia, O.C, Presupuesto</label>
                                <input id="remito-form-reporte-id" type="text" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="reporteId" value="${z(c.formData.reporteId)}" placeholder="Identificador asociado" ${n}>
                            </div>
                            <div class="flex flex-col gap-1">
                                <label for="remito-form-observaciones" class="text-sm font-medium text-gray-700">Observaciones</label>
                                <textarea id="remito-form-observaciones" rows="3" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500" data-remito-field="observaciones" placeholder="Notas adicionales" ${n}>${z(c.formData.observaciones)}</textarea>
                            </div>
                        </div>
                        ${m}
                        <div class="flex flex-col-reverse gap-3 sm:flex-row sm:justify-end">
                            ${x}
                            <button type="submit" class="inline-flex justify-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" ${n}>
                                ${z(_)}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        `;return}const C=c.remitos.length?c.remitos.map((k,W)=>{const oe=z(ye(k.numeroRemito)),Q=z(ye(k.fechaRemito)),ee=z(ye(k.cliente)),ce=z(ye(k.numeroReporte)),de=c.isDeleting&&c.deletingIndex===W;return`
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-700">${oe}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${Q}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ee}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${ce}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center justify-end gap-3">
                                <button type="button" class="text-sm font-semibold text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remito-detalle="${W}">
                                    Ver detalle
                                </button>
                                <button type="button" class="text-sm font-semibold text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2" data-remito-edit="${W}">
                                    Editar
                                </button>
                                <button type="button" class="text-sm font-semibold text-red-600 hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remito-delete="${W}" ${de?"disabled":""}>
                                    ${de?"Eliminando...":"Eliminar"}
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join(""):`
            <tr>
                <td colspan="5" class="px-6 py-10 text-center text-sm text-gray-500">
                    No hay remitos registrados todavía. Usá el botón "Crear nuevo remito" para cargar uno.
                </td>
            </tr>
        `,M=c.totalPages>0?`Página ${c.currentPage} de ${c.totalPages}`:"Página 1 de 1",w=(c.currentPage-1)*c.pageSize+1,R=w+c.remitos.length-1,A=c.totalItems>0?`Mostrando ${w} - ${R} de ${c.totalItems} remitos`:"No hay remitos registrados.",D=c.isLoading||c.isSaving?"disabled":"";e.innerHTML=`
        <div class="space-y-6">
            ${h?`<div>${h}</div>`:""}
            <div class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
                <div class="flex flex-col gap-3 border-b border-gray-100 px-6 py-4 md:flex-row md:items-center md:justify-between">
                    <div class="flex flex-col">
                        <h3 class="text-lg font-semibold text-gray-800">Listado de Remitos</h3>
                        <span class="text-sm text-gray-500">${z(M)}</span>
                    </div>
                    <button type="button" class="inline-flex items-center justify-center rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="open-create" ${D}>
                        Crear nuevo remito
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Número de Remito</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Fecha</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Cliente</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-gray-500">Número de Reporte</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-semibold uppercase tracking-wide text-gray-500">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-white">
                            ${C}
                        </tbody>
                    </table>
                </div>
                <div class="flex flex-col gap-3 border-t border-gray-100 px-6 py-4 md:flex-row md:items-center md:justify-between">
                    <div class="text-sm text-gray-500">${z(A)}</div>
                    <div class="flex items-center gap-3">
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="prev" ${c.currentPage<=1?"disabled":""}>
                            Anterior
                        </button>
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60" data-remitos-action="next" ${c.totalPages===0||c.currentPage>=c.totalPages?"disabled":""}>
                            Siguiente
                        </button>
                        <button type="button" class="inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" data-remitos-action="reload">
                            Actualizar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Ns(e){if(!Array.isArray(c.remitos)||c.remitos.length===0||!Number.isFinite(e)||e<0||e>=c.remitos.length)return;const t=c.remitos[e];if(!t)return;const n=[`Número de Remito: ${ye(t.numeroRemito)}`,`Fecha del Remito: ${ye(t.fechaRemito)}`,`Cliente: ${ye(t.cliente)}`,`Número de Reporte: ${ye(t.numeroReporte)}`];[["Número de referencia, O.C, Presupuesto",t.reporteId],["Fecha del Servicio",t.fechaServicio],["Técnico",t.tecnico],["Dirección",t.direccion],["Teléfono",t.telefono],["Email",t.email],["Observaciones",t.observaciones]].forEach(([r,a])=>{const s=u(a);s&&n.push(`${r}: ${s}`)});const i=n.join(`
`);i&&typeof window<"u"&&typeof window.alert=="function"&&window.alert(i)}function Ms(e){if(!Array.isArray(c.remitos)||c.remitos.length===0||!Number.isFinite(e)||e<0||e>=c.remitos.length)return;const t=c.remitos[e];t&&(c.formMode="edit",c.formData=ms(t),lt(),c.editingRemitoId=An(t),c.editingRemitoLabel=u(t.numeroRemito)||u(t.reporteId),c.editingRemitoOriginal=t,ln(),c.viewMode="form",U(),Ei({reRender:!0}))}async function Rs(e){if(c.isDeleting||c.isSaving||!Array.isArray(c.remitos)||e<0||e>=c.remitos.length)return;const t=c.remitos[e];if(!t)return;const n=An(t);if(!n){ae("error","No se pudo determinar el remito a eliminar."),U();return}if(!(typeof window<"u"&&typeof window.confirm=="function"&&!window.confirm(`¿Seguro que querés eliminar el remito ${t.numeroRemito||n}?`))){c.isDeleting=!0,c.deletingIndex=e,U();try{await Be.eliminarRemito({remitoId:n,numeroRemito:t.numeroRemito,reporteId:t.reporteId}),ae("success","El remito se eliminó correctamente."),c.formMode==="edit"&&n===c.editingRemitoId&&Je(),c.isDeleting=!1,c.deletingIndex=null;const r=c.remitos.length-1===0&&c.currentPage>1?c.currentPage-1:c.currentPage;await Pe({page:r})}catch(o){c.isDeleting=!1,c.deletingIndex=null,ae("error",(o==null?void 0:o.message)||"No se pudo eliminar el remito."),U()}}}async function Ds(e,t){var o;if(c.isSaving||c.isLoading)return;const n=Number(e);if(!(!Number.isFinite(n)||n<0||n>=De)&&t){if(!t.type||!t.type.startsWith("image/")){ae("error","Solo se pueden cargar archivos de imagen."),U();return}if(t.size&&t.size>Wa){ae("error","La foto supera el límite de 5 MB permitido."),U();return}if(!os()){ae("error","El navegador no permite procesar imágenes desde este formulario."),U();return}try{const i=await is(t),r=es(i),a=u(t.type)||"image/jpeg",s=u((o=c.formData)==null?void 0:o.numeroRemito)||"remito",l=Xa(t.name,s,n,a);lt();const d=je(c.formData.fotos);d[n]={index:n,previewUrl:typeof i=="string"?i:"",base64Data:r,mimeType:a,fileName:l,url:"",driveId:"",shouldRemove:!1},c.formData.fotos=d,ae(null),U()}catch(i){ae("error",(i==null?void 0:i.message)||"No se pudo procesar la foto seleccionada."),U()}}}function Fs(e){const t=Number(e);if(!Number.isFinite(t)||t<0||t>=De)return;it(),lt();const n=je(c.formData.fotos),o=n[t],i=!!(o!=null&&o.url);n[t]={...yi(t),shouldRemove:i},c.formData.fotos=n,U()}function $s(e,t){if(!e)return;const n=Number(t);if(!Number.isFinite(n)||n<0||n>=De)return;if(e==="remove"){Fs(n);return}if(c.isSaving||c.isLoading||typeof document>"u")return;it();const o=`[data-remito-photo-input="${e}"][data-remito-photo-index="${n}"]`,i=document.querySelector(o);i&&(i.value="",i.click())}function xi(e){var n,o;const t=(o=(n=e==null?void 0:e.target)==null?void 0:n.dataset)==null?void 0:o.remitoField;!t||!(t in c.formData)||(c.formData[t]=e.target.value)}function Os(e){xi(e)}function Ps(e){var o;const t=e==null?void 0:e.target;if(!t)return;if((o=t.dataset)==null?void 0:o.remitoPhotoInput){const i=Number.parseInt(t.dataset.remitoPhotoIndex??"",10),r=t.files&&t.files[0];Number.isFinite(i)&&i>=0&&i<De&&r&&Ds(i,r),t.value="";return}if(t.id==="remito-form-cliente-select"){const i=typeof t.value=="string"?t.value:"";ys(i),U();return}xi(e)}async function zs(){if(c.isSaving||c.isLoading)return;const e=Ss(c.formData);if(e.length>0){ae("error",e.join(" ")),U();return}const t=Is(c.formData),n=c.currentPage||1,o=c.formMode==="edit";c.isSaving=!0,U();try{if(o){const i=c.editingRemitoId||An(c.editingRemitoOriginal)||u(c.formData.reporteId)||u(c.formData.numeroRemito);if(!i)throw new Error("No se pudo determinar el remito a actualizar.");await Be.actualizarRemito({...t,remitoId:i}),ae("success","El remito se actualizó correctamente.")}else{const i=Ls(t),r=await Be.crearRemito(i),a=u((r==null?void 0:r.NumeroRemito)||(r==null?void 0:r.numeroRemito));ae("success",a?`El remito ${a} se creó correctamente.`:"El remito se creó correctamente.")}Je(),c.isSaving=!1,await Pe({page:n})}catch(i){c.isSaving=!1,ae("error",(i==null?void 0:i.message)||"No se pudo guardar el remito."),U()}}function ks(e){e.target&&e.target.id==="remito-abm-form"&&(e.preventDefault(),zs())}function Bs(e){if(!(!e||c.isLoading)){if(e==="prev"){c.currentPage>1&&Pe({page:c.currentPage-1});return}if(e==="next"){c.totalPages>0&&c.currentPage<c.totalPages&&Pe({page:c.currentPage+1});return}if(e==="reload"){const t=c.currentPage&&c.currentPage>0?c.currentPage:1;Pe({page:t});return}if(e==="open-create"){Je({viewMode:"form"}),U(),Ei({reRender:!0});return}if(e==="back-to-list"){Je({viewMode:"list"}),U();return}if(e==="cancel-edit"){Je({viewMode:"form"}),U();return}}}function Hs(e){if(!!e.target.closest("[data-remito-photo-menu]")||it(),e.target.closest("[data-remito-photo-menu-dismiss]")){e.preventDefault(),it();return}const o=e.target.closest("[data-remito-photo-trigger]");if(o){e.preventDefault(),xs(o.dataset.remitoPhotoIndex);return}const i=e.target.closest("[data-remitos-action]");if(i){e.preventDefault(),Bs(i.dataset.remitosAction);return}const r=e.target.closest("[data-remito-photo-action]");if(r){e.preventDefault(),$s(r.dataset.remitoPhotoAction,r.dataset.remitoPhotoIndex);return}const a=e.target.closest("[data-remito-detalle]");if(a){e.preventDefault();const d=Number.parseInt(a.dataset.remitoDetalle,10);Number.isFinite(d)&&Ns(d);return}const s=e.target.closest("[data-remito-edit]");if(s){e.preventDefault();const d=Number.parseInt(s.dataset.remitoEdit,10);Number.isFinite(d)&&Ms(d);return}const l=e.target.closest("[data-remito-delete]");if(l){e.preventDefault();const d=Number.parseInt(l.dataset.remitoDelete,10);Number.isFinite(d)&&Rs(d)}}async function Pe({page:e}={}){const t=Number.isFinite(Number(e))&&Number(e)>0?Math.floor(Number(e)):c.currentPage&&c.currentPage>0?c.currentPage:1;c.isLoading=!0,c.lastError=null,Ts();try{const n=await Be.obtenerRemitos({page:t,pageSize:c.pageSize}),o=Array.isArray(n==null?void 0:n.remitos)?n.remitos:[];c.remitos=o.map(l=>fs(l));const i=Number(n==null?void 0:n.totalPages);c.totalPages=Number.isFinite(i)&&i>=0?i:0;const r=Number(n==null?void 0:n.totalItems);c.totalItems=Number.isFinite(r)&&r>=0?r:c.remitos.length;const a=Number(n==null?void 0:n.pageSize);Number.isFinite(a)&&a>0&&(c.pageSize=Math.floor(a));let s=Number(n==null?void 0:n.currentPage);(!Number.isFinite(s)||s<=0)&&(s=c.totalPages>0?1:0),c.currentPage=s||t,c.isLoading=!1,U()}catch(n){c.lastError=n;const o=(n==null?void 0:n.message)||"No se pudieron obtener los remitos.";c.isLoading=!1,Cs(o)}finally{c.isLoading=!1}}function Us(e={}){As(e);let t=!1;function n(){if(t)return;const o=Ft();if(!o){console.warn("No se encontró el contenedor de gestión de remitos.");return}o.addEventListener("click",Hs),o.addEventListener("input",Os),o.addEventListener("change",Ps),o.addEventListener("submit",ks),t=!0}return{initialize:n,renderListado:Pe}}const js="tab-ablandador",Vt="softener-maintenance-form",qs="softener-save-button",Vs="softener-reset-button",Gs="softener-autofill-button",Do="softener-pdf-button",Fo="softener-generar-remito-btn",Ws="softener-report-number-display",Ii="softener-autonomia-recomendada",wi="softener-autonomia-seteo-actual",Zs="softener-autonomia-ajustada",dt="softener-volumen-resina",$t="softener-factor-proteccion",ut="softener-dureza-agua-cruda",Li="softener-autonomia-restante",Tn="softener-autonomia-restante-info-btn",Cn="softener-autonomia-restante-info-popup",Nn="softener-cabezal-hora-cabezal-found",Mn="softener-cabezal-hora-cabezal-left",Rn="softener-cabezal-hora-regeneracion-found",Dn="softener-cabezal-hora-regeneracion-left",Fn="softener-cabezal-p1-found",$n="softener-cabezal-p1-left",On="softener-cabezal-p2-found",Pn="softener-cabezal-p2-left",zn="softener-cabezal-p3-found",kn="softener-cabezal-p3-left",Bn="softener-cabezal-p4-found",Hn="softener-cabezal-p4-left",rt="softener-equipo-regeneracion-tipo",Tt="softener-cabezal-frecuencia-dias-found",Ct="softener-cabezal-frecuencia-dias-left",Ks="softener-cabezal-frecuencia-container",Nt="softener-equipo-prefiltro",Un="softener-prefilter-info-btn",jn="softener-prefilter-info-popup",Ys="softener-prefiltracion-section",Js="softener-cambio-filtro-container",ft="softener-check-cambio-filtro",Xs="softener-detalle-cambio-filtro",qn="softener-filtro-tipo-instalado",Vn="softener-filtro-lote-serie",Gn="softener-protection-info-btn",Wn="softener-protection-info-popup",Si="softener-equipo-proteccion-entrada",Zn="softener-manometro-info-btn",Kn="softener-manometro-info-popup",at="softener-equipo-manometros",Ai="softener-cliente-nombre",$o="data-softener-client-option",Xe="data-softener-client-key",Ti=Object.freeze(["softener-cliente-direccion","softener-cliente-telefono","softener-cliente-email","softener-cliente-cuit"]),Oo="client-detail-empty",Po="client-detail-locked",Qs=Object.freeze(["nombre","Nombre","cliente","Cliente","razon_social","RazonSocial"]),ec=Object.freeze(["id","ID","id_cliente","IdCliente","codigo","Codigo","cuit","CUIT"]),vt=Object.freeze({direccion:["direccion","Direccion","domicilio","Domicilio"],telefono:["telefono","Telefono","tel","Tel"],email:["email","Email","mail","Mail","correo","Correo"],cuit:["cuit","CUIT"]}),Qe=new Map,zo=new WeakSet;let Et=null,ko=!1,We=null,Bo=!1;function g(e){return typeof document<"u"?document.getElementById(e):null}function tc(e){if(typeof window<"u"&&typeof window.requestAnimationFrame=="function"){window.requestAnimationFrame(e);return}setTimeout(e,0)}function nc(e){if(e==null)return null;if(typeof e=="number"&&Number.isFinite(e))return e;const t=String(e).replace(",",".").trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}function T(e){const t=g(e);return t&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)?t.value.trim():""}function P(e){return nc(T(e))}function ne(e){const t=g(e);return t instanceof HTMLInputElement?!!t.checked:!1}function oc(e,t){const n=g(e);if(!(n instanceof HTMLInputElement))return;if(t==null||Number.isNaN(t)){n.value="";return}const o=Math.round((t+Number.EPSILON)*100)/100;n.value=Number.isFinite(o)?o.toString():""}function S(e,t){const n=g(e);n&&(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)&&(n.value=t!=null?String(t):"",n.dispatchEvent(new Event("input",{bubbles:!0})))}function te(e,t){const n=g(e);n instanceof HTMLSelectElement&&(n.value=t!=null?String(t):"",n.dispatchEvent(new Event("change",{bubbles:!0})))}function fe(e,t){const n=g(e);!(n instanceof HTMLInputElement)||n.type!=="checkbox"||(n.checked=!!t,n.dispatchEvent(new Event("change",{bubbles:!0})))}function ic(){const e=new Date,t=l=>String(l).padStart(2,"0"),n=e.getFullYear().toString().slice(-2),o=t(e.getMonth()+1),i=t(e.getDate()),r=t(e.getHours()),a=t(e.getMinutes()),s=t(e.getSeconds());return`ABL-${n}${o}${i}-${r}${a}${s}`}function rc(e){const t=g(Ws);t&&(t.textContent=e)}function Yn(e){return e==null?"":String(e).trim()}function Oe(e,t){if(!e||typeof e!="object")return"";for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const o=Yn(e[n]);if(o)return o}return""}function Ho(e){return Oe(e,Qs)}function ac(e){return Oe(e,ec)}function sc(e){return{direccion:Oe(e,vt.direccion),telefono:Oe(e,vt.telefono),email:Oe(e,vt.email),cuit:Oe(e,vt.cuit)}}function dn(e,{lockWhenFilled:t=!1}={}){if(!(e instanceof HTMLInputElement))return;const n=Yn(e.value)!=="";t&&n?(e.readOnly=!0,e.disabled=!1):n||(e.readOnly=!1,e.disabled=!1),n?(e.classList.remove(Oo),t&&e.classList.add(Po)):(e.classList.add(Oo),e.classList.remove(Po))}function Ke(e,t,n={}){const o=g(e);if(!o)return;const i=Yn(t);"value"in o&&(o.value=i),o instanceof HTMLInputElement&&dn(o,{lockWhenFilled:!!n.lockWhenFilled})}function cc(e={}){Ke("softener-cliente-direccion",e.direccion,{lockWhenFilled:!0}),Ke("softener-cliente-telefono",e.telefono,{lockWhenFilled:!0}),Ke("softener-cliente-email",e.email,{lockWhenFilled:!0}),Ke("softener-cliente-cuit",e.cuit,{lockWhenFilled:!0})}function st(){Ti.forEach(e=>{Ke(e,"",{lockWhenFilled:!1})})}function lc(){Ti.forEach(e=>{const t=g(e);t instanceof HTMLInputElement&&(dn(t),zo.has(t)||(t.addEventListener("input",()=>{dn(t)}),zo.add(t)))})}function Uo(e){if(!(e instanceof HTMLSelectElement)){st();return}let t=null;const n=e.selectedOptions&&e.selectedOptions[0];if(n){const o=n.getAttribute(Xe);o&&(t=Qe.get(o)||null)}if(!t&&typeof e.selectedIndex=="number"&&e.selectedIndex>=0){const o=e.options[e.selectedIndex];if(o){const i=o.getAttribute(Xe);i&&(t=Qe.get(i)||null)}}t||(t=Qe.get(e.value)||null),t?cc(t):st()}function un(){const e=g(Ai);if(!(e instanceof HTMLSelectElement)){st();return}const t=e.querySelector('option[value=""]');t?(t.selected=!0,e.value=t.value):e.options.length>0?e.selectedIndex=0:e.value="",st()}function jo(e=[]){const t=g(Ai);if(!(t instanceof HTMLSelectElement))return;const n=Array.isArray(e)?e:[],o=t.value,i=t.selectedOptions&&t.selectedOptions[0],r=i?i.getAttribute(Xe):null,a=t.querySelector('option[value=""]');t.querySelectorAll(`option[${$o}="true"]`).forEach(d=>d.remove()),Qe.clear();const s=document.createDocumentFragment();n.forEach((d,f)=>{if(!d||typeof d!="object")return;const _=ac(d)||Ho(d);if(!_)return;const h=Ho(d)||_,E=document.createElement("option");E.value=_,E.textContent=h;const v=`softener-cliente-${f}`;E.setAttribute($o,"true"),E.setAttribute(Xe,v),s.appendChild(E),Qe.set(v,sc(d))}),t.appendChild(s),Et&&t.removeEventListener("change",Et),Et=()=>{Uo(t)},t.addEventListener("change",Et);let l=!1;if(r){const d=t.querySelector(`option[${Xe}="${r}"]`);d&&(d.selected=!0,t.value=d.value,l=!0)}!l&&o&&(t.value=o,l=t.value===o&&t.selectedIndex!==-1),l?Uo(t):(a?(a.selected=!0,t.value=a.value):t.options.length>0?t.selectedIndex=0:t.value="",st())}async function dc(e){if(!ko){if(We){await We;return}typeof e=="function"&&(We=(async()=>{try{const t=await e({forceRefresh:!1});jo(t),ko=!0}catch(t){console.error("Error al cargar clientes para ablandador:",t),alert("No se pudieron cargar los datos de clientes. Completá los campos manualmente."),jo([])}finally{We=null}})(),await We)}}function uc(e){Bo||(lc(),un(),Bo=!0),typeof e=="function"&&dc(e)}function Gt(){const e=g("softener-fecha-servicio");if(e instanceof HTMLInputElement&&!e.value){const t=new Date,n=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10);e.value=n}}function Wt(){const e=g(dt);e instanceof HTMLInputElement&&!e.value&&(e.value="25")}function qo(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?e:new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,10)}function pe(e){const t={};return e.forEach(([n,o,i])=>{const r=!!(i&&i.includeEmpty);o!==void 0&&(o===""&&!r||o===null&&!r||(t[n]=o))}),t}function Vo(e,t){const n=g(e);n&&"disabled"in n&&(n.disabled=!!t)}function Jn(){const t=T(rt)==="Por Tiempo",n=g(Ks);if(n&&n.style&&(n.style.display=t?"":"none"),Vo(Tt,!t),Vo(Ct,!t),!t){const o=g(Tt);o&&"value"in o&&(o.value="");const i=g(Ct);i&&"value"in i&&(i.value="")}}function fc(){const e=g(rt);e instanceof HTMLSelectElement&&e.addEventListener("change",Jn)}function Zt(){const e=g(Un),t=g(jn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function mc(){const e=g(Un),t=g(jn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function pc(){const e=g(Un),t=g(jn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?mc():Zt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Zt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Zt()}))}function Kt(){const e=g(Gn),t=g(Wn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function gc(){const e=g(Gn),t=g(Wn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function hc(){const e=g(Gn),t=g(Wn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?gc():Kt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Kt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Kt()}))}function Yt(){const e=g(Zn),t=g(Kn);t&&t.classList&&t.classList.add("hidden"),e&&e.setAttribute("aria-expanded","false"),t&&t.setAttribute("aria-hidden","true")}function bc(){const e=g(Zn),t=g(Kn);t&&t.classList&&t.classList.remove("hidden"),e&&e.setAttribute("aria-expanded","true"),t&&t.setAttribute("aria-hidden","false")}function yc(){const e=g(Zn),t=g(Kn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?bc():Yt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Yt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Yt()}))}function Jt(){const e=g(Cn),t=g(Tn);e&&e.classList&&e.classList.add("hidden"),t&&t.setAttribute("aria-expanded","false"),e&&e.setAttribute("aria-hidden","true")}function _c(){const e=g(Cn),t=g(Tn);e&&e.classList&&e.classList.remove("hidden"),t&&t.setAttribute("aria-expanded","true"),e&&e.setAttribute("aria-hidden","false")}function vc(){const e=g(Tn),t=g(Cn);!(e instanceof HTMLButtonElement)||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("hidden")?_c():Jt()}),document.addEventListener("click",n=>{if(!t.classList.contains("hidden")){const o=n.target;t.contains(o)||e.contains(o)||Jt()}}),document.addEventListener("keydown",n=>{n.key==="Escape"&&Jt()}))}function Mt(){const e=T(Nt),t=g(Ys),n=g(Js),o=g(qn),i=e&&e.trim()!==""&&e!=="No Aplica";if(t&&(i?t.classList.remove("hidden"):t.classList.add("hidden")),!!n)if(i)n.classList.remove("hidden"),o&&(o.value=e);else{n.classList.add("hidden");const r=g(ft);r instanceof HTMLInputElement&&(r.checked=!1),Ci()}}function Ci(){const e=g(ft),t=g(Xs);if(!t)return;if(e instanceof HTMLInputElement&&e.checked)t.classList.remove("hidden");else{t.classList.add("hidden");const o=g(Vn);o instanceof HTMLInputElement&&(o.value="")}}function Ec(){const e=g(Nt);e instanceof HTMLSelectElement&&e.addEventListener("change",()=>{Mt()});const t=g(ft);t instanceof HTMLInputElement&&t.addEventListener("change",()=>{Ci()})}function fn(){const t=T(at)==="Manómetros IN / OUT",n=g("softener-presiones-section");n&&(t?n.classList.remove("hidden"):n.classList.add("hidden")),["softener-presion-entrada-found-container","softener-presion-salida-found-container","softener-deltaP-found-container","softener-presion-entrada-left-container","softener-presion-salida-left-container","softener-deltaP-left-container"].forEach(i=>{const r=g(i);r&&r.style&&(r.style.display=t?"":"none")}),t||(["softener-presion-entrada-as-found","softener-presion-salida-as-found","softener-presion-entrada-as-left","softener-presion-salida-as-left"].forEach(r=>{const a=g(r);a&&"value"in a&&(a.value="")}),ct("softener-deltaP-found"),ct("softener-deltaP-left"))}function xc(){const e=g(at);e instanceof HTMLSelectElement&&e.addEventListener("change",fn),fn()}function Ic(e){return e==null||Number.isNaN(e)?"--":`${Number(e).toFixed(2)} bar`}function ct(e){const t=g(e);t&&(t.textContent="--",t.className="inline-block rounded-full px-4 py-2 text-sm font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100")}function Go(e,t,n){const o=g(e);if(!o)return;if(t==null||Number.isNaN(t)){ct(e);return}o.textContent=Ic(t);let r="inline-block rounded-full px-4 py-2 text-sm font-semibold";switch(n){case"green":r+=" bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";break;case"yellow":r+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";break;case"red":r+=" bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";break;default:r+=" bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100"}o.className=r}function Rt(){const e=P("softener-presion-entrada-as-found"),t=P("softener-presion-salida-as-found"),n=P("softener-presion-entrada-as-left"),o=P("softener-presion-salida-as-left"),i=e===null||t===null?null:Math.abs(e-t),r=n===null||o===null?null:Math.abs(n-o);function a(s){return s===null?"neutral":s<.3?"green":s<.5?"yellow":"red"}i===null?ct("softener-deltaP-found"):Go("softener-deltaP-found",i,a(i)),r===null?ct("softener-deltaP-left"):Go("softener-deltaP-left",r,a(r))}function wc(){["softener-presion-entrada-as-found","softener-presion-entrada-as-left","softener-presion-salida-as-found","softener-presion-salida-as-left"].forEach(t=>{const n=g(t);n instanceof HTMLInputElement&&n.addEventListener("input",Rt)}),Rt()}function Xt(){const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),o=`${t}:${n}`,i=g(Nn);i&&"value"in i&&(i.value=o);const r=g(Mn);r&&"value"in r&&(r.value=o);const a=g(Rn);a&&"value"in a&&(a.value="02:00");const s=g(Dn);s&&"value"in s&&(s.value="02:00");const l={[Fn]:"15",[On]:"60",[zn]:"10",[Bn]:"5",[$n]:"15",[Pn]:"60",[kn]:"10",[Hn]:"5"};Object.keys(l).forEach(d=>{const f=g(d);f&&"value"in f&&(f.value=l[d])}),Jn()}function Lc(){const e=["Industria La Plata S.A.","Laboratorio Farmacéutico del Norte","Hotel & Spa Las Termas","Edificio Residencial Torres del Mar","Complejo Deportivo Municipal"],t=["Av. Principal 1234","Calle Independencia 567","Boulevard San Martín 890","Ruta Nacional 9 Km 45","Parque Industrial Sector B"],n=["La Plata, Buenos Aires","Rosario, Santa Fe","Córdoba Capital","Mendoza, Mendoza","Mar del Plata, Buenos Aires"],o=Math.floor(Math.random()*e.length),i=g("softener-cliente-nombre");if(i instanceof HTMLSelectElement){const A=e[o];let D=!1;for(let k=0;k<i.options.length;k++)if(i.options[k].value===A){D=!0;break}if(!D){const k=document.createElement("option");k.value=A,k.textContent=A,i.appendChild(k)}te("softener-cliente-nombre",A)}S("softener-cliente-direccion",t[o]),S("softener-cliente-localidad",n[o]),S("softener-cliente-contacto","Juan Pérez"),S("softener-cliente-telefono","011-4567-8900"),S("softener-cliente-email","contacto@cliente.com.ar"),S("softener-cliente-cuit","30-12345678-9");const r=new Date().toISOString().split("T")[0];S("softener-fecha-servicio",r);const a=["Carlos Rodríguez","Miguel Fernández","Roberto García","Fernando López"];S("softener-tecnico",a[Math.floor(Math.random()*a.length)]);const s=["Todo en uno","Custom","Industrial"],l=["ECO-SOFT-50","ULTRA-SOFT-75","DUPLEX-SOFT-100","PREMIUM-SOFT-60"],d=["Lavadero","Patio","Terraza","Gabinete","Sala de Máquinas"];te("softener-equipo-tipo",s[Math.floor(Math.random()*s.length)]),S("softener-equipo-modelo",l[Math.floor(Math.random()*l.length)]),S("softener-equipo-numero-serie","ABL-2024-"+Math.floor(Math.random()*9e3+1e3)),te("softener-equipo-ubicacion",d[Math.floor(Math.random()*d.length)]),S(dt,(Math.floor(Math.random()*8)+3)*10),te(rt,Math.random()>.5?"Por Volumen":"Por Tiempo");const f=["No Aplica",'Particulas - Mini Blue (10"x2.5")','Particulas - XL (20"x2.5")','CAB - Mini Blue (10"x2.5")','CAB - Jumbo (10"x4.5")','GAC - Mini Blue (10"x2.5")'];te(Nt,f[Math.floor(Math.random()*f.length)]);const _=["No Aplica","Sin Protección","VRP","VA","VRP + VA"];te(Si,_[Math.floor(Math.random()*_.length)]);const h=["No cuenta con manómetros","Manómetro IN","Manómetros IN / OUT"];te(at,h[Math.floor(Math.random()*h.length)]),S("softener-equipo-notas","Equipo en operación normal. Sin novedades reportadas.");const E=[450,520,680,750,820,550,620];S(ut,E[Math.floor(Math.random()*E.length)]),S(Li,Math.floor(Math.random()*200)+50),S(wi,Math.floor(Math.random()*150)+100);const v=Math.random()>.5,b=g($t);b instanceof HTMLInputElement&&(b.checked=v);const I=new Date().toTimeString().slice(0,5);S(Nn,I),S(Mn,I),S(Rn,"02:00"),S(Dn,"02:00"),S(Fn,10),S($n,10),S(On,60),S(Pn,60),S(zn,10),S(kn,10),S(Bn,5),S(Hn,5),T(rt)==="Por Tiempo"&&(S(Tt,Math.floor(Math.random()*5)+2),S(Ct,Math.floor(Math.random()*5)+2)),fe("softener-check-fugas",Math.random()>.8);const m=Math.random()>.6;if(fe(ft,m),m){const A=T(Nt);S(qn,A),S(Vn,"LOTE-"+Math.floor(Math.random()*9e3+1e3))}fe("softener-check-limpieza-tanque",Math.random()>.7),fe("softener-check-nivel-agua",Math.random()>.3),fe("softener-check-carga-sal",Math.random()>.4),fe("softener-check-hora-correcta",Math.random()>.2),fe("softener-check-parametros-ciclo",Math.random()>.3),fe("softener-check-ajuste-autonomia",Math.random()>.5),fe("softener-check-regeneracion-manual",Math.random()>.8),S("softener-check-otros",""),S("softener-check-observaciones","Sistema funcionando correctamente. Parámetros dentro de rango normal.");const C=["Mantenimiento preventivo completo. Verificación de ciclos y parámetros.","Cambio de prefiltro y ajuste de autonomía según dureza detectada.","Servicio de rutina. Carga de sal y limpieza de tanque salero.","Calibración de cabezal y verificación de presiones del sistema."];S("softener-resumen-trabajo",C[Math.floor(Math.random()*C.length)]);const M=["Monitorear dureza de salida semanalmente.","Verificar nivel de sal mensualmente.","Próximo mantenimiento en 6 meses o según autonomía.","Controlar presiones de entrada periódicamente."];S("softener-resumen-recomendaciones",M[Math.floor(Math.random()*M.length)]);const w=new Date;w.setMonth(w.getMonth()+6),S("softener-resumen-proximo-servicio",w.toISOString().split("T")[0]),S("softener-resumen-materiales","Sal pellets x 25kg, Cartucho prefiltro 5µm"),S("softener-resumen-notas-cliente","Cliente conforme con el servicio realizado."),T(at)==="Manómetros IN/OUT"&&(S("softener-presion-entrada-as-found",(Math.random()*2+2).toFixed(2)),S("softener-presion-entrada-as-left",(Math.random()*2+2).toFixed(2)),S("softener-presion-salida-as-found",(Math.random()*1.5+1.5).toFixed(2)),S("softener-presion-salida-as-left",(Math.random()*1.5+1.5).toFixed(2))),te("softener-nivel-sal-as-found",["Adecuado","Bajo","Alto"][Math.floor(Math.random()*3)]),te("softener-nivel-sal-as-left","Adecuado"),te("softener-temperatura-ambiente",["Controlada","Alta (>30°C)","Variable"][Math.floor(Math.random()*3)]),te("softener-estado-gabinete",["Óptimo","Bueno","Regular"][Math.floor(Math.random()*3)]),S("softener-param-test-cloro-found",(Math.random()*2).toFixed(2)),S("softener-param-test-cloro-left",(Math.random()*2).toFixed(2)),S("softener-param-dureza-salida-found",Math.floor(Math.random()*30)),S("softener-param-dureza-salida-left",Math.floor(Math.random()*20)),S("softener-condiciones-observaciones","Ambiente controlado. Sin exposición a humedad excesiva."),te("softener-conformidad-cliente",["Conforme","Con observaciones"][Math.floor(Math.random()*2)]),S("softener-representante-cliente","Responsable de Mantenimiento"),te("softener-medio-confirmacion",["Firma en sitio","Correo electrónico"][Math.floor(Math.random()*2)]),fe("softener-requiere-seguimiento",Math.random()>.7),S("softener-observaciones-finales","Servicio completado satisfactoriamente."),Se(),Jn(),Mt(),fn(),Rt(),Rt()}function Sc(){const e=ic(),t={formulario:"mantenimiento_ablandador",version:"3.1",generado_en:new Date().toISOString(),numero_reporte:e},n=pe([["nombre",T("softener-cliente-nombre")],["direccion",T("softener-cliente-direccion")],["localidad",T("softener-cliente-localidad")],["contacto",T("softener-cliente-contacto")],["telefono",T("softener-cliente-telefono")],["email",T("softener-cliente-email")],["cuit",T("softener-cliente-cuit")],["fecha_servicio",qo(T("softener-fecha-servicio"))],["tecnico",T("softener-tecnico")]]),o=P(dt),i=P(ut),r=P(Li),a=P(Ii),s=P(wi),l=ne($t),d=ne(Zs),f=P("softener-param-presion-entrada-found"),_=P("softener-param-presion-entrada-left"),h=P("softener-param-test-cloro-found"),E=P("softener-param-test-cloro-left"),v=P("softener-param-dureza-salida-found"),b=P("softener-param-dureza-salida-left"),I=pe([["tipo",T("softener-equipo-tipo")],["modelo",T("softener-equipo-modelo")],["numero_serie",T("softener-equipo-numero-serie")],["ubicacion",T("softener-equipo-ubicacion")],["volumen_resina",o],["notas_equipo",T("softener-equipo-notas")],["tipo_regeneracion",T(rt)],["prefiltro",T("softener-equipo-prefiltro")],["proteccion_entrada",T(Si)],["manometros",T(at)]]),x=pe([["presion_entrada_as_found",f],["presion_entrada_as_left",_],["test_cloro_entrada_as_found",h],["test_cloro_entrada_as_left",E],["dureza_salida_as_found",v],["dureza_salida_as_left",b]]),m=pe([["dureza_agua_cruda",i],["autonomia_restante",r],["seteo_actual_autonomia",s],["aplicar_proteccion_20",l],["autonomia_recomendada",a],["autonomia_ajustada_valor_calculado",d]]),C=pe([["inspeccion_fugas",ne("softener-check-fugas")],["cambio_filtro_realizado",ne(ft)],["filtro_tipo_instalado",T(qn)],["filtro_lote_serie",T(Vn)],["limpieza_tanque_sal",ne("softener-check-limpieza-tanque")],["verificacion_nivel_agua",ne("softener-check-nivel-agua")],["carga_sal",ne("softener-check-carga-sal")],["verificacion_hora",ne("softener-check-hora-correcta")],["verificacion_parametros_ciclo",ne("softener-check-parametros-ciclo")],["ajuste_autonomia",ne("softener-check-ajuste-autonomia")],["regeneracion_manual",ne("softener-check-regeneracion-manual")],["otros",T("softener-check-otros")],["observaciones",T("softener-check-observaciones")]]),M=pe([["trabajo_realizado",T("softener-resumen-trabajo")],["recomendaciones",T("softener-resumen-recomendaciones")],["proximo_servicio",qo(T("softener-resumen-proximo-servicio"))],["materiales",T("softener-resumen-materiales")],["comentarios_cliente",T("softener-resumen-notas-cliente")]]),w=pe([["presion_entrada_as_found",P("softener-presion-entrada-as-found")],["presion_entrada_as_left",P("softener-presion-entrada-as-left")],["presion_salida_as_found",P("softener-presion-salida-as-found")],["presion_salida_as_left",P("softener-presion-salida-as-left")],["nivel_sal_as_found",T("softener-nivel-sal-as-found")],["nivel_sal_as_left",T("softener-nivel-sal-as-left")],["temperatura_ambiente",T("softener-temperatura-ambiente")],["estado_gabinete",T("softener-estado-gabinete")],["observaciones",T("softener-condiciones-observaciones")]]),R=pe([["conformidad_cliente",T("softener-conformidad-cliente")],["representante_cliente",T("softener-representante-cliente")],["medio_confirmacion",T("softener-medio-confirmacion")],["requiere_seguimiento",ne("softener-requiere-seguimiento")],["observaciones_finales",T("softener-observaciones-finales")]]),A={metadata:t,seccion_A_cliente:n,seccion_B_equipo:I,seccion_C_parametros:m,seccion_D_checklist:C,seccion_E_resumen:M,seccion_F_condiciones:w,seccion_G_cierre:R};Object.keys(x).length>0&&(A.seccion_B_parametros_operacion=x);const D=pe([["hora_cabezal_as_found",T(Nn)],["hora_cabezal_as_left",T(Mn)],["hora_regeneracion_as_found",T(Rn)],["hora_regeneracion_as_left",T(Dn)],["p1_retrolavado_min_found",P(Fn)],["p1_retrolavado_min_left",P($n)],["p2_salmuera_min_found",P(On)],["p2_salmuera_min_left",P(Pn)],["p3_enjuague_min_found",P(zn)],["p3_enjuague_min_left",P(kn)],["p4_llenado_salero_min_found",P(Bn)],["p4_llenado_salero_min_left",P(Hn)],["frecuencia_dias_found",P(Tt)],["frecuencia_dias_left",P(Ct)]]);return Object.keys(D).length>0&&(A.seccion_C_cabezal=D),A}function Se(){const e=P(dt),t=P(ut),n=ne($t);let o=null;if(e!==null&&t!==null&&t>0){const i=t/10;if(i>0){const r=e*6/i;Number.isFinite(r)&&(o=n?r*.8:r)}}oc(Ii,o),Ac(t)}function Ac(e){const t=g(ut),n=g("softener-dureza-warning");if(!t)return;const o=e!==null&&e>=650;o?(t.classList.remove("border-gray-300","focus:border-emerald-500","focus:ring-emerald-200"),t.classList.add("border-red-500","focus:border-red-600","focus:ring-red-200","bg-red-50","dark:bg-red-900/20")):(t.classList.remove("border-red-500","focus:border-red-600","focus:ring-red-200","bg-red-50","dark:bg-red-900/20"),t.classList.add("border-gray-300","focus:border-emerald-500","focus:ring-emerald-200")),n&&(o?n.classList.remove("hidden"):n.classList.add("hidden"))}function Tc(e={}){const{showView:t,guardarMantenimientoAblandador:n,obtenerClientes:o,remitoModule:i,onMaintenanceSaved:r}=e;let a=!1,s=null;const l=typeof n=="function"?n:oi,d=typeof o=="function"?o:ri;function f(){[dt,ut].forEach(M=>{const w=g(M);w instanceof HTMLInputElement&&w.addEventListener("input",Se)});const C=g($t);C instanceof HTMLInputElement&&C.addEventListener("change",Se)}function _(){const m=g(Vt);if(!(m instanceof HTMLFormElement))return;m.addEventListener("reset",()=>{tc(()=>{un(),Gt(),Wt(),Xt(),Se(),Mt()})});const C=g(qs);C instanceof HTMLButtonElement&&C.addEventListener("click",async D=>{D.preventDefault(),await v(C)});const M=g(Vs);M instanceof HTMLButtonElement&&M.addEventListener("click",()=>{setTimeout(()=>{un(),Gt(),Wt(),Xt(),Se()},0)});const w=g(Gs);w instanceof HTMLButtonElement&&w.addEventListener("click",D=>{D.preventDefault(),Lc()});const R=g(Do);R instanceof HTMLButtonElement&&R.addEventListener("click",async D=>{D.preventDefault(),await E(R)});const A=g(Fo);A instanceof HTMLButtonElement&&A.addEventListener("click",D=>{D.preventDefault(),h()})}function h(){if(!s){alert("⚠️ Primero debés guardar el mantenimiento antes de generar el remito.");return}i&&typeof i.handleGenerarRemitoClick=="function"?i.handleGenerarRemitoClick():alert("⚠️ El módulo de remito no está disponible.")}async function E(m){if(!s){alert("⚠️ Primero debes guardar el mantenimiento antes de generar el PDF.");return}const C=m.textContent;m.disabled=!0,m.textContent="Generando PDF...";try{const M=await ii({payload:s});console.log("Respuesta PDF:",M);const w=(M==null?void 0:M.data)||M;if(w!=null&&w.success||w!=null&&w.pdfGenerated){const R=w.numeroReporte||"SIN-ID",A=w.drive;if(A!=null&&A.url&&(A!=null&&A.fileId)){const D=`✅ PDF generado y guardado en Drive exitosamente!

Reporte N°: ${R}
Archivo: ${A.fileName||"PDF"}

¿Deseas abrir el PDF?`;confirm(D)&&window.open(A.url,"_blank")}else(A==null?void 0:A.saved)===!1?alert(`✅ PDF generado correctamente.

Reporte N°: ${R}

⚠️ No se pudo guardar en Drive: ${A.message||"Error desconocido"}`):alert(`✅ PDF generado correctamente.

Reporte N°: ${R}`)}else throw new Error((w==null?void 0:w.message)||"Respuesta inesperada del servidor")}catch(M){console.error("Error al generar PDF de ablandador:",M);const w=(M==null?void 0:M.message)||"No se pudo generar el PDF.";alert(`❌ Error: ${w}`)}finally{m.disabled=!1,m.textContent=C}}async function v(m){var w;if(!(g(Vt)instanceof HTMLFormElement)){alert("El formulario de mantenimiento de ablandador no está disponible.");return}const M=m.textContent;m.disabled=!0,m.textContent="Guardando...";try{Se();const R=Sc();if(typeof l!="function")throw new Error("Servicio de mantenimiento de ablandador no disponible.");await l({payload:R});const A=((w=R.metadata)==null?void 0:w.numero_reporte)||"ABL-PENDIENTE";rc(A),s=R;const D=g(Do);D instanceof HTMLButtonElement&&(D.disabled=!1);const k=g(Fo);k instanceof HTMLButtonElement&&(k.disabled=!1),typeof r=="function"&&r(R),alert(`✅ Mantenimiento de ablandador guardado correctamente.

Reporte N°: ${A}

Ahora podés generar el PDF o el Remito.
Si querés crear un nuevo reporte, refrescá la página.`)}catch(R){console.error("Error al guardar mantenimiento de ablandador:",R);const A=(R==null?void 0:R.message)||"No se pudieron guardar los datos del mantenimiento.";alert(`❌ Error al guardar los datos: ${A}`)}finally{m.disabled=!1,m.textContent=M}}function b(){a||!(g(Vt)instanceof HTMLFormElement)||(Gt(),Wt(),Se(),Mt(),uc(d),f(),fc(),pc(),hc(),yc(),vc(),Ec(),xc(),wc(),Xt(),_(),a=!0)}function I(){b()}function x(){b(),typeof t=="function"&&t(js)}return{initialize:I,show:x}}const{guardarMantenimiento:Cc,guardarMantenimientoAblandador:Nc,buscarMantenimientos:Mc,actualizarMantenimiento:Rc,eliminarMantenimiento:Dc,obtenerDashboard:Fc,obtenerClientes:Xn,obtenerRemitos:$c,crearRemito:Oc,actualizarRemito:Pc,eliminarRemito:zc,obtenerVersionServidor:kc}=wr;Vi();const Ce=Va({showView:He,apiUrl:ve,getToken:ni}),Bc=ua({guardarMantenimiento:Cc,obtenerClientes:Xn},{onReportSaved:e=>{Ce.handleMaintenanceSaved(e)},onReportReset:()=>{Ce.reset()}}),Hc=ha({buscarMantenimientos:Mc,actualizarMantenimiento:Rc,eliminarMantenimiento:Dc},{showView:He}),Uc=Cr({obtenerDashboard:Fc},{showView:He}),Ni=Us({obtenerRemitos:$c,crearRemito:Oc,actualizarRemito:Pc,eliminarRemito:zc,obtenerClientes:Xn}),jc=Tc({showView:He,guardarMantenimientoAblandador:Nc,obtenerClientes:Xn,remitoModule:Ce,onMaintenanceSaved:e=>{Ce&&typeof Ce.handleMaintenanceSaved=="function"&&Ce.handleMaintenanceSaved(e)}}),be={maintenance:Bc,remito:Ce,search:Hc,dashboard:Uc,remitosGestion:Ni,softener:jc};function et(e,t){e&&(typeof t=="string"&&t.trim()?(e.textContent=t.trim(),e.classList.remove("hidden")):(e.textContent="",e.classList.add("hidden")))}function qc(){const e=document.getElementById("app-version");if(e){{const t="1.0.0".trim();if(t){et(e,`Frontend v${t}`);return}}et(e,"")}}function Vc(e){if(!e)return"";if(typeof e=="string"){const i=e.trim();return i?`Scripts ${i}`:""}if(typeof e!="object")return"";const t=e,n=[];t.versionNumber!==void 0&&t.versionNumber!==null&&n.push(`#${t.versionNumber}`),typeof t.description=="string"&&t.description.trim()&&n.push(t.description.trim()),!n.length&&typeof t.label=="string"&&t.label.trim()&&n.push(t.label.trim()),!n.length&&typeof t.deploymentId=="string"&&t.deploymentId.trim()&&n.push(`ID ${t.deploymentId.trim()}`);let o=n.join(" – ");if(typeof t.generatedAt=="string"){const i=new Date(t.generatedAt);if(!Number.isNaN(i.getTime())){const r=(navigator==null?void 0:navigator.language)||"es-AR",a=i.toLocaleString(r,{dateStyle:"short",timeStyle:"short"});a&&(o=o?`${o} · ${a}`:a)}}return o?`Scripts ${o}`:""}async function Gc(){const e=document.getElementById("script-version");if(e)try{const t=await kc(),n=Vc(t);n?et(e,n):et(e,"Scripts versión no disponible")}catch(t){console.error("No se pudo obtener la versión de los scripts:",t),et(e,"Scripts versión no disponible")}}function mt(e,t){document.querySelectorAll(".tab-button").forEach(o=>o.classList.remove("active"));let n=null;typeof t=="string"&&t&&(n=document.getElementById(t)),!n&&typeof e=="string"&&e&&(n=document.getElementById(`tab-${e}-btn`)),n&&n.classList.add("active")}function Wc(){He("tab-nuevo"),mt("nuevo")}function Zc(){be.softener.show(),mt("nuevo")}function Qn(){return{modal:document.getElementById("maintenance-type-modal"),backdrop:document.getElementById("maintenance-type-backdrop")}}function Kc(){const{modal:e,backdrop:t}=Qn();t&&t.classList.remove("hidden"),e&&(e.classList.remove("hidden"),e.setAttribute("aria-hidden","false"))}function Ze(){const{modal:e,backdrop:t}=Qn();t&&t.classList.add("hidden"),e&&(e.classList.add("hidden"),e.setAttribute("aria-hidden","true"))}function Yc(){be.search.show(),mt("buscar")}async function Mi(){mt("dashboard"),await be.dashboard.show()}function Jc(){const e=document.getElementById("tab-nuevo-btn");e&&e.addEventListener("click",()=>{Kc()});const t=document.getElementById("tab-buscar-btn");t&&t.addEventListener("click",()=>{Yc()});const n=document.getElementById("tab-dashboard-btn");n&&n.addEventListener("click",()=>{Mi()});const o=document.getElementById("nav-remitos-btn");o&&o.addEventListener("click",()=>{He("remitos-gestion-view"),mt(null,"nav-remitos-btn"),Ni.renderListado({page:1})});const i=document.getElementById("maintenance-type-osmosis");i&&i.addEventListener("click",()=>{Wc(),Ze()});const r=document.getElementById("maintenance-type-softener");r&&r.addEventListener("click",()=>{Zc(),Ze()});const a=document.getElementById("maintenance-type-cancel");a&&a.addEventListener("click",()=>{Ze()});const{modal:s,backdrop:l}=Qn();l&&l.addEventListener("click",()=>{Ze()}),s&&s.addEventListener("click",d=>{d.target===s&&Ze()})}async function Xc(){qc(),Gc(),Jc(),be.remito.initialize(),be.search.initialize(),be.remitosGestion.initialize(),be.softener.initialize();try{await ur(),await be.maintenance.initialize(),await Mi()}catch(e){console.error("Error inicializando la aplicación:",e),alert("No se pudo inicializar la aplicación. Revisa la consola para más detalles.")}}document.addEventListener("DOMContentLoaded",()=>{Xc()});
